%% Generated by Sphinx.
\def\sphinxdocclass{report}
\documentclass[letterpaper,10pt,openany,oneside,english]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}


\PassOptionsToPackage{warn}{textcomp}
\usepackage[utf8]{inputenc}
\ifdefined\DeclareUnicodeCharacter
% support both utf8 and utf8x syntaxes
  \ifdefined\DeclareUnicodeCharacterAsOptional
    \def\sphinxDUC#1{\DeclareUnicodeCharacter{"#1}}
  \else
    \let\sphinxDUC\DeclareUnicodeCharacter
  \fi
  \sphinxDUC{00A0}{\nobreakspace}
  \sphinxDUC{2500}{\sphinxunichar{2500}}
  \sphinxDUC{2502}{\sphinxunichar{2502}}
  \sphinxDUC{2514}{\sphinxunichar{2514}}
  \sphinxDUC{251C}{\sphinxunichar{251C}}
  \sphinxDUC{2572}{\textbackslash}
\fi
\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}
\usepackage[english]{babel}



\usepackage{tgtermes}
\usepackage{tgheros}
\renewcommand{\ttdefault}{txtt}



\usepackage[Bjarne]{fncychap}
\usepackage{sphinx}

\fvset{fontsize=auto}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}


\usepackage{sphinxmessages}
\setcounter{tocdepth}{0}



\title{Use cases}
\date{Nov 30, 2022}
\release{1.0.0}
\author{INRAE}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{Release}
\makeindex
\begin{document}

\ifdefined\shorthandoff
  \ifnum\catcode`\=\string=\active\shorthandoff{=}\fi
  \ifnum\catcode`\"=\active\shorthandoff{"}\fi
\fi

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{examples/usecases_pdf::doc}}



\chapter{Use cases}
\label{\detokenize{examples/usecases_pdf:usecases}}\label{\detokenize{examples/usecases_pdf:id1}}
\sphinxAtStartPar
Here are several toulbar2 use cases, where toulbar2 has been used in order to
resolve different problems.
According to cases, they can be used to overview, learn, use toulbar2…
They may contain source code, explanations, possibility to run yourself…

\sphinxAtStartPar
You will find the mentioned examples, among the following exhaustive
list of examples.

\sphinxAtStartPar
\sphinxstylestrong{toulbar2 and Deep Learning} :
\begin{itemize}
\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{examples/vstut:vs-tut}]{\sphinxcrossref{\DUrole{std,std-ref}{Visual Sudoku Tutorial}}}} \sphinxincludegraphics[width=30\sphinxpxdimen]{{logo-colab}.png}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{examples/vsapp:vs-app}]{\sphinxcrossref{\DUrole{std,std-ref}{Visual Sudoku Application}}}} \sphinxincludegraphics[width=30\sphinxpxdimen]{{logo-ws_ui-vsudoku}.png} \sphinxincludegraphics[width=20\sphinxpxdimen]{{logo-apk_visualsudokuapp}.png}

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{Some applications based on toulbar2} :
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Mendelsoft} : \sphinxhref{https://miat.inrae.fr/MendelSoft}{Mendelsoft} detects
Mendelian errors in complex pedigree
{[}\sphinxhref{http://miat.inrae.fr/degivry/Sanchez07a.pdf}{Sanchez et al, Constraints 2008}{]}.

\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Pompd} : \sphinxhref{https://forgemia.inra.fr/thomas.schiex/pompd}{POsitive Multistate Protein Design},
{[}\sphinxhref{https://hal.inrae.fr/hal-02625007/file/main.pdf}{Vucini et al Bioinformatics 2020}{]}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{examples/vsapp:vs-app}]{\sphinxcrossref{\DUrole{std,std-ref}{Visual Sudoku Application}}}} \sphinxincludegraphics[width=30\sphinxpxdimen]{{logo-ws_ui-vsudoku}.png} \sphinxincludegraphics[width=20\sphinxpxdimen]{{logo-apk_visualsudokuapp}.png}

\end{itemize}

\sphinxAtStartPar
\sphinxstylestrong{Misc} :
\begin{itemize}
\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{examples/snum:snum}]{\sphinxcrossref{\DUrole{std,std-ref}{A sudoku code}}}}

\end{itemize}


\chapter{List of all examples}
\label{\detokenize{examples/usecases_pdf:list-of-all-examples}}\label{\detokenize{examples/usecases_pdf:examples-toc}}
\sphinxstepscope


\section{Weighted n\sphinxhyphen{}queen problem}
\label{\detokenize{examples/tuto_wnqp:weighted-n-queen-problem}}\label{\detokenize{examples/tuto_wnqp:tuto-wnqp}}\label{\detokenize{examples/tuto_wnqp::doc}}



\subsection{Brief description}
\label{\detokenize{examples/tuto_wnqp:brief-description}}
\sphinxAtStartPar
The problem consists in assigning N queens on a NxN chessboard with random costs in (1..N) associated to every cell such that each queen does not attack another queen and the sum of the costs of queen’s selected cells is minimized.


\subsection{CFN model}
\label{\detokenize{examples/tuto_wnqp:cfn-model}}
\sphinxAtStartPar
A solution must have only one queen per column and per row. We create N variables for every column with domain size N to represent the selected row for each queen. A clique of binary constraints is used to express that two queens cannot be on the same row. Forbidden assignments have cost k=N**2+1. Two other cliques of binary constraints are used to express that two queens do not attack each other on a lower/upper diagonal. We add N unary cost functions to create the objective function with random costs on every cell.


\subsection{Example for N=4 in JSON .cfn format}
\label{\detokenize{examples/tuto_wnqp:example-for-n-4-in-json-cfn-format}}
\sphinxAtStartPar
\sphinxstyleemphasis{More details :}

\noindent\sphinxincludegraphics[width=250\sphinxpxdimen]{{queen4_details}.png}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\PYGZob{}}
  \PYG{n}{problem}\PYG{p}{:} \PYG{p}{\PYGZob{}} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{name}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{4\PYGZhy{}queen}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{mustbe}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZlt{}17}\PYG{l+s+s2}{\PYGZdq{}} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{n}{variables}\PYG{p}{:} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Row0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Row1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Row2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Row3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Row0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Row1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Row2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Row3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,}
              \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Row0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Row1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Row2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Row3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Row0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Row1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Row2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Row3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{n}{functions}\PYG{p}{:} \PYG{p}{\PYGZob{}}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}

    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}

    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{17}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}

    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Q3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}

\sphinxAtStartPar
Optimal solution with cost 11 for the 4\sphinxhyphen{}queen example :

\noindent\sphinxincludegraphics[height=250\sphinxpxdimen]{{queen4}.png}


\subsection{Python model}
\label{\detokenize{examples/tuto_wnqp:python-model}}
\sphinxAtStartPar
The following code using the pytoulbar2 library solves the weighted N\sphinxhyphen{}queen problem with the first argument being the number of queens N (e.g. “python3 weightedqueens.py 8”).

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{weightedqueens.py}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{sys}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{seed}\PYG{p}{,} \PYG{n}{randint}
\PYG{n}{seed}\PYG{p}{(}\PYG{l+m+mi}{123456789}\PYG{p}{)}
\PYG{k+kn}{import} \PYG{n+nn}{pytoulbar2}

\PYG{n}{N} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{top} \PYG{o}{=} \PYG{n}{N}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2} \PYG{o}{+}\PYG{l+m+mi}{1}

\PYG{n}{Problem} \PYG{o}{=} \PYG{n}{pytoulbar2}\PYG{o}{.}\PYG{n}{CFN}\PYG{p}{(}\PYG{n}{top}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Q}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{row}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{a}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)} \PYG{k}{for} \PYG{n}{a} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}
    
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
	\PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
	    	
		\PYG{c+c1}{\PYGZsh{}Two queens cannot be on the same row constraints}
		\PYG{n}{ListConstraintsRow} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
		\PYG{k}{for} \PYG{n}{a} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
			\PYG{k}{for} \PYG{n}{b} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
				\PYG{k}{if} \PYG{n}{a} \PYG{o}{!=} \PYG{n}{b} \PYG{p}{:}
					\PYG{n}{ListConstraintsRow}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
				\PYG{k}{else}\PYG{p}{:}
				 	\PYG{n}{ListConstraintsRow}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{top}\PYG{p}{)}
		\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{n}{i}\PYG{p}{,} \PYG{n}{j}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ListConstraintsRow}\PYG{p}{)}
		
		\PYG{c+c1}{\PYGZsh{}Two queens cannot be on the same upper diagonal constraints}
		\PYG{n}{ListConstraintsUpperD} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
		\PYG{k}{for} \PYG{n}{a} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
			\PYG{k}{for} \PYG{n}{b} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
				\PYG{k}{if} \PYG{n}{a} \PYG{o}{+} \PYG{n}{i} \PYG{o}{!=} \PYG{n}{b} \PYG{o}{+} \PYG{n}{j} \PYG{p}{:}
					\PYG{n}{ListConstraintsUpperD}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
				\PYG{k}{else}\PYG{p}{:}
				 	\PYG{n}{ListConstraintsUpperD}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{top}\PYG{p}{)}
		\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{n}{i}\PYG{p}{,} \PYG{n}{j}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ListConstraintsUpperD}\PYG{p}{)}
		
		\PYG{c+c1}{\PYGZsh{}Two queens cannot be on the same lower diagonal constraints}
		\PYG{n}{ListConstraintsLowerD} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
		\PYG{k}{for} \PYG{n}{a} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
			\PYG{k}{for} \PYG{n}{b} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
				\PYG{k}{if} \PYG{n}{a} \PYG{o}{\PYGZhy{}} \PYG{n}{i} \PYG{o}{!=} \PYG{n}{b} \PYG{o}{\PYGZhy{}} \PYG{n}{j} \PYG{p}{:}
					\PYG{n}{ListConstraintsLowerD}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
				\PYG{k}{else}\PYG{p}{:}
				 	\PYG{n}{ListConstraintsLowerD}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{top}\PYG{p}{)}
		\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{n}{i}\PYG{p}{,} \PYG{n}{j}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ListConstraintsLowerD}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}Random unary costs}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
	\PYG{n}{ListConstraintsUnaryC} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
	\PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
		\PYG{n}{ListConstraintsUnaryC}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{N}\PYG{p}{)}\PYG{p}{)}
	\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ListConstraintsUnaryC}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{}Problem.Dump(\PYGZsq{}WeightQueen.cfn\PYGZsq{})}
\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{CFN}\PYG{o}{.}\PYG{n}{timer}\PYG{p}{(}\PYG{l+m+mi}{300}\PYG{p}{)}
\PYG{n}{res} \PYG{o}{=} \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{Solve}\PYG{p}{(}\PYG{n}{showSolutions} \PYG{o}{=} \PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{k}{if} \PYG{n}{res}\PYG{p}{:}
	\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
		\PYG{n}{row} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{X}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{if} \PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]}\PYG{o}{==}\PYG{n}{i} \PYG{k}{else} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{]}
		\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{row}\PYG{p}{)}
	\PYG{c+c1}{\PYGZsh{} and its cost}
	\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Cost:}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}

\end{sphinxVerbatim}

\sphinxstepscope


\section{Weighted latin square problem}
\label{\detokenize{examples/tuto_wlsp:weighted-latin-square-problem}}\label{\detokenize{examples/tuto_wlsp:tuto-wlsp}}\label{\detokenize{examples/tuto_wlsp::doc}}



\subsection{Brief description}
\label{\detokenize{examples/tuto_wlsp:brief-description}}
\sphinxAtStartPar
The problem consists in assigning a value from 0 to N\sphinxhyphen{}1 to every cell of a NxN chessboard.
Each row and each column must be a permutation of N values. For each cell, a random cost in (1…N) is associated to every domain value.
The objective is to find a complete assignment where the sum of the costs associated to the selected values for the cells is minimized.


\subsection{CFN model}
\label{\detokenize{examples/tuto_wlsp:cfn-model}}
\sphinxAtStartPar
We create NxN variables, one for every cell, with domain size N. An AllDifferent hard global constraint is used to model a permutation for every row and every column. Its encoding uses knapsack constraints.
Unary cost functions containing random costs associated to domain values are generated for every cell.
The worst possible solution is when every cell is associated with a cost of N, so the maximum cost of a solution is N**3, so forbidden assignments have cost k=N**3+1.


\subsection{Example for N=4 in JSON .cfn format}
\label{\detokenize{examples/tuto_wlsp:example-for-n-4-in-json-cfn-format}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{\PYGZob{}}
  \PYG{n}{problem}\PYG{p}{:} \PYG{p}{\PYGZob{}} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{name}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{LatinSquare4}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{mustbe}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZlt{}65}\PYG{l+s+s2}{\PYGZdq{}} \PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{n}{variables}\PYG{p}{:} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X0\PYGZus{}0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X0\PYGZus{}1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X0\PYGZus{}2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X0\PYGZus{}3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X1\PYGZus{}0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X1\PYGZus{}1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X1\PYGZus{}2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X1\PYGZus{}3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X2\PYGZus{}0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X2\PYGZus{}1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X2\PYGZus{}2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X2\PYGZus{}3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X3\PYGZus{}0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X3\PYGZus{}1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X3\PYGZus{}2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X3\PYGZus{}3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{4}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
  \PYG{n}{functions}\PYG{p}{:} \PYG{p}{\PYGZob{}}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X0\PYGZus{}0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X0\PYGZus{}1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X0\PYGZus{}2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X0\PYGZus{}3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{type:}\PYG{l+s+s2}{\PYGZdq{}} \PYG{n}{salldiff}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{params}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{metric}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{var}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cost}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{65}\PYG{p}{\PYGZcb{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X1\PYGZus{}0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X1\PYGZus{}1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X1\PYGZus{}2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X1\PYGZus{}3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{type:}\PYG{l+s+s2}{\PYGZdq{}} \PYG{n}{salldiff}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{params}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{metric}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{var}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cost}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{65}\PYG{p}{\PYGZcb{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X2\PYGZus{}0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X2\PYGZus{}1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X2\PYGZus{}2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X2\PYGZus{}3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{type:}\PYG{l+s+s2}{\PYGZdq{}} \PYG{n}{salldiff}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{params}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{metric}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{var}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cost}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{65}\PYG{p}{\PYGZcb{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X3\PYGZus{}0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X3\PYGZus{}1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X3\PYGZus{}2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X3\PYGZus{}3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{type:}\PYG{l+s+s2}{\PYGZdq{}} \PYG{n}{salldiff}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{params}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{metric}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{var}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cost}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{65}\PYG{p}{\PYGZcb{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}

    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X0\PYGZus{}0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X1\PYGZus{}0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X2\PYGZus{}0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X3\PYGZus{}0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{type:}\PYG{l+s+s2}{\PYGZdq{}} \PYG{n}{salldiff}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{params}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{metric}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{var}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cost}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{65}\PYG{p}{\PYGZcb{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X0\PYGZus{}1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X1\PYGZus{}1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X2\PYGZus{}1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X3\PYGZus{}1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{type:}\PYG{l+s+s2}{\PYGZdq{}} \PYG{n}{salldiff}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{params}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{metric}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{var}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cost}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{65}\PYG{p}{\PYGZcb{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X0\PYGZus{}2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X1\PYGZus{}2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X2\PYGZus{}2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X3\PYGZus{}2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{type:}\PYG{l+s+s2}{\PYGZdq{}} \PYG{n}{salldiff}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{params}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{metric}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{var}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cost}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{65}\PYG{p}{\PYGZcb{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X0\PYGZus{}3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X1\PYGZus{}3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X2\PYGZus{}3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X3\PYGZus{}3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{type:}\PYG{l+s+s2}{\PYGZdq{}} \PYG{n}{salldiff}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{params}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{metric}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{var}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cost}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{l+m+mi}{65}\PYG{p}{\PYGZcb{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}

    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X0\PYGZus{}0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X0\PYGZus{}1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X0\PYGZus{}2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X0\PYGZus{}3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X1\PYGZus{}0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X1\PYGZus{}1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X1\PYGZus{}2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X1\PYGZus{}3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X2\PYGZus{}0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X2\PYGZus{}1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X2\PYGZus{}2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X2\PYGZus{}3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X3\PYGZus{}0}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X3\PYGZus{}1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X3\PYGZus{}2}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
    \PYG{p}{\PYGZob{}}\PYG{n}{scope}\PYG{p}{:} \PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X3\PYGZus{}3}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{costs}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:} \PYG{p}{[}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{\PYGZcb{}}
\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}

\sphinxAtStartPar
Optimal solution with cost 35 for the latin 4\sphinxhyphen{}square example (in red, costs associated to the selected values) :

\noindent\sphinxincludegraphics[height=250\sphinxpxdimen]{{latin4}.png}


\subsection{Python model}
\label{\detokenize{examples/tuto_wlsp:python-model}}
\sphinxAtStartPar
The following code using the pytoulbar2 library solves the weighted latin square problem with the first argument being the dimension N of the chessboard (e.g. “python3 latinsquare.py 6”).

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{latinsquare.py}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{sys}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{seed}\PYG{p}{,} \PYG{n}{randint}
\PYG{n}{seed}\PYG{p}{(}\PYG{l+m+mi}{123456789}\PYG{p}{)}
\PYG{k+kn}{import} \PYG{n+nn}{pytoulbar2}

\PYG{n}{N} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{top} \PYG{o}{=} \PYG{n}{N}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{3} \PYG{o}{+}\PYG{l+m+mi}{1}

\PYG{n}{Problem} \PYG{o}{=} \PYG{n}{pytoulbar2}\PYG{o}{.}\PYG{n}{CFN}\PYG{p}{(}\PYG{n}{top}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
        \PYG{c+c1}{\PYGZsh{}Create a variable for each square}
        \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Cell(}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{,}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{}Create a constraint all different with variables on the same row}
    \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddAllDifferent}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Cell(}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{,}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{)}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{n}{encoding} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{salldiffkp}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{}Create a constraint all different with variables on the same column}
    \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddAllDifferent}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Cell(}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{,}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{n}{encoding} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{salldiffkp}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}Random unary costs}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{ListConstraintsUnaryC} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{l} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{ListConstraintsUnaryC}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{randint}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{N}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Cell(}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{,}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ListConstraintsUnaryC}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}Problem.Dump(\PYGZsq{}WeightLatinSquare.cfn\PYGZsq{})}
\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{CFN}\PYG{o}{.}\PYG{n}{timer}\PYG{p}{(}\PYG{l+m+mi}{300}\PYG{p}{)}
\PYG{n}{res} \PYG{o}{=} \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{Solve}\PYG{p}{(}\PYG{n}{showSolutions} \PYG{o}{=} \PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{k}{if} \PYG{n}{res} \PYG{o+ow}{and} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)} \PYG{o}{==} \PYG{n}{N}\PYG{o}{*}\PYG{n}{N}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} pretty print solution}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{p}{[}\PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{n}{i} \PYG{o}{*} \PYG{n}{N} \PYG{o}{+} \PYG{n}{j}\PYG{p}{]} \PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} and its cost}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Cost:}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}

\end{sphinxVerbatim}

\sphinxstepscope


\section{Radio link frequency assignment problem}
\label{\detokenize{examples/tuto_rlfap:radio-link-frequency-assignment-problem}}\label{\detokenize{examples/tuto_rlfap:tuto-rlfap}}\label{\detokenize{examples/tuto_rlfap::doc}}



\subsection{Brief description}
\label{\detokenize{examples/tuto_rlfap:brief-description}}
\sphinxAtStartPar
The problem consists in assigning frequencies to radio communication links in such a way that no interferences occur. Domains are set of integers (non necessarily consecutives).

\sphinxAtStartPar
Two types of constraints occur:
\begin{itemize}
\item {} 
\sphinxAtStartPar
(I) the absolute difference between two frequencies should be greater than a given number d\_i ( | x \sphinxhyphen{} y | \textgreater{} d\_i )

\item {} 
\sphinxAtStartPar
(II) the absolute difference between two frequencies should exactly be equal to a given number d\_i ( | x \sphinxhyphen{} y | = d\_i ).

\end{itemize}

\sphinxAtStartPar
Different deviations d\_i, i in 0..4, may exist for the same pair of links. d\_0 corresponds to hard constraints while higher deviations are soft constraints that can be violated with an associated cost a\_i. Moreover, pre\sphinxhyphen{}assigned frequencies may be known for some links which are either hard or soft preferences (mobility cost b\_i, i in 0..4). The goal is to minimize the weighted sum of violated constraints.
\begin{description}
\sphinxlineitem{So the goal is to minimize the sum:}
\sphinxAtStartPar
a\_1*nc1+…+a\_4*nc4+b\_1*nv1+…+b\_4*nv4

\end{description}

\sphinxAtStartPar
where nci is the number of violated constraints with cost a\_i and nvi is the number of modified variables with mobility cost b\_i.

\sphinxAtStartPar
\sphinxhref{https://miat.inrae.fr/degivry/Schiex99.ps.gz}{Cabon, B., de Givry, S., Lobjois, L., Schiex, T.,  Warners, J.P. Constraints (1999) 4: 79}.


\subsection{CFN model}
\label{\detokenize{examples/tuto_rlfap:cfn-model}}
\sphinxAtStartPar
We create N variables for every radio link with a given integer domain. Hard and soft binary cost functions express interference constraints with possible deviations with cost equal to a\_i. Unary cost functions are used to model mobility costs with cost equal to b\_i. The initial upper bound is defined as 1 plus the total cost where all the soft constraints are maximally violated (costs a\_4/b\_4).


\subsection{Data}
\label{\detokenize{examples/tuto_rlfap:data}}
\sphinxAtStartPar
Original data files can be download from the cost function library \sphinxhref{https://forgemia.inra.fr/thomas.schiex/cost-function-library/tree/master/real/celar/data/FullRLFAP}{FullRLFAP}. Their format is described \sphinxhref{https://forgemia.inra.fr/thomas.schiex/cost-function-library/tree/master/real/celar/data/FullRLFAP/celar.blurb}{here}. You can try a small example CELAR6\sphinxhyphen{}SUB1 (\sphinxcode{\sphinxupquote{var.txt}}, \sphinxcode{\sphinxupquote{dom.txt}}, \sphinxcode{\sphinxupquote{ctr.txt}}, \sphinxcode{\sphinxupquote{cst.txt}}) with optimum value equal to 2669.


\subsection{Python model}
\label{\detokenize{examples/tuto_rlfap:python-model}}
\sphinxAtStartPar
The following code solves the corresponding cost function network using the pytoulbar2 library and needs 4 arguments: the variable file, the domain file, the constraints file and the cost file (e.g. “python3 rlfap.py var.txt dom.txt ctr.txt cst.txt”).

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{rlfap.py}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{sys}
\PYG{k+kn}{import} \PYG{n+nn}{pytoulbar2}

\PYG{k}{class} \PYG{n+nc}{Data}\PYG{p}{:}
	\PYG{k}{def} \PYG{n+nf+fm}{\PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{var}\PYG{p}{,} \PYG{n}{dom}\PYG{p}{,} \PYG{n}{ctr}\PYG{p}{,} \PYG{n}{cst}\PYG{p}{)}\PYG{p}{:}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{var} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{p}{)}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{dom} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{p}{\PYGZcb{}}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{ctr} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{p}{)}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{cost} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{p}{\PYGZcb{}}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{nba} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{p}{\PYGZcb{}}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{nbb} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{p}{\PYGZcb{}}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{top} \PYG{o}{=} \PYG{l+m+mi}{1}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{Domain} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{p}{\PYGZcb{}}

		\PYG{n}{stream} \PYG{o}{=} \PYG{n+nb}{open}\PYG{p}{(}\PYG{n}{var}\PYG{p}{)}
		\PYG{k}{for} \PYG{n}{line} \PYG{o+ow}{in} \PYG{n}{stream}\PYG{p}{:}
			\PYG{k}{if} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{o}{\PYGZgt{}}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{:}
				\PYG{p}{(}\PYG{n}{varnum}\PYG{p}{,} \PYG{n}{vardom}\PYG{p}{,} \PYG{n}{value}\PYG{p}{,} \PYG{n}{mobility}\PYG{p}{)} \PYG{o}{=} \PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{l+m+mi}{4}\PYG{p}{]}
				\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{Domain}\PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{varnum}\PYG{p}{)}\PYG{p}{]} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{vardom}\PYG{p}{)}
				\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{var}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{varnum}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{vardom}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{value}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{mobility}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
				\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{nbb}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{b}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{mobility}\PYG{p}{)}\PYG{p}{]} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{nbb}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{b}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{mobility}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)} \PYG{o}{+} \PYG{l+m+mi}{1}
			\PYG{k}{else}\PYG{p}{:}
				\PYG{p}{(}\PYG{n}{varnum}\PYG{p}{,} \PYG{n}{vardom}\PYG{p}{)} \PYG{o}{=} \PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{l+m+mi}{2}\PYG{p}{]}
				\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{Domain}\PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{varnum}\PYG{p}{)}\PYG{p}{]} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{vardom}\PYG{p}{)}
				\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{var}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{varnum}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{vardom}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
		\PYG{n}{stream} \PYG{o}{=} \PYG{n+nb}{open}\PYG{p}{(}\PYG{n}{dom}\PYG{p}{)}
		\PYG{k}{for} \PYG{n}{line} \PYG{o+ow}{in} \PYG{n}{stream}\PYG{p}{:}
			\PYG{n}{domain} \PYG{o}{=} \PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{p}{]}
			\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{dom}\PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{domain}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]} \PYG{o}{=} \PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{f}\PYG{p}{)} \PYG{k}{for} \PYG{n}{f} \PYG{o+ow}{in} \PYG{n}{domain}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{:}\PYG{p}{]}\PYG{p}{]}

		\PYG{n}{stream} \PYG{o}{=} \PYG{n+nb}{open}\PYG{p}{(}\PYG{n}{ctr}\PYG{p}{)}
		\PYG{k}{for} \PYG{n}{line} \PYG{o+ow}{in} \PYG{n}{stream}\PYG{p}{:}
			\PYG{p}{(}\PYG{n}{var1}\PYG{p}{,} \PYG{n}{var2}\PYG{p}{,} \PYG{n}{dummy}\PYG{p}{,} \PYG{n}{operand}\PYG{p}{,} \PYG{n}{deviation}\PYG{p}{,} \PYG{n}{weight}\PYG{p}{)} \PYG{o}{=} \PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{l+m+mi}{6}\PYG{p}{]}
			\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{ctr}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{var1}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{var2}\PYG{p}{)}\PYG{p}{,} \PYG{n}{operand}\PYG{p}{,} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{deviation}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{weight}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
			\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{nba}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{a}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{weight}\PYG{p}{)}\PYG{p}{]} \PYG{o}{=} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{nba}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{a}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{weight}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)} \PYG{o}{+} \PYG{l+m+mi}{1}
			
		\PYG{n}{stream} \PYG{o}{=} \PYG{n+nb}{open}\PYG{p}{(}\PYG{n}{cst}\PYG{p}{)}
		\PYG{k}{for} \PYG{n}{line} \PYG{o+ow}{in} \PYG{n}{stream}\PYG{p}{:}
			\PYG{k}{if} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)} \PYG{o}{==} \PYG{l+m+mi}{3}\PYG{p}{:}
				\PYG{p}{(}\PYG{n}{aorbi}\PYG{p}{,} \PYG{n}{eq}\PYG{p}{,} \PYG{n}{cost}\PYG{p}{)} \PYG{o}{=} \PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{]}
				\PYG{k}{if} \PYG{p}{(}\PYG{n}{eq} \PYG{o}{==} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{:}
					\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{cost}\PYG{p}{[}\PYG{n}{aorbi}\PYG{p}{]} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{cost}\PYG{p}{)}
					\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{top} \PYG{o}{+}\PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{cost}\PYG{p}{)} \PYG{o}{*} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{nba}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{aorbi}\PYG{p}{,} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{nbb}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{aorbi}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{)}

		            
\PYG{c+c1}{\PYGZsh{}collect data           }
\PYG{n}{data} \PYG{o}{=} \PYG{n}{Data}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{,} \PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{,} \PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{4}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{top} \PYG{o}{=} \PYG{n}{data}\PYG{o}{.}\PYG{n}{top}
\PYG{n}{Problem} \PYG{o}{=} \PYG{n}{pytoulbar2}\PYG{o}{.}\PYG{n}{CFN}\PYG{p}{(}\PYG{n}{top}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}create a variable for each link}
\PYG{k}{for} \PYG{n}{e} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{var}\PYG{p}{:}
	\PYG{n}{domain} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
	\PYG{k}{for} \PYG{n}{f} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{dom}\PYG{p}{[}\PYG{n}{e}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{:}
		\PYG{n}{domain}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{f}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{f}\PYG{p}{)}\PYG{p}{)}
	\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{link}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{e}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{domain}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}binary hard and soft constraints}
\PYG{k}{for} \PYG{p}{(}\PYG{n}{var1}\PYG{p}{,} \PYG{n}{var2}\PYG{p}{,} \PYG{n}{operand}\PYG{p}{,} \PYG{n}{deviation}\PYG{p}{,} \PYG{n}{weight}\PYG{p}{)} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{ctr}\PYG{p}{:}
	\PYG{n}{ListConstraints} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
	\PYG{k}{for} \PYG{n}{a} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{dom}\PYG{p}{[}\PYG{n}{data}\PYG{o}{.}\PYG{n}{Domain}\PYG{p}{[}\PYG{n}{var1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{:}
		\PYG{k}{for} \PYG{n}{b} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{dom}\PYG{p}{[}\PYG{n}{data}\PYG{o}{.}\PYG{n}{Domain}\PYG{p}{[}\PYG{n}{var2}\PYG{p}{]}\PYG{p}{]}\PYG{p}{:}
			\PYG{k}{if} \PYG{p}{(}\PYG{p}{(}\PYG{n}{operand}\PYG{o}{==}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZgt{}}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o+ow}{and} \PYG{n+nb}{abs}\PYG{p}{(}\PYG{n}{a} \PYG{o}{\PYGZhy{}} \PYG{n}{b}\PYG{p}{)} \PYG{o}{\PYGZgt{}} \PYG{n}{deviation}\PYG{p}{)} \PYG{o+ow}{or} \PYG{p}{(}\PYG{n}{operand}\PYG{o}{==}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{=}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o+ow}{and} \PYG{n+nb}{abs}\PYG{p}{(}\PYG{n}{a} \PYG{o}{\PYGZhy{}} \PYG{n}{b}\PYG{p}{)} \PYG{o}{==} \PYG{n}{deviation}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
				\PYG{n}{ListConstraints}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
			\PYG{k}{else}\PYG{p}{:}
				\PYG{n}{ListConstraints}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{data}\PYG{o}{.}\PYG{n}{cost}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{a}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{weight}\PYG{p}{)}\PYG{p}{,}\PYG{n}{top}\PYG{p}{)}\PYG{p}{)}
	\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{link}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{var1}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{link}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{var2}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ListConstraints}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}unary hard and soft constraints}
\PYG{k}{for} \PYG{n}{e} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{var}\PYG{p}{:}
	\PYG{k}{if} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{e}\PYG{p}{)} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{l+m+mi}{3}\PYG{p}{:} 
		\PYG{n}{ListConstraints} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
		\PYG{k}{for} \PYG{n}{a} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{dom}\PYG{p}{[}\PYG{n}{e}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{:}
			\PYG{k}{if} \PYG{n}{a} \PYG{o}{==} \PYG{n}{e}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{:}
				\PYG{n}{ListConstraints}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
			\PYG{k}{else}\PYG{p}{:}
				\PYG{n}{ListConstraints}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{data}\PYG{o}{.}\PYG{n}{cost}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{e}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{n}{top}\PYG{p}{)}\PYG{p}{)}
		\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{link}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{e}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ListConstraints}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}Problem.Dump(\PYGZsq{}Rflap.cfn\PYGZsq{})}
\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{CFN}\PYG{o}{.}\PYG{n}{timer}\PYG{p}{(}\PYG{l+m+mi}{300}\PYG{p}{)}
\PYG{n}{res} \PYG{o}{=} \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{Solve}\PYG{p}{(}\PYG{n}{showSolutions}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{k}{if} \PYG{n}{res}\PYG{p}{:}
	\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Best solution found with cost:}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{in}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{GetNbNodes}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{search nodes.}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
\PYG{k}{else}\PYG{p}{:}
	\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sorry, no solution found!}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\end{sphinxVerbatim}

\sphinxstepscope


\section{Frequency assignment problem with polarization}
\label{\detokenize{examples/tuto_fapwp:frequency-assignment-problem-with-polarization}}\label{\detokenize{examples/tuto_fapwp:tuto-fapwp}}\label{\detokenize{examples/tuto_fapwp::doc}}



\subsection{Brief description}
\label{\detokenize{examples/tuto_fapwp:brief-description}}
\sphinxAtStartPar
The previously\sphinxhyphen{}described {\hyperref[\detokenize{examples/tuto_rlfap:tuto-rlfap}]{\sphinxcrossref{\DUrole{std,std-ref}{Radio link frequency assignment problem}}}} has been extended to take into account polarization constraints and user\sphinxhyphen{}defined relaxation of electromagnetic compatibility constraints. The problem is to assign a pair (frequency,polarization) to every radio communication link (also called a path). Frequencies are integer values taken in finite domains. Polarizations are in \{\sphinxhyphen{}1,1\}. Constraints are :
\begin{itemize}
\item {} 
\sphinxAtStartPar
(I) two paths must use equal or different frequencies (\sphinxtitleref{f\_i=f\_j} or \sphinxtitleref{f\_i\textless{}\textgreater{}f\_j}),

\item {} 
\sphinxAtStartPar
(II) the absolute difference between two frequencies should exactly be equal or different to a given number e (\sphinxtitleref{|f\_i\sphinxhyphen{}f\_j|=e} or \sphinxtitleref{|f\_i\sphinxhyphen{}f\_j|\textless{}\textgreater{}e}),

\item {} 
\sphinxAtStartPar
(III) two paths must use equal or different polarizations (\sphinxtitleref{p\_i=p\_j} or \sphinxtitleref{p\_i\textless{}\textgreater{}p\_j}),

\item {} 
\sphinxAtStartPar
(IV) the absolute difference between two frequencies should be greater at a relaxation level l (0 to 10) than a given number g\_l (resp. d\_l) if polarization are equal (resp. different)  (\sphinxtitleref{|f\_i\sphinxhyphen{}f\_j|\textgreater{}=g\_l} if \sphinxtitleref{p\_i=p\_j} else \sphinxtitleref{|f\_i\sphinxhyphen{}f\_j|\textgreater{}=d\_l}), with \sphinxtitleref{g\_(l\sphinxhyphen{}1)\textgreater{}g\_l}, \sphinxtitleref{d\_(l\sphinxhyphen{}1)\textgreater{}d\_l}, and usually \sphinxtitleref{g\_l\textgreater{}d\_l}.

\end{itemize}

\sphinxAtStartPar
Constraints (I) to (III) are mandatory constraints, while constraints (IV) can be relaxed. The goal is to find a feasible assignment with the smallest relaxation level l and which minimizes the (weighted) number of violations of (IV) at lower levels. See \sphinxcode{\sphinxupquote{ROADEF\_Challenge\_2001}} .

\sphinxAtStartPar
The cost of a given solution will be calculated by the following formula: 10*k*nbsoft**2 + 10*nbsoft*V(k\sphinxhyphen{}1) + V(k\sphinxhyphen{}2) + V(k\sphinxhyphen{}3    ) + … + V0

\sphinxAtStartPar
where  nbsoft is the number of soft constraints in the problem and k the feasible relaxation level and V(i) the number of violated contraints of level i.

\noindent\sphinxincludegraphics[height=250\sphinxpxdimen]{{fapp}.png}


\subsection{CFN model}
\label{\detokenize{examples/tuto_fapwp:cfn-model}}
\sphinxAtStartPar
We create a single variable to represent a pair (frequency,polarization) for every radio link, but be aware, toulbar2 can only read str or int values, so in order to give a tuple to toulbar2 we need to first transform them into string. We use hard binary constraints to modelize (I) to (III) type constraints.

\sphinxAtStartPar
We assume the relaxation level k is given as input. In order to modelize (IV) type constraints we first take in argument the level of relaxation i, and we create 11 constraints, one for each relaxation level from 0 to 10. The first k\sphinxhyphen{}2 constraints are soft and with a violation cost of 1.
The soft constraint at level k\sphinxhyphen{}1 has a violation cost 10*nbsoft (the number of soft constraints) in order to maximize first the number of satisfied constraints at level k\sphinxhyphen{}1 and then the other soft constraints.
The constraints at levels k to 10 are hard constraints.

\sphinxAtStartPar
The initial upper bound of the problem will be 10*(k+1)*nbsoft**2 +1.


\subsection{Data}
\label{\detokenize{examples/tuto_fapwp:data}}
\sphinxAtStartPar
Original data files can be download from \sphinxhref{https://www.roadef.org/challenge/2001/en/sujet.php}{ROADEF} or \sphinxhref{https://forgemia.inra.fr/thomas.schiex/cost-function-library/tree/master/crafted/fapp/data}{fapp}. Their format is described \sphinxhref{https://www.roadef.org/challenge/2001/files/fapp\_roadef01\_rev2\_msword\_en.ps.gz}{here}. You can try a small example \sphinxcode{\sphinxupquote{exemple1.in}} (resp. \sphinxcode{\sphinxupquote{exemple2.in}}) with optimum 523 at relaxation level 3 with 1 violation at level 2 and 3 below (resp. 13871 at level 7 with 1 violation at level 6 and 11 below). See ROADEF Challenge 2001 \sphinxhref{https://uma.ensta-paris.fr/conf/roadef-2001-challenge/distrib/RES\_X/ResultatsComplets.xls}{results}.


\subsection{Python model}
\label{\detokenize{examples/tuto_fapwp:python-model}}
\sphinxAtStartPar
The following code solves the corresponding cost function network using the pytoulbar2 library and needs 4 arguments: the data file and the relaxation level (e.g. “python3 fapp.py exemple1.in 3”). You can also compile \sphinxcode{\sphinxupquote{fappeval.c}} using “gcc \sphinxhyphen{}o fappeval fappeval.c” and download \sphinxcode{\sphinxupquote{sol2fapp.awk}} in order to evaluate the solutions (e.g., “python3 fapp.py exemple1.in 3 | awk \sphinxhyphen{}f ./sol2fapp.awk \sphinxhyphen{} exemple1”).

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{fapp.py}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{sys}
\PYG{k+kn}{import} \PYG{n+nn}{pytoulbar2}

\PYG{k}{class} \PYG{n+nc}{Data}\PYG{p}{:}
	\PYG{k}{def} \PYG{n+nf+fm}{\PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{filename}\PYG{p}{,} \PYG{n}{k}\PYG{p}{)}\PYG{p}{:}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{var} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{p}{\PYGZcb{}}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{dom} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{p}{\PYGZcb{}}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{ctr} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{p}{)}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{softeq} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{p}{)}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{softne} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{p}{)}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{nbsoft} \PYG{o}{=} \PYG{l+m+mi}{0}

		\PYG{n}{stream} \PYG{o}{=} \PYG{n+nb}{open}\PYG{p}{(}\PYG{n}{filename}\PYG{p}{)}
		\PYG{k}{for} \PYG{n}{line} \PYG{o+ow}{in} \PYG{n}{stream}\PYG{p}{:}
			\PYG{k}{if} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{o}{==}\PYG{l+m+mi}{3} \PYG{o+ow}{and} \PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{==}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{DM}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:}
				\PYG{p}{(}\PYG{n}{DM}\PYG{p}{,} \PYG{n}{dom}\PYG{p}{,} \PYG{n}{freq}\PYG{p}{)} \PYG{o}{=} \PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{l+m+mi}{3}\PYG{p}{]}
				\PYG{k}{if} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{dom}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{dom}\PYG{p}{)}\PYG{p}{)} \PYG{o+ow}{is} \PYG{k+kc}{None}\PYG{p}{:}
					\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{dom}\PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{dom}\PYG{p}{)}\PYG{p}{]} \PYG{o}{=} \PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{freq}\PYG{p}{)}\PYG{p}{]}
				\PYG{k}{else}\PYG{p}{:}
					\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{dom}\PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{dom}\PYG{p}{)}\PYG{p}{]}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{freq}\PYG{p}{)}\PYG{p}{)}

			\PYG{k}{if} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)} \PYG{o}{==} \PYG{l+m+mi}{4} \PYG{o+ow}{and} \PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{==}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{TR}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:}
				\PYG{p}{(}\PYG{n}{TR}\PYG{p}{,} \PYG{n}{route}\PYG{p}{,} \PYG{n}{dom}\PYG{p}{,} \PYG{n}{polarisation}\PYG{p}{)} \PYG{o}{=} \PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{l+m+mi}{4}\PYG{p}{]}
				\PYG{k}{if} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{polarisation}\PYG{p}{)} \PYG{o}{==} \PYG{l+m+mi}{0}\PYG{p}{:}
					\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{var}\PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{route}\PYG{p}{)}\PYG{p}{]} \PYG{o}{=} \PYG{p}{[}\PYG{p}{(}\PYG{n}{f}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)} \PYG{k}{for} \PYG{n}{f} \PYG{o+ow}{in} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{dom}\PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{dom}\PYG{p}{)}\PYG{p}{]}\PYG{p}{]} \PYG{o}{+} \PYG{p}{[}\PYG{p}{(}\PYG{n}{f}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)} \PYG{k}{for} \PYG{n}{f} \PYG{o+ow}{in} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{dom}\PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{dom}\PYG{p}{)}\PYG{p}{]}\PYG{p}{]}
				\PYG{k}{if} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{polarisation}\PYG{p}{)} \PYG{o}{==} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{:}
					\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{var}\PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{route}\PYG{p}{)}\PYG{p}{]} \PYG{o}{=} \PYG{p}{[}\PYG{p}{(}\PYG{n}{f}\PYG{p}{,}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)} \PYG{k}{for} \PYG{n}{f} \PYG{o+ow}{in} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{dom}\PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{dom}\PYG{p}{)}\PYG{p}{]}\PYG{p}{]} 
				\PYG{k}{if} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{polarisation}\PYG{p}{)} \PYG{o}{==} \PYG{l+m+mi}{1}\PYG{p}{:}
					\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{var}\PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{route}\PYG{p}{)}\PYG{p}{]} \PYG{o}{=} \PYG{p}{[}\PYG{p}{(}\PYG{n}{f}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)} \PYG{k}{for} \PYG{n}{f} \PYG{o+ow}{in} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{dom}\PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{dom}\PYG{p}{)}\PYG{p}{]}\PYG{p}{]}

			\PYG{k}{if} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{o}{==}\PYG{l+m+mi}{6} \PYG{o+ow}{and} \PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{==}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{CI}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:}
				\PYG{p}{(}\PYG{n}{CI}\PYG{p}{,} \PYG{n}{route1}\PYG{p}{,} \PYG{n}{route2}\PYG{p}{,} \PYG{n}{vartype}\PYG{p}{,} \PYG{n}{operator}\PYG{p}{,} \PYG{n}{deviation}\PYG{p}{)} \PYG{o}{=} \PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{l+m+mi}{6}\PYG{p}{]}
				\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{ctr}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{route1}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{route2}\PYG{p}{)}\PYG{p}{,} \PYG{n}{vartype}\PYG{p}{,} \PYG{n}{operator}\PYG{p}{,} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{deviation}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}

			\PYG{k}{if} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{o}{==}\PYG{l+m+mi}{14} \PYG{o+ow}{and} \PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{==}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{CE}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:}
				\PYG{p}{(}\PYG{n}{CE}\PYG{p}{,} \PYG{n}{route1}\PYG{p}{,} \PYG{n}{route2}\PYG{p}{,} \PYG{n}{s0}\PYG{p}{,} \PYG{n}{s1}\PYG{p}{,} \PYG{n}{s2}\PYG{p}{,} \PYG{n}{s3}\PYG{p}{,} \PYG{n}{s4}\PYG{p}{,} \PYG{n}{s5}\PYG{p}{,} \PYG{n}{s6}\PYG{p}{,} \PYG{n}{s7}\PYG{p}{,} \PYG{n}{s8}\PYG{p}{,} \PYG{n}{s9}\PYG{p}{,} \PYG{n}{s10}\PYG{p}{)} \PYG{o}{=} \PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{l+m+mi}{14}\PYG{p}{]}
				\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{softeq}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{route1}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{route2}\PYG{p}{)}\PYG{p}{,} \PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{s}\PYG{p}{)} \PYG{k}{for} \PYG{n}{s} \PYG{o+ow}{in} \PYG{p}{[}\PYG{n}{s0}\PYG{p}{,} \PYG{n}{s1}\PYG{p}{,} \PYG{n}{s2}\PYG{p}{,} \PYG{n}{s3}\PYG{p}{,} \PYG{n}{s4}\PYG{p}{,} \PYG{n}{s5}\PYG{p}{,} \PYG{n}{s6}\PYG{p}{,} \PYG{n}{s7}\PYG{p}{,} \PYG{n}{s8}\PYG{p}{,} \PYG{n}{s9}\PYG{p}{,} \PYG{n}{s10}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
				\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{nbsoft} \PYG{o}{+}\PYG{o}{=} \PYG{l+m+mi}{1}

			\PYG{k}{if} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{o}{==}\PYG{l+m+mi}{14} \PYG{o+ow}{and} \PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{==}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{CD}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{:}
				\PYG{p}{(}\PYG{n}{CD}\PYG{p}{,} \PYG{n}{route1}\PYG{p}{,} \PYG{n}{route2}\PYG{p}{,} \PYG{n}{s0}\PYG{p}{,} \PYG{n}{s1}\PYG{p}{,} \PYG{n}{s2}\PYG{p}{,} \PYG{n}{s3}\PYG{p}{,} \PYG{n}{s4}\PYG{p}{,} \PYG{n}{s5}\PYG{p}{,} \PYG{n}{s6}\PYG{p}{,} \PYG{n}{s7}\PYG{p}{,} \PYG{n}{s8}\PYG{p}{,} \PYG{n}{s9}\PYG{p}{,} \PYG{n}{s10}\PYG{p}{)} \PYG{o}{=} \PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{l+m+mi}{14}\PYG{p}{]}
				\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{softne}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{route1}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{route2}\PYG{p}{)}\PYG{p}{,} \PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{s}\PYG{p}{)} \PYG{k}{for} \PYG{n}{s} \PYG{o+ow}{in} \PYG{p}{[}\PYG{n}{s0}\PYG{p}{,} \PYG{n}{s1}\PYG{p}{,} \PYG{n}{s2}\PYG{p}{,} \PYG{n}{s3}\PYG{p}{,} \PYG{n}{s4}\PYG{p}{,} \PYG{n}{s5}\PYG{p}{,} \PYG{n}{s6}\PYG{p}{,} \PYG{n}{s7}\PYG{p}{,} \PYG{n}{s8}\PYG{p}{,} \PYG{n}{s9}\PYG{p}{,} \PYG{n}{s10}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}

		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{top} \PYG{o}{=} \PYG{l+m+mi}{10}\PYG{o}{*}\PYG{p}{(}\PYG{n}{k}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{o}{*}\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{nbsoft}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2} \PYG{o}{+} \PYG{l+m+mi}{1}        

\PYG{k}{if} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{)} \PYG{o}{\PYGZlt{}} \PYG{l+m+mi}{2}\PYG{p}{:}
	\PYG{n}{exit}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Command line argument is composed of the problem data filename and the relaxation level}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{k} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}collect data}
\PYG{n}{data} \PYG{o}{=} \PYG{n}{Data}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{k}\PYG{p}{)}

\PYG{n}{Problem} \PYG{o}{=} \PYG{n}{pytoulbar2}\PYG{o}{.}\PYG{n}{CFN}\PYG{p}{(}\PYG{n}{data}\PYG{o}{.}\PYG{n}{top}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}create a variable for each link}
\PYG{k}{for} \PYG{n}{e} \PYG{o+ow}{in} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n}{data}\PYG{o}{.}\PYG{n}{var}\PYG{o}{.}\PYG{n}{keys}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
	\PYG{n}{domain} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
	\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{var}\PYG{p}{[}\PYG{n}{e}\PYG{p}{]}\PYG{p}{:}
		\PYG{n}{domain}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{)}
	\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddVariable}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{e}\PYG{p}{)}\PYG{p}{,} \PYG{n}{domain}\PYG{p}{)}
	
\PYG{c+c1}{\PYGZsh{}hard binary constraints}
\PYG{k}{for} \PYG{p}{(}\PYG{n}{route1}\PYG{p}{,} \PYG{n}{route2}\PYG{p}{,} \PYG{n}{vartype}\PYG{p}{,} \PYG{n}{operand}\PYG{p}{,} \PYG{n}{deviation}\PYG{p}{)} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{ctr}\PYG{p}{:}
	\PYG{n}{Constraint} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
	\PYG{k}{for} \PYG{p}{(}\PYG{n}{f1}\PYG{p}{,}\PYG{n}{p1}\PYG{p}{)} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{var}\PYG{p}{[}\PYG{n}{route1}\PYG{p}{]}\PYG{p}{:}
	 	\PYG{k}{for} \PYG{p}{(}\PYG{n}{f2}\PYG{p}{,}\PYG{n}{p2}\PYG{p}{)} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{var}\PYG{p}{[}\PYG{n}{route2}\PYG{p}{]}\PYG{p}{:}
	 		\PYG{k}{if} \PYG{n}{vartype} \PYG{o}{==} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{F}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}
	 			\PYG{k}{if} \PYG{n}{operand} \PYG{o}{==} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{E}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}
	 				\PYG{k}{if} \PYG{n+nb}{abs}\PYG{p}{(}\PYG{n}{f2} \PYG{o}{\PYGZhy{}} \PYG{n}{f1}\PYG{p}{)} \PYG{o}{==} \PYG{n}{deviation}\PYG{p}{:}
	 					\PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
	 				\PYG{k}{else}\PYG{p}{:}
	 					\PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{data}\PYG{o}{.}\PYG{n}{top}\PYG{p}{)}
	 			\PYG{k}{else}\PYG{p}{:}
	 				\PYG{k}{if} \PYG{n+nb}{abs}\PYG{p}{(}\PYG{n}{f2} \PYG{o}{\PYGZhy{}} \PYG{n}{f1}\PYG{p}{)} \PYG{o}{!=} \PYG{n}{deviation}\PYG{p}{:}
	 					\PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
	 				\PYG{k}{else}\PYG{p}{:}
	 					\PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{data}\PYG{o}{.}\PYG{n}{top}\PYG{p}{)}
	 		\PYG{k}{else}\PYG{p}{:}
	 			\PYG{k}{if} \PYG{n}{operand} \PYG{o}{==} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{E}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}
	 				\PYG{k}{if} \PYG{n}{p2} \PYG{o}{==} \PYG{n}{p1}\PYG{p}{:}
	 					\PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
	 				\PYG{k}{else}\PYG{p}{:}
	 					\PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{data}\PYG{o}{.}\PYG{n}{top}\PYG{p}{)}
	 			\PYG{k}{else}\PYG{p}{:}
	 				\PYG{k}{if} \PYG{n}{p2} \PYG{o}{!=} \PYG{n}{p1}\PYG{p}{:}
	 					\PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
	 				\PYG{k}{else}\PYG{p}{:}
	 					\PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{data}\PYG{o}{.}\PYG{n}{top}\PYG{p}{)}
	\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{route1}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{route2}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{n}{Constraint}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{}soft binary constraints for equal polarization}
\PYG{k}{for} \PYG{p}{(}\PYG{n}{route1}\PYG{p}{,} \PYG{n}{route2}\PYG{p}{,} \PYG{n}{deviations}\PYG{p}{)} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{softeq}\PYG{p}{:}
	\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{11}\PYG{p}{)}\PYG{p}{:}
		\PYG{n}{ListConstraints} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
		\PYG{k}{for} \PYG{p}{(}\PYG{n}{f1}\PYG{p}{,}\PYG{n}{p1}\PYG{p}{)} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{var}\PYG{p}{[}\PYG{n}{route1}\PYG{p}{]}\PYG{p}{:}
			\PYG{k}{for} \PYG{p}{(}\PYG{n}{f2}\PYG{p}{,}\PYG{n}{p2}\PYG{p}{)} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{var}\PYG{p}{[}\PYG{n}{route2}\PYG{p}{]}\PYG{p}{:}
	 			\PYG{k}{if} \PYG{n}{p1}\PYG{o}{!=}\PYG{n}{p2} \PYG{o+ow}{or} \PYG{n+nb}{abs}\PYG{p}{(}\PYG{n}{f1} \PYG{o}{\PYGZhy{}} \PYG{n}{f2}\PYG{p}{)} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{n}{deviations}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{:}
	 				\PYG{n}{ListConstraints}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
	 			\PYG{k}{elif} \PYG{n}{i} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{n}{k}\PYG{p}{:}
	 				\PYG{n}{ListConstraints}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{data}\PYG{o}{.}\PYG{n}{top}\PYG{p}{)}
	 			\PYG{k}{elif} \PYG{n}{i} \PYG{o}{==} \PYG{n}{k}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{:}
	 				\PYG{n}{ListConstraints}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{o}{*}\PYG{n}{data}\PYG{o}{.}\PYG{n}{nbsoft}\PYG{p}{)}
	 			\PYG{k}{else}\PYG{p}{:}
	 				\PYG{n}{ListConstraints}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
		\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{route1}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{route2}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ListConstraints}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{}soft binary constraints for not equal polarization}
\PYG{k}{for} \PYG{p}{(}\PYG{n}{route1}\PYG{p}{,} \PYG{n}{route2}\PYG{p}{,} \PYG{n}{deviations}\PYG{p}{)} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{softne}\PYG{p}{:}
	\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{11}\PYG{p}{)}\PYG{p}{:}
		\PYG{n}{ListConstraints} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
		\PYG{k}{for} \PYG{p}{(}\PYG{n}{f1}\PYG{p}{,}\PYG{n}{p1}\PYG{p}{)} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{var}\PYG{p}{[}\PYG{n}{route1}\PYG{p}{]}\PYG{p}{:}
	 		\PYG{k}{for} \PYG{p}{(}\PYG{n}{f2}\PYG{p}{,}\PYG{n}{p2}\PYG{p}{)} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{var}\PYG{p}{[}\PYG{n}{route2}\PYG{p}{]}\PYG{p}{:}
	 			\PYG{k}{if} \PYG{n}{p1}\PYG{o}{==}\PYG{n}{p2} \PYG{o+ow}{or} \PYG{n+nb}{abs}\PYG{p}{(}\PYG{n}{f1} \PYG{o}{\PYGZhy{}} \PYG{n}{f2}\PYG{p}{)} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{n}{deviations}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{:}
	 				\PYG{n}{ListConstraints}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
	 			\PYG{k}{elif} \PYG{n}{i} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{n}{k}\PYG{p}{:}
	 				\PYG{n}{ListConstraints}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{data}\PYG{o}{.}\PYG{n}{top}\PYG{p}{)}
	 			\PYG{k}{elif} \PYG{n}{i} \PYG{o}{==} \PYG{n}{k}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{:}
	 				\PYG{n}{ListConstraints}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{o}{*}\PYG{n}{data}\PYG{o}{.}\PYG{n}{nbsoft}\PYG{p}{)}
	 			\PYG{k}{else}\PYG{p}{:}
	 				\PYG{n}{ListConstraints}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
		\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{route1}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{X}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{route2}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ListConstraints}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}zero\PYGZhy{}arity cost function representing a constant cost corresponding to the relaxation at level k}
\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{p}{]}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{o}{*}\PYG{n}{k}\PYG{o}{*}\PYG{n}{data}\PYG{o}{.}\PYG{n}{nbsoft}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}Problem.Dump(\PYGZsq{}Fapp.cfn\PYGZsq{})}
\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{CFN}\PYG{o}{.}\PYG{n}{timer}\PYG{p}{(}\PYG{l+m+mi}{900}\PYG{p}{)}
\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{Solve}\PYG{p}{(}\PYG{n}{showSolutions}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{)}

\end{sphinxVerbatim}

\sphinxstepscope


\section{Mendelian error detection problem}
\label{\detokenize{examples/tuto_medp:mendelian-error-detection-problem}}\label{\detokenize{examples/tuto_medp:tuto-medp}}\label{\detokenize{examples/tuto_medp::doc}}



\subsection{Brief description}
\label{\detokenize{examples/tuto_medp:brief-description}}
\sphinxAtStartPar
The problem is to detect marker genotyping incompatibilities (Mendelian errors) in complex pedigrees.
The input is a pedigree data with partial observed genotyping data at a single locus, we assume the pedigree to be exact, but not the genotyping data.
The problem is to assign genotypes (unordered pairs of alleles) to all individuals such that they are compatible with the Mendelian law of heredity (one allele is the same as their father’s and one as their mother’s). The goal is to maximize the number of matching allelle between the genotyping data and the solution. Each difference from the genotyping data has a cost of 1.

\sphinxAtStartPar
\sphinxhref{https://miat.inrae.fr/degivry/Sanchez07a.pdf}{Sanchez, M., de Givry, S. and Schiex, T. Constraints (2008) 13:130}.


\subsection{CFN model}
\label{\detokenize{examples/tuto_medp:cfn-model}}
\sphinxAtStartPar
We create N variables, one for each individual genotype with domain being all possible unordered pairs of existing alleles.
Hard ternary cost functions express mendelian law of heredity (one allele is the same as their father’s and one as their mother’s, with mother and father defined in the pedigree data).
For each genotyping data, we create one unary soft constraint with violation cost equal to 1 to represent the matching between the genotyping data and the solution.


\subsection{Data}
\label{\detokenize{examples/tuto_medp:data}}
\sphinxAtStartPar
Original data files can be download from the cost function library \sphinxhref{https://forgemia.inra.fr/thomas.schiex/cost-function-library/tree/master/real/pedigree/data/pre}{pedigree}. Their format is described \sphinxhref{http://miat.inrae.fr/MendelSoft}{here}. You can try a small example simple.pre (\sphinxcode{\sphinxupquote{simple.pre}}) with optimum value equal to 1.


\subsection{Python model}
\label{\detokenize{examples/tuto_medp:python-model}}
\sphinxAtStartPar
The following code solves the corresponding cost function network using the pytoulbar2 library (e.g. “python3 mendel.py simple.pre”).

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{mendel.py}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{sys}
\PYG{k+kn}{import} \PYG{n+nn}{pytoulbar2}

\PYG{k}{class} \PYG{n+nc}{Data}\PYG{p}{:}
	\PYG{k}{def} \PYG{n+nf+fm}{\PYGZus{}\PYGZus{}init\PYGZus{}\PYGZus{}}\PYG{p}{(}\PYG{n+nb+bp}{self}\PYG{p}{,} \PYG{n}{ped}\PYG{p}{)}\PYG{p}{:}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{id} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{p}{)}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{father} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{p}{\PYGZcb{}}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{mother} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{p}{\PYGZcb{}}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{allelesId} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{p}{\PYGZcb{}}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{ListAlle} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{p}{)}
		\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{obs} \PYG{o}{=} \PYG{l+m+mi}{0}

		\PYG{n}{stream} \PYG{o}{=} \PYG{n+nb}{open}\PYG{p}{(}\PYG{n}{ped}\PYG{p}{)}
		\PYG{k}{for} \PYG{n}{line} \PYG{o+ow}{in} \PYG{n}{stream}\PYG{p}{:}
			\PYG{p}{(}\PYG{n}{locus}\PYG{p}{,} \PYG{n+nb}{id}\PYG{p}{,} \PYG{n}{father}\PYG{p}{,} \PYG{n}{mother}\PYG{p}{,} \PYG{n}{sex}\PYG{p}{,} \PYG{n}{allele1}\PYG{p}{,} \PYG{n}{allele2}\PYG{p}{)} \PYG{o}{=} \PYG{n}{line}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}\PYG{p}{[}\PYG{p}{:}\PYG{p}{]}
			\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{id}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n+nb}{id}\PYG{p}{)}\PYG{p}{)}
			\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{father}\PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n+nb}{id}\PYG{p}{)}\PYG{p}{]} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{father}\PYG{p}{)}
			\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{mother}\PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n+nb}{id}\PYG{p}{)}\PYG{p}{]} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{mother}\PYG{p}{)}
			\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{allelesId}\PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n+nb}{id}\PYG{p}{)}\PYG{p}{]} \PYG{o}{=} \PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{allele1}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{allele2}\PYG{p}{)}\PYG{p}{)} \PYG{k}{if} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{allele1}\PYG{p}{)} \PYG{o}{\PYGZlt{}} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{allele2}\PYG{p}{)} \PYG{k}{else} \PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{allele2}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{allele1}\PYG{p}{)}\PYG{p}{)}
			\PYG{k}{if} \PYG{o+ow}{not}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{allele1}\PYG{p}{)} \PYG{o+ow}{in} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{ListAlle}\PYG{p}{)} \PYG{o+ow}{and} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{allele1}\PYG{p}{)} \PYG{o}{!=} \PYG{l+m+mi}{0}\PYG{p}{:}
				\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{ListAlle}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{allele1}\PYG{p}{)}\PYG{p}{)}
			\PYG{k}{if} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{allele2}\PYG{p}{)} \PYG{o}{!=} \PYG{l+m+mi}{0} \PYG{o+ow}{and} \PYG{o+ow}{not}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{allele2}\PYG{p}{)} \PYG{o+ow}{in} \PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{ListAlle}\PYG{p}{)}\PYG{p}{:}
				\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{ListAlle}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{allele2}\PYG{p}{)}\PYG{p}{)}
			\PYG{k}{if} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{allele1}\PYG{p}{)} \PYG{o}{!=} \PYG{l+m+mi}{0} \PYG{o+ow}{or} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{allele2}\PYG{p}{)} \PYG{o}{!=} \PYG{l+m+mi}{0}\PYG{p}{:}
				\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{obs} \PYG{o}{+}\PYG{o}{=} \PYG{l+m+mi}{1}

\PYG{c+c1}{\PYGZsh{}collect data}
\PYG{n}{data} \PYG{o}{=} \PYG{n}{Data}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{top} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{data}\PYG{o}{.}\PYG{n}{obs}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}

\PYG{n}{Problem} \PYG{o}{=} \PYG{n}{pytoulbar2}\PYG{o}{.}\PYG{n}{CFN}\PYG{p}{(}\PYG{n}{top}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}create a variable for each individual}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{id}\PYG{p}{:}
	\PYG{n}{domains} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
	\PYG{k}{for} \PYG{n}{a1} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{ListAlle}\PYG{p}{:}
		\PYG{k}{for} \PYG{n}{a2} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{ListAlle}\PYG{p}{:}
			\PYG{k}{if} \PYG{n}{a1} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{a2}\PYG{p}{:}
				\PYG{n}{domains}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{a1}\PYG{p}{)}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{a2}\PYG{p}{)}\PYG{p}{)}
	\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{g}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)} \PYG{p}{,} \PYG{n}{domains}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}create the constraints that represent the mendel\PYGZsq{}s laws}
\PYG{n}{ListConstraintsMendelLaw} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{p1} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{ListAlle}\PYG{p}{:}
	\PYG{k}{for} \PYG{n}{p2} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{ListAlle}\PYG{p}{:}
		\PYG{k}{if} \PYG{n}{p1} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{p2}\PYG{p}{:}	\PYG{c+c1}{\PYGZsh{} father alleles}
			\PYG{k}{for} \PYG{n}{m1} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{ListAlle}\PYG{p}{:}
				\PYG{k}{for} \PYG{n}{m2} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{ListAlle}\PYG{p}{:}
					\PYG{k}{if} \PYG{n}{m1} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{m2}\PYG{p}{:}	\PYG{c+c1}{\PYGZsh{} mother alleles}
						\PYG{k}{for} \PYG{n}{a1} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{ListAlle}\PYG{p}{:}
							\PYG{k}{for} \PYG{n}{a2} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{ListAlle}\PYG{p}{:}
								\PYG{k}{if} \PYG{n}{a1} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{a2}\PYG{p}{:}	\PYG{c+c1}{\PYGZsh{} child alleles}
									\PYG{k}{if} \PYG{p}{(}\PYG{n}{a1} \PYG{o+ow}{in} \PYG{p}{(}\PYG{n}{p1}\PYG{p}{,}\PYG{n}{p2}\PYG{p}{)} \PYG{o+ow}{and} \PYG{n}{a2} \PYG{o+ow}{in} \PYG{p}{(}\PYG{n}{m1}\PYG{p}{,}\PYG{n}{m2}\PYG{p}{)}\PYG{p}{)} \PYG{o+ow}{or} \PYG{p}{(}\PYG{n}{a2} \PYG{o+ow}{in} \PYG{p}{(}\PYG{n}{p1}\PYG{p}{,}\PYG{n}{p2}\PYG{p}{)} \PYG{o+ow}{and} \PYG{n}{a1} \PYG{o+ow}{in} \PYG{p}{(}\PYG{n}{m1}\PYG{p}{,}\PYG{n}{m2}\PYG{p}{)}\PYG{p}{)} \PYG{p}{:}
										\PYG{n}{ListConstraintsMendelLaw}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
									\PYG{k}{else} \PYG{p}{:}
									 	\PYG{n}{ListConstraintsMendelLaw}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{top}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{id}\PYG{p}{:}
	\PYG{c+c1}{\PYGZsh{}ternary constraints representing mendel\PYGZsq{}s laws}
	\PYG{k}{if} \PYG{n}{data}\PYG{o}{.}\PYG{n}{father}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{i}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)} \PYG{o}{!=} \PYG{l+m+mi}{0} \PYG{o+ow}{and} \PYG{n}{data}\PYG{o}{.}\PYG{n}{mother}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{i}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{)} \PYG{o}{!=} \PYG{l+m+mi}{0}\PYG{p}{:}
		\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{g}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{data}\PYG{o}{.}\PYG{n}{father}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{g}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(} \PYG{n}{data}\PYG{o}{.}\PYG{n}{mother}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{g}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ListConstraintsMendelLaw}\PYG{p}{)}
		
	\PYG{c+c1}{\PYGZsh{}unary constraints linked to the observations}
	\PYG{k}{if} \PYG{n}{data}\PYG{o}{.}\PYG{n}{allelesId}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{!=} \PYG{l+m+mi}{0} \PYG{o+ow}{and} \PYG{n}{data}\PYG{o}{.}\PYG{n}{allelesId}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{!=} \PYG{l+m+mi}{0}\PYG{p}{:}
		\PYG{n}{ListConstraintsObservation} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
		\PYG{k}{for} \PYG{n}{a1} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{ListAlle}\PYG{p}{:}
			\PYG{k}{for} \PYG{n}{a2} \PYG{o+ow}{in} \PYG{n}{data}\PYG{o}{.}\PYG{n}{ListAlle}\PYG{p}{:}
				\PYG{k}{if} \PYG{n}{a1} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{a2}\PYG{p}{:}
					\PYG{k}{if} \PYG{p}{(}\PYG{n}{a1}\PYG{p}{,}\PYG{n}{a2}\PYG{p}{)} \PYG{o}{==} \PYG{n}{data}\PYG{o}{.}\PYG{n}{allelesId}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{:}
						\PYG{n}{ListConstraintsObservation}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
					\PYG{k}{else} \PYG{p}{:}
					 	\PYG{n}{ListConstraintsObservation}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
		\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{g}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ListConstraintsObservation}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}Problem.Dump(\PYGZsq{}Mendel.cfn\PYGZsq{})}
\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{CFN}\PYG{o}{.}\PYG{n}{timer}\PYG{p}{(}\PYG{l+m+mi}{300}\PYG{p}{)}
\PYG{n}{res} \PYG{o}{=} \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{Solve}\PYG{p}{(}\PYG{n}{showSolutions}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{k}{if} \PYG{n}{res}\PYG{p}{:}
	\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{There are}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{difference(s) between the solution and the observation.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{k}{else}\PYG{p}{:}
	\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{No solution found}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxstepscope


\section{Block modeling problem}
\label{\detokenize{examples/tuto_bmp:block-modeling-problem}}\label{\detokenize{examples/tuto_bmp:tuto-bmp}}\label{\detokenize{examples/tuto_bmp::doc}}



\subsection{Brief description}
\label{\detokenize{examples/tuto_bmp:brief-description}}
\sphinxAtStartPar
This is a clustering problem, occuring in social network analysis.

\sphinxAtStartPar
The problem is to divide a given directed graph G into k clusters such that the interactions between clusters can be summarized by a k*k 0/1 matrix M: if M{[}i,j{]}=1 then all the nodes in cluster i should be connected to all the nodes in cluster j in G, else if M{[}i,j{]}=0 then there should be no edge in G between the nodes from the two clusters.

\sphinxAtStartPar
For example, the following graph G is composed of 4 nodes:

\noindent\sphinxincludegraphics[height=200\sphinxpxdimen]{{graph}.png}

\sphinxAtStartPar
and corresponds to the following matrix:

\noindent\sphinxincludegraphics[height=100\sphinxpxdimen]{{matrix}.png}

\sphinxAtStartPar
It can be perfectly clusterized into the following graph by clustering together the nodes 0, 2 and 3 in cluster 1 and the node 1 in cluster 0:

\noindent\sphinxincludegraphics[height=75\sphinxpxdimen]{{graph2}.png}

\sphinxAtStartPar
and this graph corresponds to the following M matrix:

\noindent\sphinxincludegraphics[height=50\sphinxpxdimen]{{matrix2}.png}

\sphinxAtStartPar
On the contrary, if we decide to cluster the next graph G’ in the same way as above, the edge (2, 3) will be ‘lost’ in the process and the cost of the solution will be 1.

\noindent\sphinxincludegraphics[height=200\sphinxpxdimen]{{graph3}.png}

\sphinxAtStartPar
The goal is to find a k\sphinxhyphen{}clustering of a given graph and the associated matrix M that minimize the number of erroneous edges.

\sphinxAtStartPar
\sphinxhref{https://www.jair.org/index.php/jair/article/download/12280/26656}{A Mattenet, I Davidson, S Nijssen, P Schaus. Generic Constraint\sphinxhyphen{}Based Block Modeling Using Constraint Programming. CP 2019, pp656\sphinxhyphen{}673, Stamford, CT, USA}.


\subsection{CFN model}
\label{\detokenize{examples/tuto_bmp:cfn-model}}
\sphinxAtStartPar
We create N variables, one for every node of the graph, with domain size k representing the clustering.
We add k*k Boolean variables for representing M.

\sphinxAtStartPar
For all triplets of two nodes u, v, and one matrix cell M{[}i,j{]}, we have a ternary cost function which returns a cost of 1 if node u is assigned to cluster i, v to j, and M{[}i,j{]}=1 but (u,v) is not in G, or M{[}i,j{]}=0 and (u,v) is in G. In order to break symmetries, we constrain the first k\sphinxhyphen{}1 node variables to be assigned to a cluster number less than or equal to their index


\subsection{Data}
\label{\detokenize{examples/tuto_bmp:data}}
\sphinxAtStartPar
You can try a small example \sphinxcode{\sphinxupquote{simple.mat}} with optimum value equal to 0 for 3 clusters.

\sphinxAtStartPar
Perfect solution for the small example with k=3 (Mattenet et al, CP 2019)

\noindent\sphinxincludegraphics[height=250\sphinxpxdimen]{{simple}.png}

\sphinxAtStartPar
More examples with 3 clusters (Stochastic Block Models \sphinxhref{https://doi.org/10.1371/journal.pone.0215296}{{[}Funke and Becker, Plos One 2019{]}})

\noindent\sphinxincludegraphics[height=250\sphinxpxdimen]{{SBM}.png}

\sphinxAtStartPar
See other examples, such as \sphinxhref{https://www.ifip.com/Partitioning\_Political\_Actor.html}{PoliticalActor} and more, here :
\sphinxcode{\sphinxupquote{100.mat}} |
\sphinxcode{\sphinxupquote{150.mat}} |
\sphinxcode{\sphinxupquote{200.mat}} |
\sphinxcode{\sphinxupquote{30.mat}} |
\sphinxcode{\sphinxupquote{50.mat}} |
\sphinxcode{\sphinxupquote{hartford\_drug.mat}} |
\sphinxcode{\sphinxupquote{kansas.mat}} |
\sphinxcode{\sphinxupquote{politicalactor.mat}} |
\sphinxcode{\sphinxupquote{sharpstone.mat}} |
\sphinxcode{\sphinxupquote{transatlantic.mat}}.


\subsection{Python model}
\label{\detokenize{examples/tuto_bmp:python-model}}
\sphinxAtStartPar
The following code using pytoulbar2 library solves the corresponding cost function network (e.g. “python3 blockmodel.py simple.mat 3”).

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{blockmodel.py}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{sys}
\PYG{k+kn}{import} \PYG{n+nn}{pytoulbar2}

\PYG{c+c1}{\PYGZsh{}read adjency matrix of graph G}
\PYG{n}{Lines} \PYG{o}{=} \PYG{n+nb}{open}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{readlines}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{GMatrix} \PYG{o}{=} \PYG{p}{[}\PYG{p}{[}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{e}\PYG{p}{)} \PYG{k}{for} \PYG{n}{e} \PYG{o+ow}{in} \PYG{n}{l}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{]} \PYG{k}{for} \PYG{n}{l} \PYG{o+ow}{in} \PYG{n}{Lines}\PYG{p}{]}

\PYG{n}{N} \PYG{o}{=} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{Lines}\PYG{p}{)}
\PYG{n}{Top} \PYG{o}{=} \PYG{n}{N}\PYG{o}{*}\PYG{n}{N} \PYG{o}{+} \PYG{l+m+mi}{1}

\PYG{n}{K} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}give names to node variables}
\PYG{n}{Var} \PYG{o}{=} \PYG{p}{[}\PYG{p}{(}\PYG{n+nb}{chr}\PYG{p}{(}\PYG{l+m+mi}{65} \PYG{o}{+} \PYG{n}{i}\PYG{p}{)} \PYG{k}{if} \PYG{n}{N} \PYG{o}{\PYGZlt{}} \PYG{l+m+mi}{28} \PYG{k}{else} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{x}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{)} \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{]} \PYG{c+c1}{\PYGZsh{} Political actor or any instance}
\PYG{c+c1}{\PYGZsh{}    Var = [\PYGZdq{}ron\PYGZdq{},\PYGZdq{}tom\PYGZdq{},\PYGZdq{}frank\PYGZdq{},\PYGZdq{}boyd\PYGZdq{},\PYGZdq{}tim\PYGZdq{},\PYGZdq{}john\PYGZdq{},\PYGZdq{}jeff\PYGZdq{},\PYGZdq{}jay\PYGZdq{},\PYGZdq{}sandy\PYGZdq{},\PYGZdq{}jerry\PYGZdq{},\PYGZdq{}darrin\PYGZdq{},\PYGZdq{}ben\PYGZdq{},\PYGZdq{}arnie\PYGZdq{}] \PYGZsh{} Transatlantic}
\PYG{c+c1}{\PYGZsh{}    Var = [\PYGZdq{}justin\PYGZdq{},\PYGZdq{}harry\PYGZdq{},\PYGZdq{}whit\PYGZdq{},\PYGZdq{}brian\PYGZdq{},\PYGZdq{}paul\PYGZdq{},\PYGZdq{}ian\PYGZdq{},\PYGZdq{}mike\PYGZdq{},\PYGZdq{}jim\PYGZdq{},\PYGZdq{}dan\PYGZdq{},\PYGZdq{}ray\PYGZdq{},\PYGZdq{}cliff\PYGZdq{},\PYGZdq{}mason\PYGZdq{},\PYGZdq{}roy\PYGZdq{}] \PYGZsh{} Sharpstone}
\PYG{c+c1}{\PYGZsh{}    Var = [\PYGZdq{}Sherrif\PYGZdq{},\PYGZdq{}CivilDef\PYGZdq{},\PYGZdq{}Coroner\PYGZdq{},\PYGZdq{}Attorney\PYGZdq{},\PYGZdq{}HighwayP\PYGZdq{},\PYGZdq{}ParksRes\PYGZdq{},\PYGZdq{}GameFish\PYGZdq{},\PYGZdq{}KansasDOT\PYGZdq{},\PYGZdq{}ArmyCorps\PYGZdq{},\PYGZdq{}ArmyReserve\PYGZdq{},\PYGZdq{}CrableAmb\PYGZdq{},\PYGZdq{}FrankCoAmb\PYGZdq{},\PYGZdq{}LeeRescue\PYGZdq{},\PYGZdq{}Shawney\PYGZdq{},\PYGZdq{}BurlPolice\PYGZdq{},\PYGZdq{}LyndPolice\PYGZdq{},\PYGZdq{}RedCross\PYGZdq{},\PYGZdq{}TopekaFD\PYGZdq{},\PYGZdq{}CarbFD\PYGZdq{},\PYGZdq{}TopekaRBW\PYGZdq{}] \PYGZsh{} Kansas}

\PYG{n}{Problem} \PYG{o}{=} \PYG{n}{pytoulbar2}\PYG{o}{.}\PYG{n}{CFN}\PYG{p}{(}\PYG{n}{Top}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}create a Boolean variable for each coefficient of the M GMatrix}
\PYG{k}{for} \PYG{n}{u} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{K}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{v} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{K}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddVariable}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{M\PYGZus{}}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{u}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZus{}}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{v}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}create a domain variable for each node in graph G}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddVariable}\PYG{p}{(}\PYG{n}{Var}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{K}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}general case for each edge in G}
\PYG{k}{for} \PYG{n}{u} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{K}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{v} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{K}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
                \PYG{k}{if} \PYG{n}{i} \PYG{o}{!=} \PYG{n}{j}\PYG{p}{:}
                    \PYG{n}{ListCost} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
                    \PYG{k}{for} \PYG{n}{m} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{:}
                        \PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{K}\PYG{p}{)}\PYG{p}{:}
                            \PYG{k}{for} \PYG{n}{l} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{K}\PYG{p}{)}\PYG{p}{:}
                                \PYG{k}{if} \PYG{p}{(}\PYG{n}{u} \PYG{o}{==} \PYG{n}{k} \PYG{o+ow}{and} \PYG{n}{v} \PYG{o}{==} \PYG{n}{l} \PYG{o+ow}{and} \PYG{n}{GMatrix}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]} \PYG{o}{!=} \PYG{n}{m}\PYG{p}{)}\PYG{p}{:}
                                    \PYG{n}{ListCost}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
                                \PYG{k}{else}\PYG{p}{:}
                                    \PYG{n}{ListCost}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
                    \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{M\PYGZus{}}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{u}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZus{}}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{v}\PYG{p}{)}\PYG{p}{,} \PYG{n}{Var}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,} \PYG{n}{Var}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]}\PYG{p}{]}\PYG{p}{,}\PYG{n}{ListCost}\PYG{p}{)}



\PYG{c+c1}{\PYGZsh{} self\PYGZhy{}loops must be treated separately as they involves only two variables}
\PYG{k}{for} \PYG{n}{u} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{K}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{ListCost} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{m} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{K}\PYG{p}{)}\PYG{p}{:}
                \PYG{k}{if} \PYG{p}{(}\PYG{n}{u} \PYG{o}{==} \PYG{n}{k} \PYG{o+ow}{and} \PYG{n}{GMatrix}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]} \PYG{o}{!=} \PYG{n}{m}\PYG{p}{)}\PYG{p}{:}
                    \PYG{n}{ListCost}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
                \PYG{k}{else}\PYG{p}{:}
                    \PYG{n}{ListCost}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
        \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{M\PYGZus{}}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{u}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZus{}}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{u}\PYG{p}{)}\PYG{p}{,} \PYG{n}{Var}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ListCost}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} breaking partial symmetries by fixing first (K\PYGZhy{}1) domain variables to be assigned to a cluster number less than or equal to their index}
\PYG{k}{for} \PYG{n}{l} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{K}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{Constraint} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
    \PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{K}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{if} \PYG{n}{k} \PYG{o}{\PYGZgt{}} \PYG{n}{l}\PYG{p}{:}
            \PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{Top}\PYG{p}{)}
        \PYG{k}{else}\PYG{p}{:}
            \PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
    \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{n}{Var}\PYG{p}{[}\PYG{n}{l}\PYG{p}{]}\PYG{p}{]}\PYG{p}{,} \PYG{n}{Constraint}\PYG{p}{)}

\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{Dump}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{replace}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.mat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.cfn}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{CFN}\PYG{o}{.}\PYG{n}{timer}\PYG{p}{(}\PYG{l+m+mi}{300}\PYG{p}{)}
\PYG{n}{res} \PYG{o}{=} \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{Solve}\PYG{p}{(}\PYG{n}{showSolutions} \PYG{o}{=} \PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{k}{if} \PYG{n}{res}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{M matrix:}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{u} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{K}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{Line} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{v} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{K}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{Line}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{n}{u}\PYG{o}{*}\PYG{n}{K}\PYG{o}{+}\PYG{n}{v}\PYG{p}{]}\PYG{p}{)}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{Line}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{K}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{if} \PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{n}{K}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2}\PYG{o}{+}\PYG{n}{i}\PYG{p}{]} \PYG{o}{==} \PYG{n}{k}\PYG{p}{:}
                \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Node}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{Var}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{with index}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{,}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{is in cluster}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{n}{K}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2}\PYG{o}{+}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}

\end{sphinxVerbatim}

\sphinxstepscope


\section{Airplane landing problem}
\label{\detokenize{examples/tuto_alp:airplane-landing-problem}}\label{\detokenize{examples/tuto_alp:tuto-alp}}\label{\detokenize{examples/tuto_alp::doc}}



\subsection{Brief description}
\label{\detokenize{examples/tuto_alp:brief-description}}
\sphinxAtStartPar
We consider a single plane’s landing runway.
Given a set of planes with given target landing time, the objective is to minimize the total weighted deviation from the target landing time for each plane.

\sphinxAtStartPar
There are costs associated with landing either earlier or later than the target landing time for each plane.

\sphinxAtStartPar
Each plane has to land within its predetermined time window.
For each pair of planes, there is an additionnal contraints to enforce that separation between those planes in bigger than a given number.

\sphinxAtStartPar
\sphinxhref{https://doi.org/10.1287/trsc.34.2.180.12302}{J.E. Beasley, M. Krishnamoorthy, Y.M. Sharaiha and D. Abramson. Scheduling aircraft landings \sphinxhyphen{} the static case. Transportation Science, vol.34, 2000}.


\subsection{CFN model}
\label{\detokenize{examples/tuto_alp:cfn-model}}
\sphinxAtStartPar
We create N variables, one for each plane, with domain value equal to all their possible landing time.

\sphinxAtStartPar
Binary hard cost functions express separation times between pairs of planes. Unary soft cost functions represent the weighted deviation for each plane.


\subsection{Data}
\label{\detokenize{examples/tuto_alp:data}}
\sphinxAtStartPar
Original data files can be download from the cost function library \sphinxhref{https://forgemia.inra.fr/thomas.schiex/cost-function-library/tree/master/crafted/airland/data}{airland}. Their format is described \sphinxhref{http://people.brunel.ac.uk/~mastjjb/jeb/orlib/airlandinfo.html}{here}. You can try a small example \sphinxcode{\sphinxupquote{airland1.txt}} with optimum value equal to 700.


\subsection{Python model solver}
\label{\detokenize{examples/tuto_alp:python-model-solver}}
\sphinxAtStartPar
The following code uses the pytoulbar2 module to generate the cost function network and solve it (e.g. “python3 airland.py airland1.txt”).

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{airland.py}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{sys}
\PYG{k+kn}{import} \PYG{n+nn}{pytoulbar2}

\PYG{n}{f} \PYG{o}{=} \PYG{n+nb}{open}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{readlines}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{tokens} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{l} \PYG{o+ow}{in} \PYG{n}{f}\PYG{p}{:}
    \PYG{n}{tokens} \PYG{o}{+}\PYG{o}{=} \PYG{n}{l}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{pos} \PYG{o}{=} \PYG{l+m+mi}{0}

\PYG{k}{def} \PYG{n+nf}{token}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{global} \PYG{n}{pos}\PYG{p}{,} \PYG{n}{tokens}
    \PYG{k}{if} \PYG{p}{(}\PYG{n}{pos} \PYG{o}{==} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{tokens}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{return} \PYG{k+kc}{None}
    \PYG{n}{s} \PYG{o}{=} \PYG{n}{tokens}\PYG{p}{[}\PYG{n}{pos}\PYG{p}{]}
    \PYG{n}{pos} \PYG{o}{+}\PYG{o}{=} \PYG{l+m+mi}{1}
    \PYG{k}{return} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{s}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{N} \PYG{o}{=} \PYG{n}{token}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{token}\PYG{p}{(}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} skip freeze time}

\PYG{n}{LT} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{PC} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{n}{ST} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{token}\PYG{p}{(}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} skip appearance time}
\PYG{c+c1}{\PYGZsh{} Times per plane: \PYGZob{}earliest landing time, target landing time, latest landing time\PYGZcb{}}
    \PYG{n}{LT}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{p}{[}\PYG{n}{token}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{token}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{token}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Penalty cost per unit of time per plane:}
\PYG{c+c1}{\PYGZsh{} [for landing before target, after target]}
    \PYG{n}{PC}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{p}{[}\PYG{n}{token}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{token}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Separation time required after i lands before j can land}
    \PYG{n}{ST}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{p}{[}\PYG{n}{token}\PYG{p}{(}\PYG{p}{)} \PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{top} \PYG{o}{=} \PYG{l+m+mi}{99999}

\PYG{n}{Problem} \PYG{o}{=} \PYG{n}{pytoulbar2}\PYG{o}{.}\PYG{n}{CFN}\PYG{p}{(}\PYG{n}{top}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{x}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{LT}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}\PYG{n}{LT}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{ListCost} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
    \PYG{k}{for} \PYG{n}{a} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{LT}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{LT}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{if} \PYG{n}{a} \PYG{o}{\PYGZlt{}} \PYG{n}{LT}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{:}
            \PYG{n}{ListCost}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{PC}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{*}\PYG{p}{(}\PYG{n}{LT}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{a}\PYG{p}{)}\PYG{p}{)}
        \PYG{k}{else}\PYG{p}{:}
            \PYG{n}{ListCost}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{PC}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{*}\PYG{p}{(}\PYG{n}{a} \PYG{o}{\PYGZhy{}} \PYG{n}{LT}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ListCost}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{Constraint} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{a} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{LT}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{LT}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{for} \PYG{n}{b} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{LT}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{LT}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
                \PYG{k}{if} \PYG{n}{a}\PYG{o}{+}\PYG{n}{ST}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]}\PYG{o}{\PYGZgt{}}\PYG{n}{b} \PYG{o+ow}{and} \PYG{n}{b}\PYG{o}{+}\PYG{n}{ST}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{o}{\PYGZgt{}}\PYG{n}{a}\PYG{p}{:}
                    \PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{top}\PYG{p}{)}
                \PYG{k}{else}\PYG{p}{:}
                    \PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
        \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{n}{i}\PYG{p}{,} \PYG{n}{j}\PYG{p}{]}\PYG{p}{,}\PYG{n}{Constraint}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}Problem.Dump(\PYGZsq{}airplane.cfn\PYGZsq{})}
\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{NoPreprocessing}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{Solve}\PYG{p}{(}\PYG{n}{showSolutions} \PYG{o}{=} \PYG{l+m+mi}{3}\PYG{p}{)}

\end{sphinxVerbatim}

\sphinxstepscope


\section{Warehouse location problem}
\label{\detokenize{examples/tuto_wlp:warehouse-location-problem}}\label{\detokenize{examples/tuto_wlp:tuto-wlp}}\label{\detokenize{examples/tuto_wlp::doc}}



\subsection{Brief description}
\label{\detokenize{examples/tuto_wlp:brief-description}}
\sphinxAtStartPar
A compagny consider opening warehouses at some candidate locations with each of them having a maintenance cost if they are open.

\sphinxAtStartPar
The compagny control a set of given stores and each of them need to take suplies to one of the warehouse, but depending the warehouse chosen, there will be an additionnal cost.

\sphinxAtStartPar
The objective is to choose wich warehouse to open and to divide the store among the open warehouse ion order to minimize the total cost of the store’s cost and the maintenance cost.


\subsection{CFN model}
\label{\detokenize{examples/tuto_wlp:cfn-model}}
\sphinxAtStartPar
We create Boolean variables for the warehouses (i.e., open or not) and integer variables for the store, with domain size the number of warehouses to represent to wich warehouse the store will take suplies.

\sphinxAtStartPar
Hard binary constraints represent that a store cannnot take suplies from a closed warehouse.
Soft unary constraints represent the maintenance cost of the warehouses.
Soft unary constraints represent the store’s cost regarding wich warehouse to take supplies from.


\subsection{Data}
\label{\detokenize{examples/tuto_wlp:data}}
\sphinxAtStartPar
Original data files can be download from the cost function library \sphinxhref{https://forgemia.inra.fr/thomas.schiex/cost-function-library/tree/master/crafted/warehouses/data/txt}{warehouses}. Their format is described \sphinxhref{https://forgemia.inra.fr/thomas.schiex/cost-function-library/tree/master/crafted/warehouses/readme.txt}{here}.


\subsection{Python model solver}
\label{\detokenize{examples/tuto_wlp:python-model-solver}}
\sphinxAtStartPar
The following code uses the pytoulbar2 module to generate the cost function network and solve it (e.g. “python3 warehouse.py cap44.txt 1” found optimum value equal to 10349757). Other instances are available \sphinxhref{https://forgemia.inra.fr/thomas.schiex/cost-function-library/tree/master/crafted/warehouses/instances/cfn}{here} in cfn format.

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{warehouse.py}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{sys}
\PYG{k+kn}{import} \PYG{n+nn}{pytoulbar2}

\PYG{n}{f} \PYG{o}{=} \PYG{n+nb}{open}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{readlines}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{precision} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} used to convert cost values from float to integer}

\PYG{n}{tokens} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{l} \PYG{o+ow}{in} \PYG{n}{f}\PYG{p}{:}
    \PYG{n}{tokens} \PYG{o}{+}\PYG{o}{=} \PYG{n}{l}\PYG{o}{.}\PYG{n}{split}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{pos} \PYG{o}{=} \PYG{l+m+mi}{0}

\PYG{k}{def} \PYG{n+nf}{token}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{global} \PYG{n}{pos}\PYG{p}{,} \PYG{n}{tokens}
    \PYG{k}{if} \PYG{n}{pos} \PYG{o}{==} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{tokens}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{return} \PYG{k+kc}{None}
    \PYG{n}{s} \PYG{o}{=} \PYG{n}{tokens}\PYG{p}{[}\PYG{n}{pos}\PYG{p}{]}
    \PYG{n}{pos} \PYG{o}{+}\PYG{o}{=} \PYG{l+m+mi}{1}
    \PYG{k}{return} \PYG{n}{s}


\PYG{n}{N} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{token}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} number of warehouses}
\PYG{n}{M} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{token}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} number of stores}

\PYG{n}{top} \PYG{o}{=} \PYG{l+m+mi}{1}  \PYG{c+c1}{\PYGZsh{} sum of all costs plus one}

\PYG{n}{CostW} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}  \PYG{c+c1}{\PYGZsh{} maintenance cost of warehouses}
\PYG{n}{Capacity} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}  \PYG{c+c1}{\PYGZsh{} capacity limit of warehouses (not used)}

\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{Capacity}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{token}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{CostW}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{token}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)} \PYG{o}{*} \PYG{l+m+mf}{10.}\PYG{o}{*}\PYG{o}{*}\PYG{n}{precision}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{top} \PYG{o}{+}\PYG{o}{=} \PYG{n+nb}{sum}\PYG{p}{(}\PYG{n}{CostW}\PYG{p}{)}

\PYG{n}{Demand} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}  \PYG{c+c1}{\PYGZsh{} demand for each store}
\PYG{n}{CostS} \PYG{o}{=} \PYG{p}{[}\PYG{p}{[}\PYG{p}{]} \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{M}\PYG{p}{)}\PYG{p}{]}  \PYG{c+c1}{\PYGZsh{} supply cost matrix}

\PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{M}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{Demand}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{token}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{CostS}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{token}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)} \PYG{o}{*} \PYG{l+m+mf}{10.}\PYG{o}{*}\PYG{o}{*}\PYG{n}{precision}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{top} \PYG{o}{+}\PYG{o}{=} \PYG{n+nb}{sum}\PYG{p}{(}\PYG{n}{CostS}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} create a new empty cost function network}
\PYG{n}{Problem} \PYG{o}{=} \PYG{n}{pytoulbar2}\PYG{o}{.}\PYG{n}{CFN}\PYG{p}{(}\PYG{n}{top}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} add warehouse variables}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{w}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} add store variables}
\PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{M}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{s}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} add maintenance costs}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{CostW}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} add supply costs for each store}
\PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{M}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{n}{N}\PYG{o}{+}\PYG{n}{j}\PYG{p}{]}\PYG{p}{,} \PYG{n}{CostS}\PYG{p}{[}\PYG{n}{j}\PYG{p}{]}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} add channeling constraints between warehouses and stores}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{M}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{Constraint} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{a} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{for} \PYG{n}{b} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
                \PYG{k}{if} \PYG{n}{a} \PYG{o}{==} \PYG{l+m+mi}{0} \PYG{o+ow}{and} \PYG{n}{b} \PYG{o}{==} \PYG{n}{i}\PYG{p}{:}
                    \PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{top}\PYG{p}{)}
                \PYG{k}{else}\PYG{p}{:}
                    \PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
        \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{n}{i}\PYG{p}{,} \PYG{n}{N}\PYG{o}{+}\PYG{n}{j}\PYG{p}{]}\PYG{p}{,} \PYG{n}{Constraint}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}Problem.Dump(\PYGZsq{}warehouse.cfn\PYGZsq{})}
\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{Solve}\PYG{p}{(}\PYG{n}{showSolutions}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{)}

\end{sphinxVerbatim}

\sphinxstepscope


\section{Square packing problem}
\label{\detokenize{examples/tuto_spp:square-packing-problem}}\label{\detokenize{examples/tuto_spp:tuto-spp}}\label{\detokenize{examples/tuto_spp::doc}}



\subsection{Brief description}
\label{\detokenize{examples/tuto_spp:brief-description}}
\sphinxAtStartPar
We have N squares of respectives size 1×1, 2×2,…, NxN. We have to fit them without overlaps into a square of size SxS.

\sphinxAtStartPar
Results up to N=56 are given \sphinxhref{https://oeis.org/A005842}{here}.

\sphinxAtStartPar
Optimal solution for 15 squares packed into a 36x36 square (Fig. taken from Takehide Soh)

\noindent\sphinxincludegraphics[height=250\sphinxpxdimen]{{square}.png}


\subsection{CFN model}
\label{\detokenize{examples/tuto_spp:cfn-model}}
\sphinxAtStartPar
We create an integer variable of domain size (S\sphinxhyphen{}i)x(S\sphinxhyphen{}i) for each square.
The variable represents the position of the top left corner of the square.

\sphinxAtStartPar
The value of a given variable modulo (S\sphinxhyphen{}i) gives the x\sphinxhyphen{}coordinate, whereas its value divided by (S\sphinxhyphen{}i) gives the y\sphinxhyphen{}coordinate.

\sphinxAtStartPar
We have hard binary constraints to forbid any overlapping pair of squares.

\sphinxAtStartPar
We make the problem a pure satisfaction problem by fixing the initial upper bound to 1.


\subsection{Python model}
\label{\detokenize{examples/tuto_spp:python-model}}
\sphinxAtStartPar
The following code uses the pytoulbar2 library to generate the cost function network and solve it (e.g. “python3 square.py 3 5”).
\sphinxcode{\sphinxupquote{square.py}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{sys}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}\PYG{p}{,} \PYG{n}{seed}		
\PYG{n}{seed}\PYG{p}{(}\PYG{l+m+mi}{123456789}\PYG{p}{)}

\PYG{k+kn}{import} \PYG{n+nn}{pytoulbar2}
\PYG{k}{try}\PYG{p}{:}
	\PYG{n}{N} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}
	\PYG{n}{S} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}
	\PYG{k}{assert} \PYG{n}{N} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{S}
\PYG{k}{except}\PYG{p}{:}
	\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Two integers need to be given as arguments: N and S}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
	\PYG{n}{exit}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}pure constraint satisfaction problem}
\PYG{n}{Problem} \PYG{o}{=} \PYG{n}{pytoulbar2}\PYG{o}{.}\PYG{n}{CFN}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}create a variable for each square}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
	\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sq}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{(}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{l}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{,}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{)}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{for} \PYG{n}{l} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{i}\PYG{p}{)} \PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{i}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}binary hard constraints for overlapping squares}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
	\PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
		\PYG{n}{ListConstraintsOverlaps} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
		\PYG{k}{for} \PYG{n}{a} \PYG{o+ow}{in} \PYG{p}{[}\PYG{n}{S}\PYG{o}{*}\PYG{n}{k}\PYG{o}{+}\PYG{n}{l} \PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{i}\PYG{p}{)} \PYG{k}{for} \PYG{n}{l} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{i}\PYG{p}{)}\PYG{p}{]}\PYG{p}{:}
			\PYG{k}{for} \PYG{n}{b} \PYG{o+ow}{in} \PYG{p}{[}\PYG{n}{S}\PYG{o}{*}\PYG{n}{m}\PYG{o}{+}\PYG{n}{n} \PYG{k}{for} \PYG{n}{m} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{j}\PYG{p}{)} \PYG{k}{for} \PYG{n}{n} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{j}\PYG{p}{)}\PYG{p}{]}\PYG{p}{:}
				\PYG{c+c1}{\PYGZsh{}calculating the coordinates of the squares}
				\PYG{n}{X\PYGZus{}i} \PYG{o}{=} \PYG{n}{a}\PYG{o}{\PYGZpc{}}\PYG{n}{S}
				\PYG{n}{X\PYGZus{}j} \PYG{o}{=} \PYG{n}{b}\PYG{o}{\PYGZpc{}}\PYG{n}{S}
				\PYG{n}{Y\PYGZus{}i} \PYG{o}{=} \PYG{n}{a}\PYG{o}{/}\PYG{o}{/}\PYG{n}{S}
				\PYG{n}{Y\PYGZus{}j} \PYG{o}{=} \PYG{n}{b}\PYG{o}{/}\PYG{o}{/}\PYG{n}{S}
				\PYG{c+c1}{\PYGZsh{}calculating if squares are overlapping}
				\PYG{k}{if} \PYG{n}{X\PYGZus{}i} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{n}{X\PYGZus{}j} \PYG{p}{:}
					\PYG{k}{if} \PYG{n}{X\PYGZus{}i} \PYG{o}{\PYGZhy{}} \PYG{n}{X\PYGZus{}j} \PYG{o}{\PYGZlt{}} \PYG{n}{j}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{:}
						\PYG{k}{if} \PYG{n}{Y\PYGZus{}i} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{n}{Y\PYGZus{}j}\PYG{p}{:}
							\PYG{k}{if} \PYG{n}{Y\PYGZus{}i} \PYG{o}{\PYGZhy{}} \PYG{n}{Y\PYGZus{}j} \PYG{o}{\PYGZlt{}} \PYG{n}{j}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{:}
								\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
							\PYG{k}{else}\PYG{p}{:}
								\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
						\PYG{k}{else}\PYG{p}{:}
							\PYG{k}{if} \PYG{n}{Y\PYGZus{}j} \PYG{o}{\PYGZhy{}} \PYG{n}{Y\PYGZus{}i} \PYG{o}{\PYGZlt{}} \PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{:}
								\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
							\PYG{k}{else}\PYG{p}{:}
								\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
					\PYG{k}{else}\PYG{p}{:}
						\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
				\PYG{k}{else} \PYG{p}{:}
					\PYG{k}{if} \PYG{n}{X\PYGZus{}j} \PYG{o}{\PYGZhy{}} \PYG{n}{X\PYGZus{}i} \PYG{o}{\PYGZlt{}} \PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{:}
						\PYG{k}{if} \PYG{n}{Y\PYGZus{}i} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{n}{Y\PYGZus{}j}\PYG{p}{:}
							\PYG{k}{if} \PYG{n}{Y\PYGZus{}i} \PYG{o}{\PYGZhy{}} \PYG{n}{Y\PYGZus{}j} \PYG{o}{\PYGZlt{}} \PYG{n}{j}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{:}
								\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
							\PYG{k}{else}\PYG{p}{:}
								\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
						\PYG{k}{else}\PYG{p}{:}
							\PYG{k}{if} \PYG{n}{Y\PYGZus{}j} \PYG{o}{\PYGZhy{}} \PYG{n}{Y\PYGZus{}i} \PYG{o}{\PYGZlt{}} \PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{:}
								\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}
							\PYG{k}{else}\PYG{p}{:}
								\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
					\PYG{k}{else}\PYG{p}{:}
						\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
		\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sq}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sq}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ListConstraintsOverlaps}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}Problem.Dump(\PYGZsq{}Square.cfn\PYGZsq{})}
\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{CFN}\PYG{o}{.}\PYG{n}{timer}\PYG{p}{(}\PYG{l+m+mi}{300}\PYG{p}{)}
\PYG{n}{res} \PYG{o}{=} \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{Solve}\PYG{p}{(}\PYG{n}{showSolutions}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{k}{if} \PYG{n}{res}\PYG{p}{:}
	\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{S}\PYG{p}{)}\PYG{p}{:}
		\PYG{n}{row} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}
		\PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{S}\PYG{p}{)}\PYG{p}{:}
			\PYG{n}{row} \PYG{o}{+}\PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}
			\PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
				\PYG{k}{if} \PYG{p}{(}\PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{n}{k}\PYG{p}{]}\PYG{o}{\PYGZpc{}}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{k}\PYG{p}{)} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{j} \PYG{o+ow}{and} \PYG{n}{j} \PYG{o}{\PYGZhy{}} \PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{n}{k}\PYG{p}{]}\PYG{o}{\PYGZpc{}}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{k}\PYG{p}{)} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{k}\PYG{p}{)} \PYG{o+ow}{and} \PYG{p}{(}\PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{n}{k}\PYG{p}{]}\PYG{o}{/}\PYG{o}{/}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{k}\PYG{p}{)} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{i} \PYG{o+ow}{and} \PYG{n}{i} \PYG{o}{\PYGZhy{}} \PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{n}{k}\PYG{p}{]}\PYG{o}{/}\PYG{o}{/}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{k}\PYG{p}{)} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{k}\PYG{p}{)}\PYG{p}{:}
					\PYG{n}{row} \PYG{o}{=} \PYG{n}{row}\PYG{p}{[}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{+} \PYG{n+nb}{chr}\PYG{p}{(}\PYG{l+m+mi}{65} \PYG{o}{+} \PYG{n}{k}\PYG{p}{)}
		\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{row}\PYG{p}{)}
\PYG{k}{else}\PYG{p}{:}
	\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{No solution found!}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}


\subsection{C++ program using libtb2.so}
\label{\detokenize{examples/tuto_spp:c-program-using-libtb2-so}}
\sphinxAtStartPar
The following code uses the C++ toulbar2 library. Compile toulbar2 with “cmake \sphinxhyphen{}DLIBTB2=ON \sphinxhyphen{}DPYTB2=ON . ; make” and copy the library in your current directory “cp lib/Linux/libtb2.so .” before compiling “g++ \sphinxhyphen{}o square square.cpp \sphinxhyphen{}Isrc \sphinxhyphen{}Llib/Linux \sphinxhyphen{}std=c++11 \sphinxhyphen{}O3 \sphinxhyphen{}DNDEBUG \sphinxhyphen{}DBOOST \sphinxhyphen{}DLONGDOUBLE\_PROB \sphinxhyphen{}DLONGLONG\_COST \sphinxhyphen{}DWCSPFORMATONLY libtb2.so” and running the example (e.g. “./square 15 36”).

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{square.cpp}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]

/**
 * Square Packing Problem
 */

// Compile with cmake option \PYGZhy{}DLIBTB2=ON \PYGZhy{}DPYTB2=ON to get C++ toulbar2 library lib/Linux/libtb2.so
// Then,
// g++ \PYGZhy{}o square square.cpp \PYGZhy{}Isrc \PYGZhy{}Llib/Linux \PYGZhy{}std=c++11 \PYGZhy{}O3 \PYGZhy{}DNDEBUG \PYGZhy{}DBOOST \PYGZhy{}DLONGDOUBLE\PYGZus{}PROB \PYGZhy{}DLONGLONG\PYGZus{}COST \PYGZhy{}DWCSPFORMATONLY libtb2.so

\PYGZsh{}include \PYGZdq{}toulbar2lib.hpp\PYGZdq{}

\PYGZsh{}include \PYGZlt{}string.h\PYGZgt{}
\PYGZsh{}include \PYGZlt{}stdio.h\PYGZgt{}
\PYGZsh{}include \PYGZlt{}stdlib.h\PYGZgt{}
\PYGZsh{}include \PYGZlt{}unistd.h\PYGZgt{}

int main(int argc, char* argv[])
\PYGZob{}
    int N = atoi(argv[1]);
    int S = atoi(argv[2]);

    tb2init(); // must be call before setting specific ToulBar2 options and creating a model

    ToulBar2::verbose = 0; // change to 0 or higher values to see more trace information

    initCosts(); // last check for compatibility issues between ToulBar2 options and Cost data\PYGZhy{}type

    Cost top = UNIT\PYGZus{}COST;
    WeightedCSPSolver* solver = WeightedCSPSolver::makeWeightedCSPSolver(top);

    for (int i=0; i\PYGZlt{}N; i++) \PYGZob{}
        solver\PYGZhy{}\PYGZgt{}getWCSP()\PYGZhy{}\PYGZgt{}makeEnumeratedVariable(\PYGZdq{}sq\PYGZdq{} + to\PYGZus{}string(i+1), 0, (S\PYGZhy{}i)*(S\PYGZhy{}i) \PYGZhy{} 1);
    \PYGZcb{}

    for (int i=0; i\PYGZlt{}N; i++) \PYGZob{}
        for (int j=i+1; j\PYGZlt{}N; j++) \PYGZob{}
            vector\PYGZlt{}Cost\PYGZgt{} costs((S\PYGZhy{}i)*(S\PYGZhy{}i)*(S\PYGZhy{}j)*(S\PYGZhy{}j), MIN\PYGZus{}COST);
    	    for (int a=0; a\PYGZlt{}(S\PYGZhy{}i)*(S\PYGZhy{}i); a++) \PYGZob{}
    	        for (int b=0; b\PYGZlt{}(S\PYGZhy{}j)*(S\PYGZhy{}j); b++) \PYGZob{}
                    costs[a*(S\PYGZhy{}j)*(S\PYGZhy{}j)+b] = ((((a\PYGZpc{}(S\PYGZhy{}i)) + i + 1 \PYGZlt{}= (b\PYGZpc{}(S\PYGZhy{}j))) || ((b\PYGZpc{}(S\PYGZhy{}j)) + j + 1 \PYGZlt{}= (a\PYGZpc{}(S\PYGZhy{}i))) || ((a/(S\PYGZhy{}i)) + i + 1 \PYGZlt{}= (b/(S\PYGZhy{}j))) || ((b/(S\PYGZhy{}j)) + j + 1 \PYGZlt{}= (a/(S\PYGZhy{}i))))?MIN\PYGZus{}COST:top);
                \PYGZcb{}
            \PYGZcb{}
            solver\PYGZhy{}\PYGZgt{}getWCSP()\PYGZhy{}\PYGZgt{}postBinaryConstraint(i, j, costs);
        \PYGZcb{}
    \PYGZcb{}

    solver\PYGZhy{}\PYGZgt{}getWCSP()\PYGZhy{}\PYGZgt{}sortConstraints(); // must be done at the end of the modeling

    tb2checkOptions();
    if (solver\PYGZhy{}\PYGZgt{}solve()) \PYGZob{}
            vector\PYGZlt{}Value\PYGZgt{} sol;
            solver\PYGZhy{}\PYGZgt{}getSolution(sol);
    	    for (int y=0; y\PYGZlt{}S; y++) \PYGZob{}
                for (int x=0; x\PYGZlt{}S; x++) \PYGZob{}
                    char c = \PYGZsq{} \PYGZsq{};
                    for (int i=0; i\PYGZlt{}N; i++) \PYGZob{}
                        if (x \PYGZgt{}= (sol[i]\PYGZpc{}(S\PYGZhy{}i)) \PYGZam{}\PYGZam{} x \PYGZlt{} (sol[i]\PYGZpc{}(S\PYGZhy{}i) ) + i + 1 \PYGZam{}\PYGZam{} y \PYGZgt{}= (sol[i]/(S\PYGZhy{}i)) \PYGZam{}\PYGZam{} y \PYGZlt{} (sol[i]/(S\PYGZhy{}i)) + i + 1) \PYGZob{}
                            c = 65+i;
                            break;
                        \PYGZcb{}
                     \PYGZcb{}
                     cout \PYGZlt{}\PYGZlt{} c;
                \PYGZcb{}
                cout \PYGZlt{}\PYGZlt{} endl;
            \PYGZcb{}
    \PYGZcb{} else \PYGZob{}
            cout \PYGZlt{}\PYGZlt{} \PYGZdq{}No solution found!\PYGZdq{} \PYGZlt{}\PYGZlt{} endl;
    \PYGZcb{}

    delete solver;
    return 0;
\PYGZcb{}

\end{sphinxVerbatim}

\sphinxstepscope


\section{Square soft packing problem}
\label{\detokenize{examples/tuto_sspp:square-soft-packing-problem}}\label{\detokenize{examples/tuto_sspp:tuto-sspp}}\label{\detokenize{examples/tuto_sspp::doc}}



\subsection{Brief description}
\label{\detokenize{examples/tuto_sspp:brief-description}}
\sphinxAtStartPar
The problem is almost identical to the square packing problem with the difference that we now allow overlaps but we want to minimize them.


\subsection{CFN model}
\label{\detokenize{examples/tuto_sspp:cfn-model}}
\sphinxAtStartPar
We reuse the {\hyperref[\detokenize{examples/tuto_spp:tuto-spp}]{\sphinxcrossref{\DUrole{std,std-ref}{Square packing problem}}}} model except that binary constraints are replaced by cost functions returning the overlapping size or zero if no overlaps.

\sphinxAtStartPar
To calculate an initial upper bound we simply compute the worst case scenario where N squares of size N*N are all stacks together. The cost of this is N**4, so we will take N**4+1 as the initial upperbound.


\subsection{Python model}
\label{\detokenize{examples/tuto_sspp:python-model}}
\sphinxAtStartPar
The following code using pytoulbar2 library solves the corresponding cost function network (e.g. “python3 squaresoft.py 10 20”).

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{squaresoft.py}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{sys}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}\PYG{p}{,} \PYG{n}{seed}		
\PYG{n}{seed}\PYG{p}{(}\PYG{l+m+mi}{123456789}\PYG{p}{)}

\PYG{k+kn}{import} \PYG{n+nn}{pytoulbar2}
\PYG{k}{try}\PYG{p}{:}
	\PYG{n}{N} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}
	\PYG{n}{S} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}
	\PYG{k}{assert} \PYG{n}{N} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{S}
\PYG{k}{except}\PYG{p}{:}
	\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Two integers need to be given as arguments: N and S}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
	\PYG{n}{exit}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{Problem} \PYG{o}{=} \PYG{n}{pytoulbar2}\PYG{o}{.}\PYG{n}{CFN}\PYG{p}{(}\PYG{n}{N}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{4} \PYG{o}{+} \PYG{l+m+mi}{1}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}create a variable for each square}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
	\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sq}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{,} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{(}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{l}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{,}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{)}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{for} \PYG{n}{l} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{i}\PYG{p}{)} \PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{i}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{}binary soft constraints for overlapping squares}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
	\PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
		\PYG{n}{ListConstraintsOverlaps} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
		\PYG{k}{for} \PYG{n}{a} \PYG{o+ow}{in} \PYG{p}{[}\PYG{n}{S}\PYG{o}{*}\PYG{n}{k}\PYG{o}{+}\PYG{n}{l} \PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{i}\PYG{p}{)} \PYG{k}{for} \PYG{n}{l} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{i}\PYG{p}{)}\PYG{p}{]}\PYG{p}{:}
			\PYG{k}{for} \PYG{n}{b} \PYG{o+ow}{in} \PYG{p}{[}\PYG{n}{S}\PYG{o}{*}\PYG{n}{m}\PYG{o}{+}\PYG{n}{n} \PYG{k}{for} \PYG{n}{m} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{j}\PYG{p}{)} \PYG{k}{for} \PYG{n}{n} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{j}\PYG{p}{)}\PYG{p}{]}\PYG{p}{:}
				\PYG{c+c1}{\PYGZsh{}calculating the coordinates of the squares}
				\PYG{n}{X\PYGZus{}i} \PYG{o}{=} \PYG{n}{a}\PYG{o}{\PYGZpc{}}\PYG{n}{S}
				\PYG{n}{X\PYGZus{}j} \PYG{o}{=} \PYG{n}{b}\PYG{o}{\PYGZpc{}}\PYG{n}{S}
				\PYG{n}{Y\PYGZus{}i} \PYG{o}{=} \PYG{n}{a}\PYG{o}{/}\PYG{o}{/}\PYG{n}{S}
				\PYG{n}{Y\PYGZus{}j} \PYG{o}{=} \PYG{n}{b}\PYG{o}{/}\PYG{o}{/}\PYG{n}{S}
				\PYG{c+c1}{\PYGZsh{}calculating if squares are overlapping}
				\PYG{k}{if} \PYG{n}{X\PYGZus{}i} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{n}{X\PYGZus{}j} \PYG{p}{:}
					\PYG{k}{if} \PYG{n}{X\PYGZus{}i} \PYG{o}{\PYGZhy{}} \PYG{n}{X\PYGZus{}j} \PYG{o}{\PYGZlt{}} \PYG{n}{j}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{:}
						\PYG{k}{if} \PYG{n}{Y\PYGZus{}i} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{n}{Y\PYGZus{}j}\PYG{p}{:}
							\PYG{k}{if} \PYG{n}{Y\PYGZus{}i} \PYG{o}{\PYGZhy{}} \PYG{n}{Y\PYGZus{}j} \PYG{o}{\PYGZlt{}} \PYG{n}{j}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{:}
								\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n+nb}{min}\PYG{p}{(}\PYG{n}{j}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{o}{\PYGZhy{}}\PYG{p}{(}\PYG{n}{X\PYGZus{}i} \PYG{o}{\PYGZhy{}} \PYG{n}{X\PYGZus{}j}\PYG{p}{)}\PYG{p}{,}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{o}{*}\PYG{n+nb}{min}\PYG{p}{(}\PYG{n}{j}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{o}{\PYGZhy{}}\PYG{p}{(}\PYG{n}{Y\PYGZus{}i} \PYG{o}{\PYGZhy{}} \PYG{n}{Y\PYGZus{}j}\PYG{p}{)}\PYG{p}{,}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}
							\PYG{k}{else}\PYG{p}{:}
								\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
						\PYG{k}{else}\PYG{p}{:}
							\PYG{k}{if} \PYG{n}{Y\PYGZus{}j} \PYG{o}{\PYGZhy{}} \PYG{n}{Y\PYGZus{}i} \PYG{o}{\PYGZlt{}} \PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{:}
								\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n+nb}{min}\PYG{p}{(}\PYG{n}{j}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{o}{\PYGZhy{}}\PYG{p}{(}\PYG{n}{X\PYGZus{}i} \PYG{o}{\PYGZhy{}} \PYG{n}{X\PYGZus{}j}\PYG{p}{)}\PYG{p}{,}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{o}{*}\PYG{n+nb}{min}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{o}{\PYGZhy{}}\PYG{p}{(}\PYG{n}{Y\PYGZus{}j} \PYG{o}{\PYGZhy{}} \PYG{n}{Y\PYGZus{}i}\PYG{p}{)}\PYG{p}{,}\PYG{n}{j}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}
							\PYG{k}{else}\PYG{p}{:}
								\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
					\PYG{k}{else}\PYG{p}{:}
						\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
				\PYG{k}{else} \PYG{p}{:}
					\PYG{k}{if} \PYG{n}{X\PYGZus{}j} \PYG{o}{\PYGZhy{}} \PYG{n}{X\PYGZus{}i} \PYG{o}{\PYGZlt{}} \PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{:}
						\PYG{k}{if} \PYG{n}{Y\PYGZus{}i} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{n}{Y\PYGZus{}j}\PYG{p}{:}
							\PYG{k}{if} \PYG{n}{Y\PYGZus{}i} \PYG{o}{\PYGZhy{}} \PYG{n}{Y\PYGZus{}j} \PYG{o}{\PYGZlt{}} \PYG{n}{j}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{:}
								\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n+nb}{min}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{o}{\PYGZhy{}}\PYG{p}{(}\PYG{n}{X\PYGZus{}j} \PYG{o}{\PYGZhy{}} \PYG{n}{X\PYGZus{}i}\PYG{p}{)}\PYG{p}{,}\PYG{n}{j}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{o}{*}\PYG{n+nb}{min}\PYG{p}{(}\PYG{n}{j}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{o}{\PYGZhy{}}\PYG{p}{(}\PYG{n}{Y\PYGZus{}i} \PYG{o}{\PYGZhy{}} \PYG{n}{Y\PYGZus{}j}\PYG{p}{)}\PYG{p}{,}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}
							\PYG{k}{else}\PYG{p}{:}
								\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
						\PYG{k}{else}\PYG{p}{:}
							\PYG{k}{if} \PYG{n}{Y\PYGZus{}j} \PYG{o}{\PYGZhy{}} \PYG{n}{Y\PYGZus{}i} \PYG{o}{\PYGZlt{}} \PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{:}
								\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n+nb}{min}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{o}{\PYGZhy{}}\PYG{p}{(}\PYG{n}{X\PYGZus{}j} \PYG{o}{\PYGZhy{}} \PYG{n}{X\PYGZus{}i}\PYG{p}{)}\PYG{p}{,}\PYG{n}{j}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{o}{*}\PYG{n+nb}{min}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{o}{\PYGZhy{}}\PYG{p}{(}\PYG{n}{Y\PYGZus{}j} \PYG{o}{\PYGZhy{}} \PYG{n}{Y\PYGZus{}i}\PYG{p}{)}\PYG{p}{,}\PYG{n}{j}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}
							\PYG{k}{else}\PYG{p}{:}
								\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
					\PYG{k}{else}\PYG{p}{:}
						\PYG{n}{ListConstraintsOverlaps}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
		\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sq}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sq}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ListConstraintsOverlaps}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}Problem.Dump(\PYGZsq{}SquareSoft.cfn\PYGZsq{})}
\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{CFN}\PYG{o}{.}\PYG{n}{timer}\PYG{p}{(}\PYG{l+m+mi}{300}\PYG{p}{)}
\PYG{n}{res} \PYG{o}{=} \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{Solve}\PYG{p}{(}\PYG{n}{showSolutions}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{k}{if} \PYG{n}{res}\PYG{p}{:}
	\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{S}\PYG{p}{)}\PYG{p}{:}
		\PYG{n}{row} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}
		\PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{S}\PYG{p}{)}\PYG{p}{:}
			\PYG{n}{row} \PYG{o}{+}\PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}
			\PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{:}
				\PYG{k}{if} \PYG{p}{(}\PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{n}{k}\PYG{p}{]}\PYG{o}{\PYGZpc{}}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{k}\PYG{p}{)} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{j} \PYG{o+ow}{and} \PYG{n}{j} \PYG{o}{\PYGZhy{}} \PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{n}{k}\PYG{p}{]}\PYG{o}{\PYGZpc{}}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{k}\PYG{p}{)} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{k}\PYG{p}{)} \PYG{o+ow}{and} \PYG{p}{(}\PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{n}{k}\PYG{p}{]}\PYG{o}{/}\PYG{o}{/}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{k}\PYG{p}{)} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{i} \PYG{o+ow}{and} \PYG{n}{i} \PYG{o}{\PYGZhy{}} \PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{n}{k}\PYG{p}{]}\PYG{o}{/}\PYG{o}{/}\PYG{p}{(}\PYG{n}{S}\PYG{o}{\PYGZhy{}}\PYG{n}{k}\PYG{p}{)} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{n}{k}\PYG{p}{)}\PYG{p}{:}
					\PYG{n}{row} \PYG{o}{=} \PYG{n}{row}\PYG{p}{[}\PYG{p}{:}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{+} \PYG{n+nb}{chr}\PYG{p}{(}\PYG{l+m+mi}{65} \PYG{o}{+} \PYG{n}{k}\PYG{p}{)}
		\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{row}\PYG{p}{)}
\PYG{k}{else}\PYG{p}{:}
	\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{No solution found!}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}


\subsection{C++ program using libtb2.so}
\label{\detokenize{examples/tuto_sspp:c-program-using-libtb2-so}}
\sphinxAtStartPar
The following code uses the C++ toulbar2 library. Compile toulbar2 with “cmake \sphinxhyphen{}DLIBTB2=ON \sphinxhyphen{}DPYTB2=ON . ; make” and copy the library in your current directory “cp lib/Linux/libtb2.so .” before compiling “g++ \sphinxhyphen{}o squaresoft squaresoft.cpp \sphinxhyphen{}I./src \sphinxhyphen{}L./lib/Linux \sphinxhyphen{}std=c++11 \sphinxhyphen{}O3 \sphinxhyphen{}DNDEBUG \sphinxhyphen{}DBOOST \sphinxhyphen{}DLONGDOUBLE\_PROB \sphinxhyphen{}DLONGLONG\_COST \sphinxhyphen{}DWCSPFORMATONLY libtb2.so” and running the example (e.g. “./squaresoft 10 20”).

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{squaresoft.cpp}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]

/**
 * Square Soft Packing Problem
 */

// Compile with cmake option \PYGZhy{}DLIBTB2=ON \PYGZhy{}DPYTB2=ON to get C++ toulbar2 library lib/Linux/libtb2.so
// Then,
// g++ \PYGZhy{}o squaresoft squaresoft.cpp \PYGZhy{}Isrc \PYGZhy{}Llib/Linux \PYGZhy{}std=c++11 \PYGZhy{}O3 \PYGZhy{}DNDEBUG \PYGZhy{}DBOOST \PYGZhy{}DLONGDOUBLE\PYGZus{}PROB \PYGZhy{}DLONGLONG\PYGZus{}COST \PYGZhy{}DWCSPFORMATONLY libtb2.so

\PYGZsh{}include \PYGZdq{}toulbar2lib.hpp\PYGZdq{}

\PYGZsh{}include \PYGZlt{}string.h\PYGZgt{}
\PYGZsh{}include \PYGZlt{}stdio.h\PYGZgt{}
\PYGZsh{}include \PYGZlt{}stdlib.h\PYGZgt{}
\PYGZsh{}include \PYGZlt{}unistd.h\PYGZgt{}

int main(int argc, char* argv[])
\PYGZob{}
    int N = atoi(argv[1]);
    int S = atoi(argv[2]);

    tb2init(); // must be call before setting specific ToulBar2 options and creating a model

    ToulBar2::verbose = 0; // change to 0 or higher values to see more trace information

    initCosts(); // last check for compatibility issues between ToulBar2 options and Cost data\PYGZhy{}type

    Cost top = N*(N*(N\PYGZhy{}1)*(2*N\PYGZhy{}1))/6 + 1;
    WeightedCSPSolver* solver = WeightedCSPSolver::makeWeightedCSPSolver(top);

    for (int i=0; i \PYGZlt{} N; i++) \PYGZob{}
        solver\PYGZhy{}\PYGZgt{}getWCSP()\PYGZhy{}\PYGZgt{}makeEnumeratedVariable(\PYGZdq{}sq\PYGZdq{} + to\PYGZus{}string(i+1), 0, (S\PYGZhy{}i)*(S\PYGZhy{}i) \PYGZhy{} 1);
    \PYGZcb{}

    for (int i=0; i \PYGZlt{} N; i++) \PYGZob{}
        for (int j=i+1; j \PYGZlt{} N; j++) \PYGZob{}
            vector\PYGZlt{}Cost\PYGZgt{} costs((S\PYGZhy{}i)*(S\PYGZhy{}i)*(S\PYGZhy{}j)*(S\PYGZhy{}j), MIN\PYGZus{}COST);
    	    for (int a=0; a \PYGZlt{} (S\PYGZhy{}i)*(S\PYGZhy{}i); a++) \PYGZob{}
    	        for (int b=0; b \PYGZlt{} (S\PYGZhy{}j)*(S\PYGZhy{}j); b++) \PYGZob{}
                    costs[a*(S\PYGZhy{}j)*(S\PYGZhy{}j)+b] = ((((a\PYGZpc{}(S\PYGZhy{}i)) + i + 1 \PYGZlt{}= (b\PYGZpc{}(S\PYGZhy{}j))) || ((b\PYGZpc{}(S\PYGZhy{}j)) + j + 1 \PYGZlt{}= (a\PYGZpc{}(S\PYGZhy{}i))) || ((a/(S\PYGZhy{}i)) + i + 1 \PYGZlt{}= (b/(S\PYGZhy{}j))) || ((b/(S\PYGZhy{}j)) + j + 1 \PYGZlt{}= (a/(S\PYGZhy{}i))))?MIN\PYGZus{}COST:(min((a\PYGZpc{}(S\PYGZhy{}i)) + i + 1 \PYGZhy{} (b\PYGZpc{}(S\PYGZhy{}j)), (b\PYGZpc{}(S\PYGZhy{}j)) + j + 1 \PYGZhy{} (a\PYGZpc{}(S\PYGZhy{}i))) * min((a/(S\PYGZhy{}i)) + i + 1 \PYGZhy{} (b/(S\PYGZhy{}j)), (b/(S\PYGZhy{}j)) + j + 1 \PYGZhy{} (a/(S\PYGZhy{}i)))));
                \PYGZcb{}
            \PYGZcb{}
            solver\PYGZhy{}\PYGZgt{}getWCSP()\PYGZhy{}\PYGZgt{}postBinaryConstraint(i, j, costs);
        \PYGZcb{}
    \PYGZcb{}

    solver\PYGZhy{}\PYGZgt{}getWCSP()\PYGZhy{}\PYGZgt{}sortConstraints(); // must be done at the end of the modeling

    tb2checkOptions();
    if (solver\PYGZhy{}\PYGZgt{}solve()) \PYGZob{}
            vector\PYGZlt{}Value\PYGZgt{} sol;
            solver\PYGZhy{}\PYGZgt{}getSolution(sol);
    	    for (int y=0; y \PYGZlt{} S; y++) \PYGZob{}
                for (int x=0; x \PYGZlt{} S; x++) \PYGZob{}
                    char c = \PYGZsq{} \PYGZsq{};
                    for (int i=N\PYGZhy{}1; i \PYGZgt{}= 0; i\PYGZhy{}\PYGZhy{}) \PYGZob{}
                        if (x \PYGZgt{}= (sol[i]\PYGZpc{}(S\PYGZhy{}i)) \PYGZam{}\PYGZam{} x \PYGZlt{} (sol[i]\PYGZpc{}(S\PYGZhy{}i) ) + i + 1 \PYGZam{}\PYGZam{} y \PYGZgt{}= (sol[i]/(S\PYGZhy{}i)) \PYGZam{}\PYGZam{} y \PYGZlt{} (sol[i]/(S\PYGZhy{}i)) + i + 1) \PYGZob{}
                            if (c != \PYGZsq{} \PYGZsq{}) \PYGZob{}
                                c = 97+i;
                            \PYGZcb{} else \PYGZob{}
                                c = 65+i;
                            \PYGZcb{}
                        \PYGZcb{}
                     \PYGZcb{}
                     cout \PYGZlt{}\PYGZlt{} c;
                \PYGZcb{}
                cout \PYGZlt{}\PYGZlt{} endl;
            \PYGZcb{}
    \PYGZcb{} else \PYGZob{}
            cout \PYGZlt{}\PYGZlt{} \PYGZdq{}No solution found!\PYGZdq{} \PYGZlt{}\PYGZlt{} endl;
    \PYGZcb{}

    delete solver;
    return 0;
\PYGZcb{}

\end{sphinxVerbatim}

\sphinxstepscope


\section{Golomb ruler problem}
\label{\detokenize{examples/tuto_grp:golomb-ruler-problem}}\label{\detokenize{examples/tuto_grp:tuto-grp}}\label{\detokenize{examples/tuto_grp::doc}}



\subsection{Brief description}
\label{\detokenize{examples/tuto_grp:brief-description}}
\sphinxAtStartPar
A golomb ruler of order N is a set of integer marks 0=a1\textless{}a2\textless{}a3\textless{}a4\textless{}….\textless{}aN such that each difference between two ak’s are unique.

\sphinxAtStartPar
For example, this is a golomb ruler:

\noindent\sphinxincludegraphics{{gruler1}.png}

\sphinxAtStartPar
We can see that all differences are unique, rather than in this other ruler where 0\sphinxhyphen{}3 and 3\sphinxhyphen{}6 are both equal to 3.

\noindent\sphinxincludegraphics{{gruler2}.png}

\sphinxAtStartPar
The size of a golomb ruler is equal to aN, the greatest number of the ruler. The goal is to find the smallest golomb ruler given N.


\subsection{CFN model}
\label{\detokenize{examples/tuto_grp:cfn-model}}
\sphinxAtStartPar
We create N variables, one for each integer mark ak. Because we can not create an AllDifferent constraint with differences of variables, we also create a variable for each difference and create hard ternary constraints in order to fix them equal to the difference.
Because we do not use an absolute value when creating the hard constraints, it forces the assignment of ak’s variables to follow an increasing order.

\sphinxAtStartPar
Then we create an AllDifferent constraint on all the difference variables and one unary cost function on the last aN variable in order to minimize the size of the ruler.
In order to break symmetries, we fix the first mark to be zero.


\subsection{Python model}
\label{\detokenize{examples/tuto_grp:python-model}}
\sphinxAtStartPar
The following code using pytoulbar2 library solves the golomb ruler problem with the first argument being the number of marks N (e.g. “python3 golomb.py 8”).

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{golomb.py}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{sys}
\PYG{k+kn}{import} \PYG{n+nn}{pytoulbar2}

\PYG{n}{N} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{top} \PYG{o}{=} \PYG{n}{N}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2} \PYG{o}{+} \PYG{l+m+mi}{1}

\PYG{n}{Problem} \PYG{o}{=} \PYG{n}{pytoulbar2}\PYG{o}{.}\PYG{n}{CFN}\PYG{p}{(}\PYG{n}{top}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}create a variable for each mark}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{X}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}ternary constraints to link new variables of difference with the original variables}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{X}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}X}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{,} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{Constraint} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{for} \PYG{n}{l} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{:}
                \PYG{k}{for} \PYG{n}{m} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{:}
                    \PYG{k}{if} \PYG{n}{l}\PYG{o}{\PYGZhy{}}\PYG{n}{k} \PYG{o}{==} \PYG{n}{m}\PYG{p}{:}
                        \PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
                    \PYG{k}{else}\PYG{p}{:}
                        \PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{top}\PYG{p}{)}
        \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{X}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{X}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j}\PYG{p}{)}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{X}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}X}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{n}{Constraint}\PYG{p}{)}

\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddAllDifferent}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{X}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}X}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)} \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{p}{)} \PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{i}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{N}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{X}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{N}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{N}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}fix the first mark to be zero}
\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{X0}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]} \PYG{o}{+} \PYG{p}{[}\PYG{n}{top}\PYG{p}{]} \PYG{o}{*} \PYG{p}{(}\PYG{n}{N}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2} \PYG{o}{\PYGZhy{}} \PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}Problem.Dump(\PYGZsq{}golomb.cfn\PYGZsq{})}
\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{CFN}\PYG{o}{.}\PYG{n}{timer}\PYG{p}{(}\PYG{l+m+mi}{300}\PYG{p}{)}
\PYG{n}{res} \PYG{o}{=} \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{Solve}\PYG{p}{(}\PYG{n}{showSolutions}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{k}{if} \PYG{n}{res}\PYG{p}{:}
    \PYG{n}{ruler} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{0}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{N}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{ruler} \PYG{o}{+}\PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{*}\PYG{p}{(}\PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{o}{\PYGZhy{}}\PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{n}{i}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Golomb ruler of size:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{ruler}\PYG{p}{)}

\end{sphinxVerbatim}

\sphinxstepscope


\section{Board coloration problem}
\label{\detokenize{examples/tuto_bcp:board-coloration-problem}}\label{\detokenize{examples/tuto_bcp:tuto-bcp}}\label{\detokenize{examples/tuto_bcp::doc}}



\subsection{Brief description}
\label{\detokenize{examples/tuto_bcp:brief-description}}
\sphinxAtStartPar
Given a rectangular board with dimension n*m, the goal is to color the cells such that any inner rectangle included inside the board doesn’t have all its corners colored with the same color.
The goal is to minimize the number of colors used.

\sphinxAtStartPar
For examples, this is not a valid solution of the 3*4 problem, because the red and blue rectangles have both their 4 corners having the same color:

\noindent\sphinxincludegraphics{{tchess}.png}

\sphinxAtStartPar
On the contrary the following coloration is a valid solution of the 3*4 problem because every inner rectangle inside the board does not have a unique color for its corners:

\noindent\sphinxincludegraphics{{fchess}.png}


\subsection{CFN basic model}
\label{\detokenize{examples/tuto_bcp:cfn-basic-model}}
\sphinxAtStartPar
We create n*m variables, one for each square of the board, with domain size equal to n*m representing all the possible colors. We also create one variable for the number of colors.

\sphinxAtStartPar
We create hard quaterny constraints for every rectangle inside the board with cost equal to 0 if the 4 variables have different values and a forbidden cost if not.

\sphinxAtStartPar
We then create hard binary constraints between the variable of the number of colors for each cell to fix the variable for the number of colors as an upper bound.

\sphinxAtStartPar
Then we create a soft constraint on the number of colors to minimize it.


\subsection{Python model}
\label{\detokenize{examples/tuto_bcp:python-model}}
\sphinxAtStartPar
The following code using pytoulbar2 library solves the board coloration problem with the first two arguments being the dimension n and m of the board (e.g. “python3 boardcoloration.py 3 4”).

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{boardcoloration.py}}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{sys}
\PYG{k+kn}{from} \PYG{n+nn}{random} \PYG{k+kn}{import} \PYG{n}{randint}\PYG{p}{,} \PYG{n}{seed}
\PYG{n}{seed}\PYG{p}{(}\PYG{l+m+mi}{123456789}\PYG{p}{)}
\PYG{k+kn}{import} \PYG{n+nn}{pytoulbar2}

\PYG{k}{try}\PYG{p}{:}
    \PYG{n}{n} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{m} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{sys}\PYG{o}{.}\PYG{n}{argv}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}
\PYG{k}{except}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Two integer need to be in arguments: number of rows n, number of columns m}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{exit}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{top} \PYG{o}{=} \PYG{n}{n}\PYG{o}{*}\PYG{n}{m} \PYG{o}{+} \PYG{l+m+mi}{1}

\PYG{n}{Problem} \PYG{o}{=} \PYG{n}{pytoulbar2}\PYG{o}{.}\PYG{n}{CFN}\PYG{p}{(}\PYG{n}{top}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}create a variable for each cell}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{n}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{m}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sq(}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{,}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{n}\PYG{o}{*}\PYG{n}{m}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}create a variable for the maximum of colors}
\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddVariable}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{n}\PYG{o}{*}\PYG{n}{m}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}quaterny hard constraints for rectangle with same color angles}
\PYG{c+c1}{\PYGZsh{}for each cell on the chessboard}
\PYG{k}{for} \PYG{n}{i1} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{n}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{i2} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{m}\PYG{p}{)}\PYG{p}{:}
        \PYG{c+c1}{\PYGZsh{}for every cell on the chessboard that could form a rectangle with the first cell as up left corner and this cell as down right corner}
        \PYG{k}{for} \PYG{n}{j1} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{i1}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{n}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{for} \PYG{n}{j2} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{i2}\PYG{o}{+}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{m}\PYG{p}{)}\PYG{p}{:}
                \PYG{n}{Constraint} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
                \PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{n}\PYG{o}{*}\PYG{n}{m}\PYG{p}{)}\PYG{p}{:}
                    \PYG{k}{for} \PYG{n}{l} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{n}\PYG{o}{*}\PYG{n}{m}\PYG{p}{)}\PYG{p}{:}
                        \PYG{k}{for} \PYG{n}{o} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{n}\PYG{o}{*}\PYG{n}{m}\PYG{p}{)}\PYG{p}{:}
                            \PYG{k}{for} \PYG{n}{p} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{n}\PYG{o}{*}\PYG{n}{m}\PYG{p}{)}\PYG{p}{:}
                                \PYG{k}{if} \PYG{n}{k} \PYG{o}{==}\PYG{n}{l} \PYG{o+ow}{and} \PYG{n}{l} \PYG{o}{==} \PYG{n}{o} \PYG{o+ow}{and} \PYG{n}{o} \PYG{o}{==} \PYG{n}{p}\PYG{p}{:}
                                    \PYG{c+c1}{\PYGZsh{}if they are all the same color }
                                    \PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{top}\PYG{p}{)}
                                \PYG{k}{else}\PYG{p}{:}
                                    \PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
                \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sq(}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i1}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{,}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i2}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sq(}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i1}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{,}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j2}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sq(}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j1}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{,}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i2}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sq(}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j1}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{,}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j2}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{Constraint}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}binary hard constraints to fix the variable max as an upper bound}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{n}\PYG{p}{)}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{m}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{Constraint} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{k} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{n}\PYG{o}{*}\PYG{n}{m}\PYG{p}{)}\PYG{p}{:}
            \PYG{k}{for} \PYG{n}{l} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{n}\PYG{o}{*}\PYG{n}{m}\PYG{p}{)}\PYG{p}{:}
                \PYG{k}{if} \PYG{n}{k}\PYG{o}{\PYGZgt{}}\PYG{n}{l}\PYG{p}{:}
                    \PYG{c+c1}{\PYGZsh{}if the color of the square is more than the number of the max}
                    \PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{top}\PYG{p}{)}
                \PYG{k}{else}\PYG{p}{:}
                    \PYG{n}{Constraint}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}
        \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sq(}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{,}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{j}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{Constraint}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}minimize the number of colors}
\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{AddFunction}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{n}\PYG{o}{*}\PYG{n}{m}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}Problem.Dump(\PYGZsq{}boardcoloration.cfn\PYGZsq{})}
\PYG{n}{Problem}\PYG{o}{.}\PYG{n}{CFN}\PYG{o}{.}\PYG{n}{timer}\PYG{p}{(}\PYG{l+m+mi}{300}\PYG{p}{)}
\PYG{n}{res} \PYG{o}{=} \PYG{n}{Problem}\PYG{o}{.}\PYG{n}{Solve}\PYG{p}{(}\PYG{n}{showSolutions} \PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{k}{if} \PYG{n}{res}\PYG{p}{:}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{n}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{row} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
        \PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{m}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{row}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{res}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{[}\PYG{n}{m}\PYG{o}{*}\PYG{n}{i}\PYG{o}{+}\PYG{n}{j}\PYG{p}{]}\PYG{p}{)}
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{row}\PYG{p}{)}
\PYG{k}{else}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{No solutions found}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
                                                              \PYG{l+m+mi}{70}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{9}        \PYG{n}{Bas}
\end{sphinxVerbatim}

\sphinxstepscope


\section{Learning to play the Sudoku}
\label{\detokenize{examples/ltps:learning-to-play-the-sudoku}}\label{\detokenize{examples/ltps:ltps}}\label{\detokenize{examples/ltps::doc}}



\subsection{Available}
\label{\detokenize{examples/ltps:available}}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxhref{https://github.com/toulbar2/CFN-learn/tree/master/Sudoku\#readme}{Presentation}

\item {} 
\sphinxAtStartPar
\sphinxhref{https://github.com/toulbar2/CFN-learn}{GitHub code}
\sphinxhref{https://github.com/toulbar2/CFN-learn}{\sphinxincludegraphics[width=30\sphinxpxdimen]{{logo-github}.png}}

\item {} 
\sphinxAtStartPar
Data
\sphinxhref{https://github.com/toulbar2/CFN-learn/tree/master/Sudoku}{GitHub code}
\sphinxhref{https://github.com/toulbar2/CFN-learn/tree/master/Sudoku}{\sphinxincludegraphics[width=30\sphinxpxdimen]{{logo-github}.png}}

\end{itemize}

\sphinxstepscope


\section{Learning car configuration preferences}
\label{\detokenize{examples/rccs:learning-car-configuration-preferences}}\label{\detokenize{examples/rccs:rccs}}\label{\detokenize{examples/rccs::doc}}



\subsection{Brief description}
\label{\detokenize{examples/rccs:brief-description}}
\sphinxAtStartPar
Renault car configuration system: learning user preferences.


\subsection{Available}
\label{\detokenize{examples/rccs:available}}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxhref{https://github.com/toulbar2/CFN-learn/tree/master/renault\#readme}{Presentation}

\item {} 
\sphinxAtStartPar
\sphinxhref{https://github.com/toulbar2/CFN-learn}{GitHub code}
\sphinxhref{https://github.com/toulbar2/CFN-learn}{\sphinxincludegraphics[width=30\sphinxpxdimen]{{logo-github}.png}}

\item {} 
\sphinxAtStartPar
Data \sphinxhref{https://github.com/toulbar2/CFN-learn/tree/master/renault}{GitHub code}
\sphinxhref{https://github.com/toulbar2/CFN-learn/tree/master/renault}{\sphinxincludegraphics[width=30\sphinxpxdimen]{{logo-github}.png}}

\end{itemize}

\sphinxstepscope


\section{Visual Sudoku Tutorial}
\label{\detokenize{examples/vstut:visual-sudoku-tutorial}}\label{\detokenize{examples/vstut:vs-tut}}\label{\detokenize{examples/vstut::doc}}



\subsection{Brief description}
\label{\detokenize{examples/vstut:brief-description}}
\sphinxAtStartPar
A simple case mixing \sphinxstylestrong{Deep Learning} and \sphinxstylestrong{Graphical models}.


\subsection{Available}
\label{\detokenize{examples/vstut:available}}\begin{itemize}
\item {} 
\sphinxAtStartPar
You can run it directly from your browser as a
\sphinxhref{https://colab.research.google.com/drive/1ew7IceldcAhyZZ0bHvaHynZyM-s-ne0l\#scrollTo=tBwwmI21cFVZ}{Jupyter Notebook}
\sphinxhref{https://colab.research.google.com/drive/1ew7IceldcAhyZZ0bHvaHynZyM-s-ne0l\#scrollTo=tBwwmI21cFVZ}{\sphinxincludegraphics[width=30\sphinxpxdimen]{{logo-colab}.png}}

\end{itemize}

\sphinxstepscope


\section{Visual Sudoku Application}
\label{\detokenize{examples/vsapp:visual-sudoku-application}}\label{\detokenize{examples/vsapp:vs-app}}\label{\detokenize{examples/vsapp::doc}}



\subsection{Brief description}
\label{\detokenize{examples/vsapp:brief-description}}
\sphinxAtStartPar
An automatic Sudoku puzzle \sphinxstylestrong{solver} using \sphinxstylestrong{OpenCV}, \sphinxstylestrong{Deep Learning}, and \sphinxstylestrong{Optical Character Recognition} (\sphinxstylestrong{OCR}).


\subsection{Available}
\label{\detokenize{examples/vsapp:available}}

\subsubsection{Software}
\label{\detokenize{examples/vsapp:software}}
\sphinxAtStartPar
\sphinxstylestrong{Software} adapted by Simon de Givry (@ INRAE, 2022)
in order to use \sphinxstylestrong{toulbar2} solver, from a
\sphinxhref{https://pyimagesearch.com/2020/08/10/opencv-sudoku-solver-and-ocr}{tutorial}
by Adrian Rosebrock (@ PyImageSearch, 2022) :
\sphinxhref{https://forgemia.inra.fr/thomas.schiex/cost-function-library/-/tree/master/crafted/visualsudoku}{GitHub code}
\sphinxhref{https://forgemia.inra.fr/thomas.schiex/cost-function-library/-/tree/master/crafted/visualsudoku}{\sphinxincludegraphics[width=30\sphinxpxdimen]{{logo-github}.png}}


\subsubsection{As an APK}
\label{\detokenize{examples/vsapp:as-an-apk}}
\sphinxAtStartPar
Based on this software, a ‘Visual Sudoku’ application for Android has been developed to be used from a
smartphone.

\sphinxAtStartPar
See the {\hyperref[\detokenize{examples/vsapp_apk:vs-app-apk}]{\sphinxcrossref{\DUrole{std,std-ref}{detailed presentation}}}}
(description, source, download…).

\sphinxAtStartPar
The application allows to capture a grid from its own camera (\sphinxstyleemphasis{‘CAMERA’ menu})
or to select a grid among the smartphone existing files (\sphinxstyleemphasis{‘FILE’ menu}), for
example files coming from ‘DCIM’, in .jpg or .png formats. The grid image must
have been captured in portrait orientation. Once the grid has been chosen, the
\sphinxstyleemphasis{‘Solve’} button allows to get the solution.
\begin{quote}

\sphinxAtStartPar
Fig.1 \sphinxincludegraphics[width=150\sphinxpxdimen]{{apk_main_menu}.png} Fig.2 \sphinxincludegraphics[width=150\sphinxpxdimen]{{apk_grid_screen}.png} Fig.3 \sphinxincludegraphics[width=150\sphinxpxdimen]{{apk_solution_grid}.png}
\begin{itemize}
\item {} 
\sphinxAtStartPar
Fig.1 : Screen of main menu

\item {} 
\sphinxAtStartPar
Fig.2 : Screen of the grid to be solved

\item {} 
\sphinxAtStartPar
Fig.3 : Screen of the solution (in yellow) found by the solver

\end{itemize}
\end{quote}

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Examples of some input grids and their solved grids}}


\subsubsection{As a Web service}
\label{\detokenize{examples/vsapp:as-a-web-service}}
\sphinxAtStartPar
The software is available as a web service.
The \sphinxstylestrong{visual sudoku web service}, hosted by the \sphinxhref{http://147.100.179.250}{ws} web services (based on HTTP protocol), can be called by many ways : from a \sphinxstylestrong{browser} (like above), from any softwares written in a language supporting HTTP protocol (\sphinxstylestrong{Python}, \sphinxstylestrong{R}, \sphinxstylestrong{C++}, \sphinxstylestrong{Java}, \sphinxstylestrong{Php}…), from command line tools (\sphinxstylestrong{cURL}…)…
\begin{itemize}
\item {} 
\sphinxAtStartPar
Calling the visual sudoku web service from a \sphinxstylestrong{browser} :
\begin{quote}

\sphinxAtStartPar
\sphinxincludegraphics[width=200\sphinxpxdimen]{{logo-ws_ui-vsudoku}.png} \sphinxhref{http://147.100.179.250/api/ui/vsudoku}{\sphinxincludegraphics[width=100\sphinxpxdimen]{{qr-code_ui-vsudoku}.png}}
\sphinxhref{http://147.100.179.250/api/ui/vsudoku}{api/ui/vsudoku}
\end{quote}

\item {} 
\sphinxAtStartPar
Example of calling the visual sudoku web service from a \sphinxstylestrong{terminal} by
\sphinxstylestrong{cURL} :

\sphinxAtStartPar
Commands (\sphinxstyleemphasis{replace mygridfilename.jpg by your own image file name}) :

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{curl} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{output} \PYG{n}{mysolutionfilename}\PYG{o}{.}\PYG{n}{jpg} \PYG{o}{\PYGZhy{}}\PYG{n}{F} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{file=@mygridfilename.jpg}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZhy{}}\PYG{n}{F} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{keep=40}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZhy{}}\PYG{n}{F} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{border=15}\PYG{l+s+s1}{\PYGZsq{}} \PYG{n}{http}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{l+m+mf}{147.100}\PYG{l+m+mf}{.179}\PYG{l+m+mf}{.250}\PYG{o}{/}\PYG{n}{api}\PYG{o}{/}\PYG{n}{tool}\PYG{o}{/}\PYG{n}{vsudoku}
\end{sphinxVerbatim}

\item {} 
\sphinxAtStartPar
The ‘Visual Sudoku’ APK calls the visual sudoku web service.

\end{itemize}

\sphinxstepscope


\section{Visual Sudoku App for Android}
\label{\detokenize{examples/vsapp_apk:visual-sudoku-app-for-android}}\label{\detokenize{examples/vsapp_apk:vs-app-apk}}\label{\detokenize{examples/vsapp_apk::doc}}



\subsection{A visual sudoku solver based on cost function networks}
\label{\detokenize{examples/vsapp_apk:a-visual-sudoku-solver-based-on-cost-function-networks}}\begin{quote}

\sphinxAtStartPar
This application solves the sudoku problem from a smartphone by reading the
grid using its camera. The cost function network solver toulbar2 is used to
deal with the uncertainty on the digit recognition produced by the neural
network. This uncertainty, combined with the sudoku logical rules, makes it
possible to correct perceptual errors. It is particularly useful in the case
of hand\sphinxhyphen{}written digits or poor image quality. It is also possible to solve a
partially filled\sphinxhyphen{}in grid with printed and hand\sphinxhyphen{}written digits. The solver
will always suggest a valid solution that best adapts to the retrieved digit
information. It will naturally detect (a small number of) errors in a
partially filled\sphinxhyphen{}in grid and could be used later as a diagnosis tool (future
work). This software demonstration emphasizes the tight relation between
constraint programming, computer vision, and deep learning.

\sphinxAtStartPar
We used the open\sphinxhyphen{}source C++ solver
\sphinxhref{https://github.com/toulbar2/toulbar2}{toulbar2} in order to find the
maximum a posteriori solution of a constrained probabilistic graphical model.
With its dedicated numerical (soft) local consistency bounds, toulbar2
outperforms traditional CP solvers on this problem. Grid perception and cell
extraction are performed by the computer vision library
\sphinxhref{https://opencv.org}{OpenCV}. Digit recognition is done by \sphinxstylestrong{Keras} and
\sphinxstylestrong{TensorFlow}. The current android application is written in Python using
the \sphinxhref{https://kivy.org}{Kivy} framework. It is inspired from a
\sphinxhref{https://pyimagesearch.com/2020/08/10/opencv-sudoku-solver-and-ocr}{tutorial}
by Adrian Rosebrock. It uses the \sphinxhref{http://147.100.179.250}{ws} RESTful web
services in order to run the solver.

\sphinxAtStartPar
See also : {\hyperref[\detokenize{examples/vsapp:vs-app}]{\sphinxcrossref{\DUrole{std,std-ref}{Visual Sudoku Application}}}}.
\end{quote}


\subsection{Source Code}
\label{\detokenize{examples/vsapp_apk:source-code}}\begin{quote}

\sphinxAtStartPar
\sphinxhref{https://github.com/toulbar2/visualsudoku}{GitHub code}
\sphinxhref{https://github.com/toulbar2/visualsudoku}{\sphinxincludegraphics[width=30\sphinxpxdimen]{{logo-github}.png}}
\end{quote}


\subsection{Download and Install}
\label{\detokenize{examples/vsapp_apk:download-and-install}}\begin{quote}

\sphinxAtStartPar
To install the ‘Visual Sudoku’ application on smartphone :
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{)}%
\item {} 
\sphinxAtStartPar
\sphinxstylestrong{Download} the \sphinxstylestrong{visualsudoku\sphinxhyphen{}release.apk} APK file from Github
repository :
\begin{quote}

\sphinxAtStartPar
\sphinxhref{https://github.com/toulbar2/visualsudoku/releases/latest}{\sphinxincludegraphics[width=100\sphinxpxdimen]{{qr-code_visualsudokuapk}.png}}
\sphinxurl{https://github.com/toulbar2/visualsudoku/releases/latest}
\end{quote}

\item {} 
\sphinxAtStartPar
Click on the downloaded \sphinxstylestrong{visualsudoku\sphinxhyphen{}release.apk} APK file to ask
for \sphinxstylestrong{installation}
(\sphinxstyleemphasis{you have to accept to ‘install anyway’ from unknown developer}).

\item {} 
\sphinxAtStartPar
In your parameter settings for the app, give permissions to the
‘Visual Sudoku’ application
(smartphone menu ‘Parameters’ \textgreater{} ‘Applications’ \textgreater{} ‘Visual Sudoku’) :
allow camera (required to capture grids), files and multimedia contents
(required to save images as files). Re\sphinxhyphen{}run the app.

\end{enumerate}

\sphinxAtStartPar
Warnings :
\begin{itemize}
\item {} 
\sphinxAtStartPar
The application may fail at first start and you may have to launch it
twice.

\item {} 
\sphinxAtStartPar
While setting up successfully, the application should have created
itself the required ‘VisualSudoku’ folder (under the smartphone
‘Internal storage’ folder) but if not, you will have to create it
by yourself manually.

\item {} 
\sphinxAtStartPar
Since the application calls a web service, an internet connection is required.

\end{itemize}
\end{quote}


\subsection{Description}
\label{\detokenize{examples/vsapp_apk:description}}\begin{quote}

\sphinxAtStartPar
The ‘SETTINGS’ menu allows to save grids or solutions as image files (‘savinginputfile’, ‘savingoutputfile’ parameters) and to access to some ‘expert’ parameters in order to enhance the resolution process (‘keep’, ‘border’, ‘time’ parameters).

\sphinxAtStartPar
The application allows to capture a grid from its own camera (\sphinxstyleemphasis{‘CAMERA’ menu})
or to select a grid among the smartphone existing files (\sphinxstyleemphasis{‘FILE’ menu}), for
example files coming from ‘DCIM’, in .jpg or .png formats. The grid image must
have been captured in portrait orientation. Once the grid has been chosen, the
\sphinxstyleemphasis{‘Solve’} button allows to get the solution.
\begin{quote}

\sphinxAtStartPar
Fig.1 \sphinxincludegraphics[width=150\sphinxpxdimen]{{apk_main_menu}.png} Fig.2 \sphinxincludegraphics[width=150\sphinxpxdimen]{{apk_grid_screen}.png} Fig.3 \sphinxincludegraphics[width=150\sphinxpxdimen]{{apk_solution_grid}.png}
\begin{itemize}
\item {} 
\sphinxAtStartPar
Fig.1 : Screen of main menu

\item {} 
\sphinxAtStartPar
Fig.2 : Screen of the grid to be solved

\item {} 
\sphinxAtStartPar
Fig.3 : Screen of the solution (in yellow) found by the solver

\end{itemize}
\end{quote}

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Examples of some input grids and their solved grids}}
\end{quote}

\sphinxstepscope


\section{A sudoku code}
\label{\detokenize{examples/snum:a-sudoku-code}}\label{\detokenize{examples/snum:snum}}\label{\detokenize{examples/snum::doc}}



\subsection{Brief description}
\label{\detokenize{examples/snum:brief-description}}
\sphinxAtStartPar
A Sudoku code returning a sudoku partial grid (sudoku problem) and the corresponding completed grid (sudoku solution), such as \sphinxcode{\sphinxupquote{partial and completed grids}}.

\sphinxAtStartPar
The verbose version, that further gives a detailed description of what the program does, could be useful as tutorial example. Example :
\sphinxcode{\sphinxupquote{partial and completed grids with explanations}}.


\subsection{Available}
\label{\detokenize{examples/snum:available}}
\sphinxAtStartPar
Available as a web service.

\sphinxAtStartPar
You can run the software directly from your \sphinxstylestrong{browser} as a web service :

\sphinxAtStartPar
Grids information is returned into the output stream.
The \sphinxstylestrong{returned\_type} parameter of the web service allows to choose
how to receive it :
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleemphasis{returned\_type=stdout.txt} : to get the output stream as a .txt file.

\item {} 
\sphinxAtStartPar
\sphinxstyleemphasis{returned\_type=run.zip} : to get the .zip run folder containing the output stream \_\_WS\_\_stdout.txt (\sphinxstyleemphasis{+ the error stream \_\_WS\_\_stderr.txt that may be useful to investigate}).

\end{itemize}


\subsubsection{Web service to get one sudoku grids (both partial and completed) :}
\label{\detokenize{examples/snum:web-service-to-get-one-sudoku-grids-both-partial-and-completed}}\begin{quote}

\sphinxAtStartPar
\sphinxincludegraphics[width=200\sphinxpxdimen]{{logo-ws_ui-sudoku}.png}
\sphinxhref{http://147.100.179.250/api/ui/sudoku}{\sphinxincludegraphics[width=100\sphinxpxdimen]{{qr-code_ui-sudoku}.png}}
\sphinxhref{http://147.100.179.250/api/ui/sudoku}{api/ui/sudoku}
\end{quote}


\subsubsection{Web service to further get a detailed description of what the program does (verbose version) :}
\label{\detokenize{examples/snum:web-service-to-further-get-a-detailed-description-of-what-the-program-does-verbose-version}}\begin{quote}

\sphinxAtStartPar
\sphinxincludegraphics[width=200\sphinxpxdimen]{{logo-ws_ui-sudoku-tut}.png}
\sphinxhref{http://147.100.179.250/api/ui/sudoku/tut}{\sphinxincludegraphics[width=100\sphinxpxdimen]{{qr-code_ui-sudoku-tut}.png}}
\sphinxhref{http://147.100.179.250/api/ui/sudoku/tut}{api/ui/sudoku/tut (verbose version)}
\end{quote}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
The \sphinxstylestrong{sudoku web services}, hosted by the \sphinxhref{http://147.100.179.250}{ws} web services (based on HTTP protocol), can be called by many other ways : from a \sphinxstylestrong{browser} (like above), from any softwares written in a language supporting HTTP protocol (\sphinxstylestrong{Python}, \sphinxstylestrong{R}, \sphinxstylestrong{C++}, \sphinxstylestrong{Java}, \sphinxstylestrong{Php}…), from command line tools (\sphinxstylestrong{cURL}…)…
\end{sphinxadmonition}


\subsubsection{Example of calling the sudoku web services from a terminal by cURL :}
\label{\detokenize{examples/snum:example-of-calling-the-sudoku-web-services-from-a-terminal-by-curl}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Commands (\sphinxstyleemphasis{replace indice value by any value in 1…17999}) :

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{curl} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{output} \PYG{n}{mygrids}\PYG{o}{.}\PYG{n}{txt} \PYG{o}{\PYGZhy{}}\PYG{n}{F} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{indice=778}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZhy{}}\PYG{n}{F} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{returned\PYGZus{}type=stdout.txt}\PYG{l+s+s1}{\PYGZsq{}} \PYG{n}{http}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{l+m+mf}{147.100}\PYG{l+m+mf}{.179}\PYG{l+m+mf}{.250}\PYG{o}{/}\PYG{n}{api}\PYG{o}{/}\PYG{n}{tool}\PYG{o}{/}\PYG{n}{sudoku}

\PYG{n}{curl} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{output} \PYG{n}{myrun}\PYG{o}{.}\PYG{n}{zip} \PYG{o}{\PYGZhy{}}\PYG{n}{F} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{indice=778}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZhy{}}\PYG{n}{F} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{returned\PYGZus{}type=run.zip}\PYG{l+s+s1}{\PYGZsq{}} \PYG{n}{http}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{l+m+mf}{147.100}\PYG{l+m+mf}{.179}\PYG{l+m+mf}{.250}\PYG{o}{/}\PYG{n}{api}\PYG{o}{/}\PYG{n}{tool}\PYG{o}{/}\PYG{n}{sudoku}

\PYG{c+c1}{\PYGZsh{} verbose version}

\PYG{n}{curl} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{output} \PYG{n}{mygrids\PYGZus{}details}\PYG{o}{.}\PYG{n}{txt} \PYG{o}{\PYGZhy{}}\PYG{n}{F} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{indice=778}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZhy{}}\PYG{n}{F} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{returned\PYGZus{}type=stdout.txt}\PYG{l+s+s1}{\PYGZsq{}} \PYG{n}{http}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{l+m+mf}{147.100}\PYG{l+m+mf}{.179}\PYG{l+m+mf}{.250}\PYG{o}{/}\PYG{n}{api}\PYG{o}{/}\PYG{n}{tool}\PYG{o}{/}\PYG{n}{sudoku}\PYG{o}{/}\PYG{n}{tut}

\PYG{n}{curl} \PYG{o}{\PYGZhy{}}\PYG{o}{\PYGZhy{}}\PYG{n}{output} \PYG{n}{myrun\PYGZus{}details}\PYG{o}{.}\PYG{n}{zip} \PYG{o}{\PYGZhy{}}\PYG{n}{F} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{indice=778}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZhy{}}\PYG{n}{F} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{returned\PYGZus{}type=run.zip}\PYG{l+s+s1}{\PYGZsq{}} \PYG{n}{http}\PYG{p}{:}\PYG{o}{/}\PYG{o}{/}\PYG{l+m+mf}{147.100}\PYG{l+m+mf}{.179}\PYG{l+m+mf}{.250}\PYG{o}{/}\PYG{n}{api}\PYG{o}{/}\PYG{n}{tool}\PYG{o}{/}\PYG{n}{sudoku}\PYG{o}{/}\PYG{n}{tut}
\end{sphinxVerbatim}

\item {} 
\sphinxAtStartPar
Responses corresponding with the requests above :
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{mygrids.txt}}

\item {} 
\sphinxAtStartPar
\_\_WS\_\_stdout.txt into myrun.zip has the same content as
\sphinxcode{\sphinxupquote{mygrids.txt}}

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{mygrids\_details.txt}} (\sphinxstyleemphasis{\_\_WS\_\_stdout.txt into myrun\_details.zip has the same content})

\item {} 
\sphinxAtStartPar
\_\_WS\_\_stdout.txt into myrun\_details.zip has the same content as
\sphinxcode{\sphinxupquote{mygrids\_details.txt}}

\end{itemize}

\end{itemize}



\renewcommand{\indexname}{Index}
\printindex
\end{document}