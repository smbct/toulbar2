

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Modules &mdash; toulbar2 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/toulbar2.css?v=77a8b5b1" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=af2ce170"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Libraries" href="library.html" />
    <link rel="prev" title="Use cases" href="../examples/usecases.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            toulbar2
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../presentation.html">Presentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../downloads.html">Downloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/command_line_interface.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/usecases.html">Use cases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference manual</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="library.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_line_options.html">Command line options</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="formats.html">Problem formats</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../benchmarks.html">Benchmark libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pdfmanuals.html">Documentation in pdf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">toulbar2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          
<div class=toulbar2header>

  <div class="toulbar2logo">

    <h1>toulbar2</h1>
    <h2>An exact solver for cost function networks</h2>

    <!-- badges -->
    <div style="margin-top: 1.5rem; display: flex;justify-content: center;">

    <!-- build status -->
    <div style="padding-right: 0.5rem;">
    <a href="https://app.travis-ci.com/github/toulbar2/toulbar2">
    <img alt="Build Status" src="https://travis-ci.com/toulbar2/toulbar2.svg?branch=master">
    </a>
    </div>

    <!-- PyPi version -->
    <div style="padding-right: 0.5rem;">
    <a href="https://pypi.org/project/pytoulbar2">
    <img alt="PyPi version" src="https://img.shields.io/pypi/v/pytoulbar2.svg">
    </a>
    </div>

    <!-- PyPi wheel -->
    <div style="padding-right: 0.5rem;">
    <a href="https://pypi.org/project/pytoulbar2">
    <img alt="PyPi wheel" src="https://img.shields.io/pypi/wheel/pytoulbar2.svg">
    </a>
    </div>

    <!-- PyPi python versions -->
    <div style="padding-right: 0.5rem;">
    <a href="https://pypi.org/project/pytoulbar2">
    <img alt="PyPi python versions" src="https://img.shields.io/pypi/pyversions/pytoulbar2.svg">
    </a>
    </div>

    </div>

    <!-- github buttons, from https://buttons.github.io/ -->
    <div style="text-align:center; margin-top: 1.5rem; display: flex; justify-content: center">

      <!-- Place this tag in your head or just before your close body tag. -->
      <script async defer src="https://buttons.github.io/buttons.js"></script>
    
      <div style="padding-right: 2rem;">
      <a class="github-button" href="https://github.com/toulbar2/toulbar2" data-color-scheme="no-preference: light; light: light; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star toulbar2/toulbar2 on GitHub">Star</a>
      </div>

      <div style="padding-right: 2rem;">
      <a class="github-button" href="https://github.com/buttons/github-buttons/subscription" data-color-scheme="no-preference: light; light: light; dark: dark;" data-icon="octicon-eye" data-size="large" data-show-count="true" aria-label="Watch buttons/github-buttons on GitHub">Watch</a>
      </div>

      <div style="padding-right: 2rem;">
      <a class="github-button" href="https://github.com/buttons/github-buttons/fork" data-color-scheme="no-preference: light; light: light; dark: dark;" data-icon="octicon-repo-forked" data-size="large" data-show-count="true" aria-label="Fork buttons/github-buttons on GitHub">Fork</a>
      </div>

      <div style="padding-right: 2rem;">
      <a class="github-button" href="https://github.com/toulbar2" data-color-scheme="no-preference: light; light: light; dark: dark;" data-size="large" data-show-count="true" aria-label="Follow @toulbar2 on GitHub">Follow @toulbar2</a>
      </div>

      </div>

  </div>

  <div class=toulbar2headerline>

    <a href=../presentation.html>Presentation</a> |
    <a href=../downloads.html>Downloads</a> |
    <a href=../benchmarks.html>Benchmarks</a> |
    <a href=../examples/tutorials.html>Tutorials</a> |
    <a href=../examples/usecases.html>Use cases</a> |
    <a href=../userdoc.html>User</a> |
    <a href=../refman.html>Reference</a> |
    <a href=../pdfmanuals.html>Doc in pdf</a> |
    <a href=../publications.html>Publications</a>

  </div>

</div>

<!-- News : see news_*.rst pages -->

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="modules">
<h1>Modules<a class="headerlink" href="#modules" title="Permalink to this heading"></a></h1>
<section id="variable-and-cost-function-modeling">
<h2>Variable and cost function modeling<a class="headerlink" href="#variable-and-cost-function-modeling" title="Permalink to this heading"></a></h2>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__modeling"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">modeling</span></span></dt>
<dd><p><p>Modeling a Weighted CSP consists in creating variables and cost functions.</p>
<p>Domains of variables can be of two different types:</p>
<ul class="simple">
<li><p>enumerated domain allowing direct access to each value (array) and iteration on current domain in times proportional to the current number of values (double-linked list)</p></li>
<li><p>interval domain represented by a lower value and an upper value only (useful for large domains)</p></li>
</ul>

Warning : Current implementation of toulbar2 has limited modeling and solving facilities for interval domains. There is no cost functions accepting both interval and enumerated variables for the moment, which means all the variables should have the same type.</p>
<p><p>Cost functions can be defined in extension (table or maps) or having a specific semantic.</p>
<p>Cost functions in extension depend on their arity:</p>
<ul class="simple">
<li><p>unary cost function (directly associated to an enumerated variable)</p></li>
<li><p>binary and ternary cost functions (table of costs)</p></li>
<li><p>n-ary cost functions (n &gt;= 4) defined by a list of tuples with associated costs and a default cost for missing tuples (allows for a compact representation)</p></li>
</ul>

Cost functions having a specific semantic (see <a class="reference internal" href="formats/wcspformat.html#group__wcspformat"><span class="std std-ref">Weighted Constraint Satisfaction Problem file format (wcsp)</span></a>) are:<ul class="simple">
<li><p>simple arithmetic and scheduling (temporal disjunction) cost functions on interval variables</p></li>
<li><p>global cost functions (<em>eg</em> soft alldifferent, soft global cardinality constraint, soft same, soft regular, etc) with three different propagator keywords:<ul>
<li><p><em>flow</em> propagator based on flow algorithms with “s” prefix in the keyword (<em>salldiff</em>, <em>sgcc</em>, <em>ssame</em>, <em>sregular</em>)</p></li>
<li><p><em>DAG</em> propagator based on dynamic programming algorithms with “s” prefix and “dp” postfix (<em>samongdp</em>, salldiffdp, sgccdp, sregulardp, sgrammardp, smstdp, smaxdp)</p></li>
<li><p><em>network</em> propagator based on cost function network decomposition with “w” prefix (<em>wsum</em>, <em>wvarsum</em>, <em>walldiff</em>, <em>wgcc</em>, <em>wsame</em>, <em>wsamegcc</em>, <em>wregular</em>, <em>wamong</em>, <em>wvaramong</em>, <em>woverlap</em>)</p></li>
</ul>
</p></li>
</ul>

Note : The default semantics (using <em>var</em> keyword) of monolithic (flow and DAG-based propagators) global cost functions is to count the number of variables to change in order to restore consistency and to multiply it by the basecost. Other particular semantics may be used in conjunction with the flow-based propagator</p>
<p>Note : The semantics of the network-based propagator approach is either a hard constraint (“hard” keyword) or a soft constraint by multiplying the number of changes by the basecost (“lin” or “var” keyword) or by multiplying the square value of the number of changes by the basecost (“quad” keyword)</p>
<p>Note : A decomposable version exists for each monolithic global cost function, except grammar and MST. The decomposable ones may propagate less than their monolithic counterpart and they introduce extra variables but they can be much faster in practice</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>: Each global cost function may have less than three propagators implemented</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>: Current implementation of toulbar2 has limited solving facilities for monolithic global cost functions (no BTD-like methods nor variable elimination)</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>: Current implementation of toulbar2 disallows global cost functions with less than or equal to three variables in their scope (use cost functions in extension instead)</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>: Before modeling the problem using make and post, call ::tb2init method to initialize toulbar2 global variables</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>: After modeling the problem using make and post, call <a class="reference internal" href="ref_cpp.html#classWeightedCSP_1a31a9384d3dabf5388fe610710f2f19e0"><span class="std std-ref">WeightedCSP::sortConstraints</span></a> method to initialize correctly the model before solving it </p>
</div>
</dd></dl>

</section>
<section id="solving-cost-function-networks">
<h2>Solving cost function networks<a class="headerlink" href="#solving-cost-function-networks" title="Permalink to this heading"></a></h2>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__solving"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">solving</span></span></dt>
<dd><p>After creating a Weighted CSP, it can be solved using a local search method like INCOP or PILS (see <a class="reference internal" href="ref_cpp.html#classWeightedCSPSolver_1af481cf37ff94238ab1e15bff34026209"><span class="std std-ref">WeightedCSPSolver::narycsp</span></a> or <a class="reference internal" href="ref_cpp.html#classWeightedCSPSolver_1a94898d20bff27abdb156ed2e248a8004"><span class="std std-ref">WeightedCSPSolver::pils</span></a>) and/or an exact search method (see <a class="reference internal" href="ref_cpp.html#classWeightedCSPSolver_1ab1f9d2c018bf050a6b010680a2008171"><span class="std std-ref">WeightedCSPSolver::solve</span></a>).</p>
<p><p>Various options of the solving methods are controlled by ::Toulbar2 static class members (see files ./src/core/tb2types.hpp and ./src/tb2main.cpp).</p>
<p>A brief code example reading a wcsp problem given as a single command-line parameter and solving it:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;toulbar2lib.hpp&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="n">argv</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="n">tb2init</span><span class="p">();</span><span class="w"> </span><span class="c1">// must be call before setting specific ToulBar2 options and creating a model</span>

<span class="w">    </span><span class="c1">// Create a solver object</span>
<span class="w">    </span><span class="n">initCosts</span><span class="p">();</span><span class="w"> </span><span class="c1">// last check for compatibility issues between ToulBar2 options and Cost data-type</span>
<span class="w">    </span><span class="n">WeightedCSPSolver</span><span class="w"> </span><span class="o">*</span><span class="n">solver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WeightedCSPSolver</span><span class="o">::</span><span class="n">makeWeightedCSPSolver</span><span class="p">(</span><span class="n">MAX_COST</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Read a problem file in wcsp format</span>
<span class="w">    </span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">read_wcsp</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

<span class="w">    </span><span class="n">ToulBar2</span><span class="o">::</span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w">  </span><span class="c1">// change to 0 or higher values to see more trace information</span>

<span class="w">    </span><span class="c1">// Uncomment if solved using INCOP local search followed by a partial Limited Discrepancy Search with a maximum discrepancy of one</span>
<span class="w">    </span><span class="c1">//  ToulBar2::incop_cmd = &quot;0 1 3 idwa 100000 cv v 0 200 1 0 0&quot;;</span>
<span class="w">    </span><span class="c1">//  ToulBar2::lds = -1;  // remove it or change to a positive value then the search continues by a complete B&amp;B search method</span>
<span class="w">    </span><span class="c1">// Uncomment the following lines if solved using Decomposition Guided Variable Neighborhood Search with min-fill cluster decomposition and absorption</span>
<span class="w">    </span><span class="c1">// ToulBar2::lds = 4;</span>
<span class="w">    </span><span class="c1">// ToulBar2::restart = 10000;</span>
<span class="w">    </span><span class="c1">// ToulBar2::searchMethod = DGVNS;</span>
<span class="w">    </span><span class="c1">// ToulBar2::vnsNeighborVarHeur = CLUSTERRAND;</span>
<span class="w">    </span><span class="c1">// ToulBar2::boostingBTD = 0.7;</span>
<span class="w">    </span><span class="c1">// ToulBar2::varOrder = reinterpret_cast&lt;char*&gt;(-3);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">solve</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// show (sub-)optimal solution</span>
<span class="w">        </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Value</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sol</span><span class="p">;</span>
<span class="w">        </span><span class="n">Cost</span><span class="w"> </span><span class="n">ub</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">getSolution</span><span class="p">(</span><span class="n">sol</span><span class="p">);</span>
<span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Best solution found cost: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ub</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Best solution found:&quot;</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">&lt;</span><span class="n">sol</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">((</span><span class="n">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">?</span><span class="s">&quot;,&quot;</span><span class="o">:</span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; x&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">sol</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;No solution found!&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">solver</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</p>
<p>See : another code example in ./src/toulbar2test.cpp</p>
<p>Warning : variable domains must start at zero, otherwise recompile libtb2.so without flag WCSPFORMATONLY </p>
</dd></dl>

<p><strong>toulbar2test.cpp</strong></p>
<blockquote>
<div><p><a class="reference download internal" download="" href="../_downloads/af18470515498cdbc4f5e516f6664a2b/toulbar2test.cpp"><code class="xref download docutils literal notranslate"><span class="pre">toulbar2test.cpp</span></code></a></p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * Test toulbar2 API</span>
<span class="cm"> */</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;toulbar2lib.hpp&quot;</span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;core/tb2wcsp.hpp&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;vns/tb2vnsutils.hpp&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;vns/tb2dgvns.hpp&quot;</span>
<span class="cp">#ifdef OPENMPI</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;vns/tb2cpdgvns.hpp&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;vns/tb2rpdgvns.hpp&quot;</span>
<span class="cp">#endif</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unistd.h&gt;</span>

<span class="c1">// INCOP default command line option</span>
<span class="k">const</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">Incop_cmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;0 1 3 idwa 100000 cv v 0 200 1 0 0&quot;</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
<span class="cp">#ifdef OPENMPI</span>
<span class="w">    </span><span class="n">mpi</span><span class="o">::</span><span class="n">environment</span><span class="w"> </span><span class="n">env</span><span class="p">;</span><span class="w"> </span><span class="c1">// equivalent to MPI_Init via the constructor and MPI_finalize via the destructor</span>
<span class="w">    </span><span class="n">mpi</span><span class="o">::</span><span class="n">communicator</span><span class="w"> </span><span class="n">world</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="n">tb2init</span><span class="p">();</span><span class="w"> </span><span class="c1">// must be call before setting specific ToulBar2 options and creating a model</span>

<span class="cp">#ifdef OPENMPI</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world</span><span class="p">.</span><span class="n">rank</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WeightedCSPSolver</span><span class="o">::</span><span class="n">MASTER</span><span class="p">)</span>
<span class="w">        </span><span class="n">ToulBar2</span><span class="o">::</span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="c1">// change to 0 or higher values to see more trace information</span>
<span class="w">    </span><span class="k">else</span>
<span class="w">        </span><span class="n">ToulBar2</span><span class="o">::</span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="cp">#else</span>
<span class="w">    </span><span class="n">ToulBar2</span><span class="o">::</span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="c1">// change to 0 or higher values to see more trace information</span>
<span class="cp">#endif</span>

<span class="w">    </span><span class="c1">// uncomment if Virtual Arc Consistency (equivalent to Augmented DAG algorithm) enable</span>
<span class="w">    </span><span class="c1">//	ToulBar2::vac = 1; // option -A</span>
<span class="w">    </span><span class="c1">//	ToulBar2::vacValueHeuristic = true; // option -V</span>
<span class="w">    </span><span class="c1">// uncomment if partial Limited Discrepancy Search enable</span>
<span class="w">    </span><span class="c1">//	ToulBar2::lds = 1;  // option -l=1</span>
<span class="w">    </span><span class="c1">// uncomment if INCOP local search enable</span>
<span class="w">    </span><span class="c1">//	ToulBar2::incop_cmd = Incop_cmd; // option -i</span>
<span class="w">    </span><span class="c1">// uncomment the following lines if variable neighborhood search enable</span>
<span class="w">    </span><span class="c1">// ToulBar2::lds = 4;</span>
<span class="w">    </span><span class="c1">// ToulBar2::restart = 10000;</span>
<span class="w">    </span><span class="c1">// #ifdef OPENMPI</span>
<span class="w">    </span><span class="c1">//     if (world.size() &gt; 1) {</span>
<span class="w">    </span><span class="c1">//    	 ToulBar2::searchMethod = RPDGVNS;</span>
<span class="w">    </span><span class="c1">//    	 ToulBar2::vnsParallel = true;</span>
<span class="w">    </span><span class="c1">//    	 ToulBar2::vnsNeighborVarHeur = MASTERCLUSTERRAND;</span>
<span class="w">    </span><span class="c1">//    	 ToulBar2::vnsParallelSync = false;</span>
<span class="w">    </span><span class="c1">//     } else {</span>
<span class="w">    </span><span class="c1">//    	 ToulBar2::searchMethod = DGVNS;</span>
<span class="w">    </span><span class="c1">//    	 ToulBar2::vnsNeighborVarHeur = CLUSTERRAND;</span>
<span class="w">    </span><span class="c1">//     }</span>
<span class="w">    </span><span class="c1">// #else</span>
<span class="w">    </span><span class="c1">//	ToulBar2::searchMethod = DGVNS;</span>
<span class="w">    </span><span class="c1">//	ToulBar2::vnsNeighborVarHeur = CLUSTERRAND;</span>
<span class="w">    </span><span class="c1">//**or**</span>
<span class="w">    </span><span class="c1">//  ToulBar2::searchMethod = VNS;</span>
<span class="w">    </span><span class="c1">//  ToulBar2::vnsNeighborVarHeur = RANDOMVAR;</span>
<span class="w">    </span><span class="c1">// #endif</span>

<span class="w">    </span><span class="c1">// create a problem with three 0/1 variables</span>
<span class="w">    </span><span class="n">initCosts</span><span class="p">();</span><span class="w"> </span><span class="c1">// last check for compatibility issues between ToulBar2 options and Cost data-type</span>
<span class="w">    </span><span class="n">WeightedCSPSolver</span><span class="o">*</span><span class="w"> </span><span class="n">solver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WeightedCSPSolver</span><span class="o">::</span><span class="n">makeWeightedCSPSolver</span><span class="p">(</span><span class="n">MAX_COST</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">getWCSP</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">makeEnumeratedVariable</span><span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// note that for efficiency issue, I assume domain values start at zero (otherwise remove flag -DWCSPFORMATONLY in Makefile)</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">getWCSP</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">makeEnumeratedVariable</span><span class="p">(</span><span class="s">&quot;y&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">getWCSP</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">makeEnumeratedVariable</span><span class="p">(</span><span class="s">&quot;z&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// add random unary cost functions on each variable</span>
<span class="w">    </span><span class="n">mysrand</span><span class="p">(</span><span class="n">getpid</span><span class="p">());</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Cost</span><span class="o">&gt;</span><span class="w"> </span><span class="n">costs</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="n">costs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">randomCost</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<span class="w">        </span><span class="n">costs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">randomCost</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<span class="w">        </span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">getWCSP</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">postUnary</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">costs</span><span class="p">);</span>
<span class="w">        </span><span class="n">costs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">randomCost</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<span class="w">        </span><span class="n">costs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">randomCost</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<span class="w">        </span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">getWCSP</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">postUnary</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">costs</span><span class="p">);</span>
<span class="w">        </span><span class="n">costs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">randomCost</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<span class="w">        </span><span class="n">costs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">randomCost</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">);</span>
<span class="w">        </span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">getWCSP</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">postUnary</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">costs</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// add binary cost functions (Ising) on each pair of variables</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Cost</span><span class="o">&gt;</span><span class="w"> </span><span class="n">costs</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">costs</span><span class="p">.</span><span class="n">push_back</span><span class="p">((</span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">getWCSP</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">toValue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">getWCSP</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">toValue</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">))</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">30</span><span class="p">);</span><span class="w"> </span><span class="c1">// penalizes by a cost=30 if variables are assigned to different values</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">getWCSP</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">postBinaryConstraint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">costs</span><span class="p">);</span>
<span class="w">        </span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">getWCSP</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">postBinaryConstraint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">costs</span><span class="p">);</span>
<span class="w">        </span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">getWCSP</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">postBinaryConstraint</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">costs</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// add a ternary hard constraint (x+y=z)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Cost</span><span class="o">&gt;</span><span class="w"> </span><span class="n">costs</span><span class="p">;</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">costs</span><span class="p">.</span><span class="n">push_back</span><span class="p">((</span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">getWCSP</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">toValue</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">getWCSP</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">toValue</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">getWCSP</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">toValue</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">))</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">MAX_COST</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">getWCSP</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">postTernaryConstraint</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">costs</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">getWCSP</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">sortConstraints</span><span class="p">();</span><span class="w"> </span><span class="c1">// must be done before the search</span>

<span class="w">    </span><span class="c1">//	int verbose = ToulBar2::verbose;</span>
<span class="w">    </span><span class="c1">//	ToulBar2::verbose = 5;  // high verbosity to see the cost functions</span>
<span class="w">    </span><span class="c1">//	solver-&gt;getWCSP()-&gt;print(cout);</span>
<span class="w">    </span><span class="c1">//	ToulBar2::verbose = verbose;</span>

<span class="w">    </span><span class="c1">// tb2checkOptions();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">solve</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#ifdef OPENMPI</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world</span><span class="p">.</span><span class="n">rank</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WeightedCSPSolver</span><span class="o">::</span><span class="n">MASTER</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#endif</span>
<span class="w">            </span><span class="c1">// show optimal solution</span>
<span class="w">            </span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Value</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sol</span><span class="p">;</span>
<span class="w">            </span><span class="n">Cost</span><span class="w"> </span><span class="n">optimum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solver</span><span class="o">-&gt;</span><span class="n">getSolution</span><span class="p">(</span><span class="n">sol</span><span class="p">);</span>
<span class="w">            </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Optimum=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">optimum</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="w">            </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Solution: x=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">sol</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; ,y=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">sol</span><span class="p">[</span><span class="n">y</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; ,z=&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">sol</span><span class="p">[</span><span class="n">z</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="cp">#ifdef OPENMPI</span>
<span class="w">        </span><span class="p">}</span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#ifdef OPENMPI</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">world</span><span class="p">.</span><span class="n">rank</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">WeightedCSPSolver</span><span class="o">::</span><span class="n">MASTER</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="cp">#endif</span>
<span class="w">            </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;No solution found!&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<span class="cp">#ifdef OPENMPI</span>
<span class="w">        </span><span class="p">}</span>
<span class="cp">#endif</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="c1">// cout &lt;&lt; &quot;Problem lower bound: &quot; &lt;&lt; solver-&gt;getWCSP()-&gt;getLb() &lt;&lt; endl; // initial problem lower bound possibly enhanced by value removals at the root during search</span>

<span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">solver</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Local Variables: */</span>
<span class="cm">/* c-basic-offset: 4 */</span>
<span class="cm">/* tab-width: 4 */</span>
<span class="cm">/* indent-tabs-mode: nil */</span>
<span class="cm">/* c-default-style: &quot;k&amp;r&quot; */</span>
<span class="cm">/* End: */</span>
</pre></div>
</div>
</div></blockquote>
</section>
<section id="output-messages-verbosity-options-and-debugging">
<h2>Output messages, verbosity options and debugging<a class="headerlink" href="#output-messages-verbosity-options-and-debugging" title="Permalink to this heading"></a></h2>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__verbosity"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">verbosity</span></span></dt>
<dd><p>Depending on verbosity level given as option “-v=level”, <code class="docutils literal notranslate"><span class="pre">toulbar2</span></code> will output:<ul class="simple">
<li><p>(level=0, no verbosity) default output mode: shows version number, number of variables and cost functions read in the problem file, number of unassigned variables and cost functions after preprocessing, problem upper and lower bounds after preprocessing. Outputs current best solution cost found, ends by giving the optimum or “No solution”. Last output line should always be: “end.”</p></li>
<li><p>(level=-1, no verbosity) restricted output mode: do not print current best solution cost found</p></li>
</ul>
<ol class="arabic simple">
<li><p>(level=1) shows also search choices (“[”<em>search_depth</em> <em>problem_lower_bound</em> <em>problem_upper_bound</em> <em>sum_of_current_domain_sizes”] Try”</em> <em>variable_index</em> <em>operator</em> <em>value</em>) with <em>operator</em> being assignment (“==”), value removal (“!=”), domain splitting (“&lt;=” or “&gt;=”, also showing EAC value in parenthesis)</p></li>
<li><p>(level=2) shows also current domains (<em>variable_index</em> <em>list_of_current_domain_values</em> “/” <em>number_of_cost_functions</em> (see approximate degree in <a class="reference internal" href="#group__varelim"><span class="std std-ref">Variable elimination</span></a>) “/” <em>weighted_degree</em> <em>list_of_unary_costs</em> “s:” <em>support_value</em>) before each search choice and reports problem lower bound increases, NC bucket sort data (see <a class="reference internal" href="#group__ncbucket"><span class="std std-ref">NC bucket sort</span></a>), and basic operations on domains of variables</p></li>
<li><p>(level=3) reports also basic arc EPT operations on cost functions (see <a class="reference internal" href="#group__softac"><span class="std std-ref">Soft arc consistency and problem reformulation</span></a>)</p></li>
<li><p>(level=4) shows also current list of cost functions for each variable and reports more details on arc EPT operations (showing all changes in cost functions)</p></li>
<li><p>(level=5) reports more details on cost functions defined in extension giving their content (cost table by first increasing values in the current domain of the last variable in the scope)</p></li>
</ol>
</p>
<p>For debugging purposes, another option “-Z=level” allows one to monitor the search:<ol class="arabic simple">
<li><p>(level 1) shows current search depth (number of search choices from the root of the search tree) and reports statistics on nogoods for BTD-like methods</p></li>
<li><p>(level 2) idem</p></li>
<li><p>(level 3) also saves current problem into a file before each search choice</p></li>
</ol>
</p>
<p>Note : <code class="docutils literal notranslate"><span class="pre">toulbar2</span></code>, compiled in debug mode, can be more verbose and it checks a lot of assertions (pre/post conditions in the code)</p>
<p>Note : <code class="docutils literal notranslate"><span class="pre">toulbar2</span></code> will output an help message giving available options if run without any parameters </p>
</dd></dl>

</section>
<section id="preprocessing-techniques">
<h2>Preprocessing techniques<a class="headerlink" href="#preprocessing-techniques" title="Permalink to this heading"></a></h2>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__preprocessing"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">preprocessing</span></span></dt>
<dd><p>Depending on toulbar2 options, the sequence of preprocessing techniques applied before the search is:<ol class="arabic simple">
<li><p><em>i-bounded</em> variable elimination with user-defined <em>i</em> bound</p></li>
<li><p>pairwise decomposition of cost functions (binary cost functions are implicitly decomposed by soft AC and empty cost function removals)</p></li>
<li><p>MinSumDiffusion propagation (see VAC)</p></li>
<li><p>projects&amp;substracts n-ary cost functions in extension on all the binary cost functions inside their scope (3 &lt; n &lt; max, see toulbar2 options)</p></li>
<li><p>functional variable elimination (see <a class="reference internal" href="#group__varelim"><span class="std std-ref">Variable elimination</span></a>)</p></li>
<li><p>projects&amp;substracts ternary cost functions in extension on their three binary cost functions inside their scope (before that, extends the existing binary cost functions to the ternary cost function and applies pairwise decomposition)</p></li>
<li><p>creates new ternary cost functions for all triangles (<em>ie</em> occurences of three binary cost functions <em>xy</em>, <em>yz</em>, <em>zx</em>)</p></li>
<li><p>removes empty cost functions while repeating #1 and #2 until no new cost functions can be removed</p></li>
</ol>
</p>
<p>Note : the propagation loop is called after each preprocessing technique (see WCSP::propagate) </p>
</dd></dl>

</section>
<section id="variable-and-value-search-ordering-heuristics">
<h2>Variable and value search ordering heuristics<a class="headerlink" href="#variable-and-value-search-ordering-heuristics" title="Permalink to this heading"></a></h2>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__heuristics"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">heuristics</span></span></dt>
<dd><p>See : <em> Boosting Systematic Search by Weighting Constraints </em>. Frederic Boussemart, Fred Hemery, Christophe Lecoutre, Lakhdar Sais. Proc. of ECAI 2004, pages 146-150. Valencia, Spain, 2004.</p>
<p>See : <em> Last Conflict Based Reasoning </em>. Christophe Lecoutre, Lakhdar Sais, Sebastien Tabary, Vincent Vidal. Proc. of ECAI 2006, pages 133-137. Trentino, Italy, 2006.</p>
<p>See : <em> Solution-based phase saving for CP: A value-selection heuristic to simulate local search behavior in complete solvers </em>. Emir Demirovic, Geoffrey Chu, and Peter Stuckey. Proc. of CP-18, pages 99–108. Lille, France, 2018. </p>
</dd></dl>

</section>
<section id="soft-arc-consistency-and-problem-reformulation">
<h2>Soft arc consistency and problem reformulation<a class="headerlink" href="#soft-arc-consistency-and-problem-reformulation" title="Permalink to this heading"></a></h2>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__softac"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">softac</span></span></dt>
<dd><p>Soft arc consistency is an incremental lower bound technique for optimization problems. Its goal is to move costs from high-order (typically arity two or three) cost functions towards the problem lower bound and unary cost functions. This is achieved by applying iteratively local equivalence-preserving problem transformations (EPTs) until some terminating conditions are met.</p>
<p>Note : <em>eg</em> an EPT can move costs between a binary cost function and a unary cost function such that the sum of the two functions remains the same for any complete assignment.</p>
<p>See : <em> Arc consistency for Soft Constraints. </em> T. Schiex. Proc. of CP’2000. Singapour, 2000.</p>
<p>Note : Soft Arc Consistency in toulbar2 is limited to binary and ternary and some global cost functions (<em>eg</em> alldifferent, gcc, regular, same). Other n-ary cost functions are delayed for propagation until their number of unassigned variables is three or less.</p>
<p>See : <em> Towards Efficient Consistency Enforcement for Global Constraints in Weighted Constraint Satisfaction. </em> Jimmy Ho-Man Lee, Ka Lun Leung. Proc. of IJCAI 2009, pages 559-565. Pasadena, USA, 2009. </p>
</dd></dl>

</section>
<section id="virtual-arc-consistency-enforcing">
<h2>Virtual Arc Consistency enforcing<a class="headerlink" href="#virtual-arc-consistency-enforcing" title="Permalink to this heading"></a></h2>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__VAC"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">VAC</span></span></dt>
<dd><p>The three phases of VAC are enforced in three different “Pass”. Bool(P) is never built. Instead specific functions (getVACCost) booleanize the WCSP on the fly. The domain variables of Bool(P) are the original variable domains (saved and restored using trailing at each iteration). All the counter data-structures (k) are timestamped to avoid clearing them at each iteration.</p>
<p>Note: Simultaneously AC (and potentially DAC, EAC) are maintained by proper queuing.</p>
<p>Note: usual domain events such that assign/remove should not be called during VAC phase 1, use removeVAC instead.</p>
<p>See : <em> Soft Arc Consistency Revisited. </em> Cooper et al. Artificial Intelligence. 2010. </p>
</dd></dl>

</section>
<section id="nc-bucket-sort">
<h2>NC bucket sort<a class="headerlink" href="#nc-bucket-sort" title="Permalink to this heading"></a></h2>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__ncbucket"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">ncbucket</span></span></dt>
<dd><p>maintains a sorted list of variables having non-zero unary costs in order to make NC propagation incremental.<ul class="simple">
<li><p>variables are sorted into buckets</p></li>
<li><p>each bucket is associated to a single interval of non-zero costs (using a power-of-two scaling, first bucket interval is [1,2[, second interval is [2,4[, etc.)</p></li>
<li><p>each variable is inserted into the bucket corresponding to its largest unary cost in its domain</p></li>
<li><p>variables having all unary costs equal to zero do not belong to any bucket</p></li>
</ul>
</p>
<p>NC propagation will revise only variables in the buckets associated to costs sufficiently large wrt current objective bounds. </p>
</dd></dl>

</section>
<section id="variable-elimination">
<h2>Variable elimination<a class="headerlink" href="#variable-elimination" title="Permalink to this heading"></a></h2>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__varelim"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">varelim</span></span></dt>
<dd><p><ul class="simple">
<li><p><em>i-bounded</em> variable elimination eliminates all variables with a degree less than or equal to <em>i</em>. It can be done with arbitrary i-bound in preprocessing only and iff all their cost functions are in extension.</p></li>
<li><p><em>i-bounded</em> variable elimination with i-bound less than or equal to two can be done during the search.</p></li>
<li><p>functional variable elimination eliminates all variables which have a bijective or functional binary hard constraint (<em>ie</em> ensuring a one-to-one or several-to-one value mapping) and iff all their cost functions are in extension. It can be done without limit on their degree, in preprocessing only.</p></li>
</ul>
</p>
<p>Note : Variable elimination order used in preprocessing is either lexicographic or given by an external file *.order (see toulbar2 options)</p>
<p>Note : 2-bounded variable elimination during search is optimal in the sense that any elimination order should result in the same final graph</p>
<p>Warning : It is not possible to display/save solutions when bounded variable elimination is applied in preprocessing</p>
<p>Warning : toulbar2 maintains a list of current cost functions for each variable. It uses the size of these lists as an approximation of variable degrees. During the search, if variable <em>x</em> has three cost functions <em>xy</em>, <em>xz</em>, <em>xyz</em>, its true degree is two but its approximate degree is three. In toulbar2 options, it is the approximate degree which is given by the user for variable elimination during the search (thus, a value at most three). But it is the true degree which is given by the user for variable elimination in preprocessing. </p>
</dd></dl>

</section>
<section id="propagation-loop">
<h2>Propagation loop<a class="headerlink" href="#propagation-loop" title="Permalink to this heading"></a></h2>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__propagation"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">propagation</span></span></dt>
<dd><p><p>Propagates soft local consistencies and bounded variable elimination until all the propagation queues are empty or a contradiction occurs.</p>
<p>While (queues are not empty or current objective bounds have changed):</p>
<ol class="arabic simple">
<li><p>queue for bounded variable elimination of degree at most two (except at preprocessing)</p></li>
<li><p>BAC queue</p></li>
<li><p>EAC queue</p></li>
<li><p>DAC queue</p></li>
<li><p>AC queue</p></li>
<li><p>monolithic (flow-based and DAG-based) global cost function propagation (partly incremental)</p></li>
<li><p>NC queue</p></li>
<li><p>returns to #1 until all the previous queues are empty</p></li>
<li><p>DEE queue</p></li>
<li><p>returns to #1 until all the previous queues are empty</p></li>
<li><p>VAC propagation (not incremental)</p></li>
<li><p>returns to #1 until all the previous queues are empty (and problem is VAC if enable)</p></li>
<li><p>exploits goods in pending separators for BTD-like methods</p></li>
</ol>
</p>
<p>Queues are first-in / first-out lists of variables (avoiding multiple insertions). In case of a contradiction, queues are explicitly emptied by WCSP::whenContradiction </p>
</dd></dl>

</section>
<section id="backtrack-management">
<h2>Backtrack management<a class="headerlink" href="#backtrack-management" title="Permalink to this heading"></a></h2>
<dl>
<dt class="sig sig-object cpp">
<span class="target" id="group__backtrack"></span><em><span class="pre">group</span></em> <span class="sig-name descname"><span class="pre">backtrack</span></span></dt>
<dd><p>Used by backtrack search methods. Allows to copy / restore the current state using Store::store and Store::restore methods. All storable data modifications are trailed into specific stacks.</p>
<p>Trailing stacks are associated to each storable type:<ul class="simple">
<li><p>Store::storeValue for storable domain values ::StoreValue (value supports, etc)</p></li>
<li><p>Store::storeInt for storable integer values ::StoreInt (number of non assigned variables in nary cost functions, etc)</p></li>
<li><p>Store::storeCost for storable costs ::StoreCost (inside cost functions, etc)</p></li>
<li><p>Store::storeDomain for enumerated domains (to manage holes inside domains)</p></li>
<li><p>Store::storeIndexList for integer lists (to manage edge connections in global cost functions)</p></li>
<li><p>Store::storeConstraint for backtrackable lists of constraints</p></li>
<li><p>Store::storeVariable for backtrackable lists of variables</p></li>
<li><p>Store::storeSeparator for backtrackable lists of separators (see tree decomposition methods)</p></li>
<li><p>Store::storeKnapsack for backtrackable lists of knapsack constraints</p></li>
<li><p>Store::storeBigInteger for very large integers ::StoreBigInteger used in solution counting methods</p></li>
</ul>
</p>
<p>Memory for each stack is dynamically allocated by part of <span class="math notranslate nohighlight">\(2^x\)</span> with <em>x</em> initialized to ::STORE_SIZE and increased when needed.</p>
<p>Note : storable data are not trailed at depth 0.</p>
<p>Warning : Current storable data management is not multi-threading safe! (Store is a static virtual class relying on StoreBasic&lt;T&gt; static members) </p>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../examples/usecases.html" class="btn btn-neutral float-left" title="Use cases" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="library.html" class="btn btn-neutral float-right" title="Libraries" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, INRAE.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>