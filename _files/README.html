

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Exact optimization for cost function networks and additive graphical models &mdash; toulbar2 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/toulbar2.css?v=77a8b5b1" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=af2ce170"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            toulbar2
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../presentation.html">Presentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../downloads.html">Downloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/command_line_interface.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/usecases.html">Use cases</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference manual</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference_manual/ref_modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_manual/library.html">Libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference_manual/command_line_options.html">Command line options</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference_manual/formats.html">Problem formats</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Additional resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../benchmarks.html">Benchmark libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pdfmanuals.html">Documentation in pdf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">toulbar2</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          
<div class=toulbar2header>

  <div class="toulbar2logo">

    <h1>toulbar2</h1>
    <h2>An exact solver for cost function networks</h2>

    <!-- badges -->
    <div style="margin-top: 1.5rem; display: flex;justify-content: center;">

    <!-- build status -->
    <div style="padding-right: 0.5rem;">
    <a href="https://app.travis-ci.com/github/toulbar2/toulbar2">
    <img alt="Build Status" src="https://travis-ci.com/toulbar2/toulbar2.svg?branch=master">
    </a>
    </div>

    <!-- PyPi version -->
    <div style="padding-right: 0.5rem;">
    <a href="https://pypi.org/project/pytoulbar2">
    <img alt="PyPi version" src="https://img.shields.io/pypi/v/pytoulbar2.svg">
    </a>
    </div>

    <!-- PyPi wheel -->
    <div style="padding-right: 0.5rem;">
    <a href="https://pypi.org/project/pytoulbar2">
    <img alt="PyPi wheel" src="https://img.shields.io/pypi/wheel/pytoulbar2.svg">
    </a>
    </div>

    <!-- PyPi python versions -->
    <div style="padding-right: 0.5rem;">
    <a href="https://pypi.org/project/pytoulbar2">
    <img alt="PyPi python versions" src="https://img.shields.io/pypi/pyversions/pytoulbar2.svg">
    </a>
    </div>

    </div>

    <!-- github buttons, from https://buttons.github.io/ -->
    <div style="text-align:center; margin-top: 1.5rem; display: flex; justify-content: center">

      <!-- Place this tag in your head or just before your close body tag. -->
      <script async defer src="https://buttons.github.io/buttons.js"></script>
    
      <div style="padding-right: 2rem;">
      <a class="github-button" href="https://github.com/toulbar2/toulbar2" data-color-scheme="no-preference: light; light: light; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star toulbar2/toulbar2 on GitHub">Star</a>
      </div>

      <div style="padding-right: 2rem;">
      <a class="github-button" href="https://github.com/buttons/github-buttons/subscription" data-color-scheme="no-preference: light; light: light; dark: dark;" data-icon="octicon-eye" data-size="large" data-show-count="true" aria-label="Watch buttons/github-buttons on GitHub">Watch</a>
      </div>

      <div style="padding-right: 2rem;">
      <a class="github-button" href="https://github.com/buttons/github-buttons/fork" data-color-scheme="no-preference: light; light: light; dark: dark;" data-icon="octicon-repo-forked" data-size="large" data-show-count="true" aria-label="Fork buttons/github-buttons on GitHub">Fork</a>
      </div>

      <div style="padding-right: 2rem;">
      <a class="github-button" href="https://github.com/toulbar2" data-color-scheme="no-preference: light; light: light; dark: dark;" data-size="large" data-show-count="true" aria-label="Follow @toulbar2 on GitHub">Follow @toulbar2</a>
      </div>

      </div>

  </div>

  <div class=toulbar2headerline>

    <a href=../presentation.html>Presentation</a> |
    <a href=../downloads.html>Downloads</a> |
    <a href=../benchmarks.html>Benchmarks</a> |
    <a href=../examples/tutorials.html>Tutorials</a> |
    <a href=../examples/usecases.html>Use cases</a> |
    <a href=../userdoc.html>User</a> |
    <a href=../refman.html>Reference</a> |
    <a href=../pdfmanuals.html>Doc in pdf</a> |
    <a href=../publications.html>Publications</a>

  </div>

</div>

<!-- News : see news_*.rst pages -->

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="exact-optimization-for-cost-function-networks-and-additive-graphical-models">
<h1>Exact optimization for cost function networks and additive graphical models<a class="headerlink" href="#exact-optimization-for-cost-function-networks-and-additive-graphical-models" title="Permalink to this heading"></a></h1>
<p><a class="reference external" href="https://app.travis-ci.com/github/toulbar2/toulbar2"><img alt="Build Status" src="https://travis-ci.com/toulbar2/toulbar2.svg?branch=master" /></a>
<a class="reference external" href="https://pypi.org/project/pytoulbar2"><img alt="PyPi version" src="https://img.shields.io/pypi/v/pytoulbar2.svg" /></a><a class="reference external" href="https://pypi.org/project/pytoulbar2"><img alt="PyPi wheel" src="https://img.shields.io/pypi/wheel/pytoulbar2.svg" /></a><a class="reference external" href="https://pypi.org/project/pytoulbar2"><img alt="PyPi python versions" src="https://img.shields.io/pypi/pyversions/pytoulbar2.svg" /></a></p>
<section id="what-is-toulbar2">
<span id="readme-1"></span><h2>What is toulbar2?<a class="headerlink" href="#what-is-toulbar2" title="Permalink to this heading"></a></h2>
<p>toulbar2 is an open-source black-box C++ optimizer for cost function
networks and discrete additive graphical models. This also covers Max-SAT, Max-Cut, QUBO (and constrained variants), among others. It can read a variety
of formats. The optimized criteria and feasibility should be provided
factorized in local cost functions on discrete variables. Constraints
are represented as functions that produce costs that exceed a
user-provided primal bound. toulbar2 looks for a non-forbidden assignment
of all variables that optimizes the sum of all functions (a decision
NP-complete problem).</p>
<p>toulbar2 won several competitions on deterministic and probabilistic
graphical models:</p>
<ul class="simple">
<li><p>Max-CSP 2008 Competition <a class="reference external" href="http://www.cril.univ-artois.fr/CPAI08/">CPAI08</a> (winner on 2-ARY-EXT and N-ARY-EXT)</p></li>
<li><p>Probabilistic Inference Evaluation <a class="reference external" href="http://graphmod.ics.uci.edu/uai08/Evaluation/Report">UAI 2008</a> (winner on several MPE tasks, inra entries)</p></li>
<li><p>2010 UAI APPROXIMATE INFERENCE CHALLENGE <a class="reference external" href="http://www.cs.huji.ac.il/project/UAI10/summary.php">UAI 2010</a> (winner on 1200-second MPE task)</p></li>
<li><p>The Probabilistic Inference Challenge <a class="reference external" href="http://www.cs.huji.ac.il/project/PASCAL/board.php">PIC 2011</a> (second place by ficolofo on 1-hour MAP task)</p></li>
<li><p>UAI 2014 Inference Competition <a class="reference external" href="https://personal.utdallas.edu/~vibhav.gogate/uai14-competition/leaders.html">UAI 2014</a> (winner on all MAP task categories, see Proteus, Robin, and IncTb entries)</p></li>
<li><p><a class="reference external" href="https://xcsp.org/competitions">XCSP3</a> Competitions (second place on Mini COP and Parallel COP tracks in 2022, first place on Mini COP in 2023, third place in 2024)</p></li>
<li><p>UAI 2022 Inference Competition <a class="reference external" href="https://uaicompetition.github.io/uci-2022/results/final-leader-board">UAI 2022</a> (winner on all MPE and MMAP task categories)</p></li>
</ul>
<p>toulbar2 is now also able to collaborate with ML code that can learn
an additive graphical model (with constraints) from data (see the
associated
<a class="reference external" href="https://miat.inrae.fr/schiex/Export/Pushing_Data_in_your_CP_model.pdf">paper</a>,
<a class="reference external" href="https://miat.inrae.fr/schiex/Export/Pushing_Data_in_your_CP_model-Slides.pdf">slides</a>
and <a class="reference external" href="https://www.youtube.com/watch?v=IpUr6KIEjMs">video</a> where it is
shown how it can learn user preferences or how to play the Sudoku
without knowing the rules). The current CFN learning code is available
on <a class="reference external" href="https://github.com/toulbar2/CFN-learn">GitHub</a>.</p>
</section>
<section id="installation-from-binaries">
<span id="readme-2"></span><h2>Installation from binaries<a class="headerlink" href="#installation-from-binaries" title="Permalink to this heading"></a></h2>
<p>You can install toulbar2 directly using the package manager in Debian
and Debian derived Linux distributions (Ubuntu, Mint,…):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo apt-get update
sudo apt-get install toulbar2 toulbar2-doc
</pre></div>
</div>
<p>For the most recent binary or the Python API, compile from source.</p>
</section>
<section id="python-interface">
<span id="readme-3"></span><h2>Python interface<a class="headerlink" href="#python-interface" title="Permalink to this heading"></a></h2>
<p>An alpha-release Python interface can be tested through pip on Linux and MacOS:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>python3 -m pip install --upgrade pip
python3 -m pip install pytoulbar2
</pre></div>
</div>
<p>The first line is only useful for Linux distributions that ship “old” versions of pip.</p>
<p>Commands for compiling the Python API on Linux/MacOS with cmake (Python module in lib/*/pytb2.cpython*.so):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pip3 install pybind11
mkdir build
cd build
cmake -DPYTB2=ON ..
make
</pre></div>
</div>
<p>Move the cpython library and the experimental <a class="reference external" href="https://github.com/toulbar2/toulbar2/raw/master/pytoulbar2/pytoulbar2.py">pytoulbar2.py</a> python class wrapper in the folder of the python script that does “import pytoulbar2”.</p>
</section>
<section id="download">
<span id="readme-4"></span><h2>Download<a class="headerlink" href="#download" title="Permalink to this heading"></a></h2>
<p>Download the latest release from GitHub
(https://github.com/toulbar2/toulbar2) or similarly use tag versions,
e.g.:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git clone --branch 1.2.0 https://github.com/toulbar2/toulbar2.git
</pre></div>
</div>
</section>
<section id="installation-from-sources">
<span id="readme-5"></span><h2>Installation from sources<a class="headerlink" href="#installation-from-sources" title="Permalink to this heading"></a></h2>
<p>Compilation requires git, cmake and a C++-20 capable compiler (in C++20 mode).</p>
<p>Required library:</p>
<ul class="simple">
<li><p>libgmp-dev</p></li>
<li><p>bc (used during cmake)</p></li>
</ul>
<p>Recommended libraries (default use):</p>
<ul class="simple">
<li><p>libboost-graph-dev</p></li>
<li><p>libboost-iostreams-dev</p></li>
<li><p>libboost-serialization-dev</p></li>
<li><p>zlib1g-dev</p></li>
<li><p>liblzma-dev</p></li>
<li><p>libbz2-dev</p></li>
<li><p>libeigen3-dev</p></li>
</ul>
<p>Optional libraries:</p>
<ul class="simple">
<li><p>libjemalloc-dev</p></li>
<li><p>pybind11-dev</p></li>
<li><p>libopenmpi-dev</p></li>
<li><p>libboost-mpi-dev</p></li>
<li><p>libicuuc</p></li>
<li><p>libicui18n</p></li>
<li><p>libicudata</p></li>
<li><p>libxml2-dev</p></li>
<li><p>libxcsp3parser</p></li>
</ul>
<p>On MacOS, run ./misc/script/MacOS-requirements-install.sh to install the recommended libraries. For Mac with ARM64, add option -DBoost=OFF to cmake.</p>
<p>Commands for compiling toulbar2 on Linux/MacOS with cmake (binary in build/bin/*/toulbar2):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mkdir build
cd build
cmake ..
make
</pre></div>
</div>
<p>Commands for statically compiling toulbar2 on Linux in directory toulbar2/src without cmake:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bash
cd src
echo &#39;#define Toulbar_VERSION &quot;1.2.0&quot;&#39; &gt; ToulbarVersion.hpp
g++ -o toulbar2 -std=c++20 -O3 -DNDEBUG -march=native -flto -static -static-libgcc -static-libstdc++ -DBOOST -DLONGDOUBLE_PROB -DLONGLONG_COST -DWCSPFORMATONLY \
 -I. -I./pils/src tb2*.cpp applis/*.cpp convex/*.cpp core/*.cpp globals/*.cpp incop/*.cpp mcriteria/*.cpp pils/src/exe/*.cpp search/*.cpp utils/*.cpp vns/*.cpp ToulbarVersion.cpp \
 -lboost_graph -lboost_iostreams -lboost_serialization -lgmp -lz -lbz2 -llzma
</pre></div>
</div>
<p>Use OPENMPI flag and MPI compiler for a parallel version of toulbar2:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bash
cd src
echo &#39;#define Toulbar_VERSION &quot;1.2.0&quot;&#39; &gt; ToulbarVersion.hpp
mpicxx -o toulbar2 -std=c++20 -O3 -DNDEBUG -march=native -flto -DBOOST -DLONGDOUBLE_PROB -DLONGLONG_COST -DWCSPFORMATONLY -DOPENMPI \
 -I. -I./pils/src tb2*.cpp applis/*.cpp convex/*.cpp core/*.cpp globals/*.cpp incop/*.cpp mcriteria/*.cpp pils/src/exe/*.cpp search/*.cpp utils/*.cpp vns/*.cpp ToulbarVersion.cpp \
 -lboost_graph -lboost_iostreams -lboost_serialization -lboost_mpi -lgmp -lz -lbz2 -llzma
</pre></div>
</div>
<p>Replace LONGLONG_COST by INT_COST to reduce memory usage by two and reduced cost range (costs must be smaller than 10^8).</p>
<p>Replace WCSPFORMATONLY by XMLFLAG3 and add libxcsp3parser.a from xcsp.org in your current directory for reading XCSP3 files:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bash
cd src
echo &#39;#define Toulbar_VERSION &quot;1.2.0&quot;&#39; &gt; ToulbarVersion.hpp
mpicxx -o toulbar2 -std=c++20 -O3 -DNDEBUG -march=native -flto -DBOOST -DLONGDOUBLE_PROB -DLONGLONG_COST -DXMLFLAG3 -DOPENMPI \
 -I/usr/include/libxml2 -I. -I./pils/src -I./xmlcsp3 tb2*.cpp applis/*.cpp convex/*.cpp core/*.cpp globals/*.cpp incop/*.cpp mcriteria/*.cpp pils/src/exe/*.cpp search/*.cpp utils/*.cpp vns/*.cpp ToulbarVersion.cpp \
 -lboost_graph -lboost_iostreams -lboost_serialization -lboost_mpi -lxml2 -licuuc -licui18n -licudata libxcsp3parser.a -lgmp -lz -lbz2 -llzma -lm -lpthread -ldl
</pre></div>
</div>
<p>Copyright (C) 2006-2024, toulbar2 team.
toulbar2 is currently maintained by Simon de Givry, INRAE - MIAT, Toulouse, France (simon.de-givry&#64;inrae.fr)</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, INRAE.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>